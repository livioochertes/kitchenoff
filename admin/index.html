<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KitchenOff Admin Panel</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Load Excel library only when needed -->
  <script>
    // Preload Excel library asynchronously for later use
    const xlsxScript = document.createElement('script');
    xlsxScript.src = 'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js';
    xlsxScript.async = true;
    document.head.appendChild(xlsxScript);
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* Initial loading overlay */
    .initial-loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    .initial-loading.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      color: white;
      font-size: 18px;
      font-weight: 600;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .login-container {
      max-width: 450px;
      margin: 80px auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 50px;
      border-radius: 20px;
      box-shadow: 0 15px 50px rgba(0,0,0,0.2);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .login-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .login-logo img {
      width: 80px;
      height: 80px;
      border-radius: 12px;
    }
    
    .login-title {
      font-size: 32px;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
    }
    
    .login-subtitle {
      color: #666;
      font-size: 16px;
    }
    
    /* Loading Spinner */
    .loading-spinner {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
      color: white;
      text-align: center;
    }
    
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .image-upload-zone {
      transition: all 0.3s ease;
    }
    
    .image-upload-zone:hover {
      border-color: #007bff !important;
      background-color: #f8f9ff !important;
    }
    
    .image-thumbnail {
      transition: all 0.3s ease;
    }
    
    .image-thumbnail:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .admin-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 28px;
      font-weight: bold;
      color: #667eea;
      transition: opacity 0.3s ease;
    }
    
    .logo:hover {
      opacity: 0.8;
    }
    
    .logo img {
      width: 60px;
      height: 60px;
      border-radius: 10px;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 35px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 35px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    
    .stat-number {
      font-size: 42px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 12px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .stat-label {
      color: #666;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 500;
    }
    
    .content-area {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
    }
    
    .content-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .content-title {
      font-size: 22px;
      font-weight: 600;
      margin: 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .content-body {
      padding: 30px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }
    
    .form-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
      width: 100%;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-secondary {
      background: #6c757d;
      box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
    }
    
    .btn-secondary:hover {
      background: #5a6268;
      box-shadow: 0 8px 25px rgba(108, 117, 125, 0.6);
    }
    
    .nav-tabs {
      display: flex;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 8px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .nav-tab {
      flex: 1;
      padding: 12px 20px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: transparent;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      color: #666;
      font-size: 14px;
    }
    
    .nav-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .nav-tab:hover:not(.active) {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: #f5f5f5;
      color: #333;
      border: 2px solid #e0e0e0;
    }
    
    .btn-secondary:hover {
      background: #e0e0e0;
    }
    
    .error-message {
      background: #fee;
      color: #c33;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      border: 1px solid #fcc;
    }
    
    .success-message {
      background: #efe;
      color: #393;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      border: 1px solid #cfc;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .hidden {
      display: none;
    }
    
    .text-center {
      text-align: center;
    }
    
    .mb-20 {
      margin-bottom: 20px;
    }
    
    .mb-30 {
      margin-bottom: 30px;
    }
    
    .text-sm {
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>
  <!-- Initial loading overlay -->
  <div id="initial-loading" class="initial-loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading KitchenOff Admin Panel...</div>
  </div>
  
  <div id="admin-root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Define global functions first before React components
    console.log('Defining uploadCategoryImage function on window object');
    window.uploadCategoryImage = async (categoryId, file) => {
      try {
        const token = localStorage.getItem('adminToken');
        console.log('uploadCategoryImage called with:', { categoryId, fileName: file.name, fileSize: file.size, fileType: file.type });
        console.log('Current token:', token);
        
        // Validate file
        if (!file) {
          return { success: false, message: 'No file provided' };
        }
        
        if (!file.type.startsWith('image/')) {
          return { success: false, message: 'File must be an image' };
        }
        
        const formData = new FormData();
        formData.append('image', file);
        
        console.log('FormData created successfully');
        console.log('FormData entries:', [...formData.entries()].map(([key, value]) => [key, value instanceof File ? `File: ${value.name}` : value]));
        
        const url = `/admin/api/categories/${categoryId}/upload-image`;
        console.log('Making request to:', url);
        
        // Test if the URL is reachable first
        try {
          const testResponse = await fetch(url, {
            method: 'OPTIONS',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          console.log('OPTIONS request status:', testResponse.status);
        } catch (optionsError) {
          console.error('OPTIONS request failed:', optionsError);
        }
        
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData
        });
        
        console.log('POST response received');
        console.log('Response status:', response.status);
        console.log('Response ok:', response.ok);
        console.log('Response headers:', Object.fromEntries(response.headers.entries()));
        
        const responseText = await response.text();
        console.log('Response text:', responseText);
        
        if (response.ok) {
          const result = JSON.parse(responseText);
          console.log('Upload successful, result:', result);
          return { success: true, message: result.message, imageUrl: result.imageUrl };
        } else {
          try {
            const error = JSON.parse(responseText);
            console.log('Upload failed, error:', error);
            return { success: false, message: error.message };
          } catch (parseError) {
            console.log('Failed to parse error response:', parseError);
            return { success: false, message: `HTTP ${response.status}: ${responseText}` };
          }
        }
      } catch (error) {
        console.error('Error uploading category image:', error);
        console.error('Error stack:', error.stack);
        return { success: false, message: `Network error: ${error.message}` };
      }
    };
    
    window.fetchCategories = async (setCategoriesCallback) => {
      try {
        const token = localStorage.getItem('adminToken');
        const response = await fetch('/admin/api/categories', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          // Update React state if callback provided
          if (setCategoriesCallback && typeof setCategoriesCallback === 'function') {
            setCategoriesCallback(data);
          }
          return data;
        }
      } catch (error) {
        console.error('Error fetching categories:', error);
      }
    };
    
    console.log('Global functions defined successfully');
    
    // Admin Login Component
    function AdminLogin({ onLoginSuccess }) {
      const [formData, setFormData] = useState({ email: '', password: '' });
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');
        
        try {
          const response = await fetch('/admin/api/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
          });
          
          const data = await response.json();
          
          if (response.ok) {
            localStorage.setItem('adminToken', data.token);
            localStorage.setItem('adminUser', JSON.stringify(data.admin));
            onLoginSuccess(data.token, data.admin);
          } else {
            setError(data.message || 'Login failed');
          }
        } catch (err) {
          setError('Network error. Please try again.');
        } finally {
          setLoading(false);
        }
      };
      
      return (
        <div className="login-container">
          <div className="login-header">
            <div className="login-logo">
              <img src="/attached_assets/KitchenOff_Logo_Background_Removed_1752520997429.png" alt="KitchenOff Logo" />
              <span>KitchenOff</span>
            </div>
            <h1 className="login-title">Admin Panel</h1>
            <p className="login-subtitle">Welcome back! Please sign in to continue.</p>
          </div>
          
          {error && <div className="error-message">{error}</div>}
          
          <form onSubmit={handleSubmit}>
            <div className="form-group">
              <label className="form-label">Email</label>
              <input
                type="email"
                className="form-input"
                value={formData.email}
                onChange={(e) => setFormData({...formData, email: e.target.value})}
                required
                placeholder="admin@kitchen-off.com"
              />
            </div>
            
            <div className="form-group">
              <label className="form-label">Password</label>
              <input
                type="password"
                className="form-input"
                value={formData.password}
                onChange={(e) => setFormData({...formData, password: e.target.value})}
                required
                placeholder="Enter your password"
              />
            </div>
            
            <button type="submit" className="btn" disabled={loading}>
              {loading && <span className="loading"></span>}
              {loading ? 'Logging in...' : 'Login'}
            </button>
          </form>
          
          <div className="text-sm text-center" style={{marginTop: '20px'}}>
            <p><strong>Demo Credentials:</strong></p>
            <p>Email: admin@kitchen-off.com</p>
            <p>Password: admin123</p>
          </div>
        </div>
      );
    }
    
    // Admin Dashboard Component
    function AdminDashboard({ token, admin, onLogout }) {
      const [stats, setStats] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState('');
      const [showTwoFactor, setShowTwoFactor] = useState(false);
      const [activeView, setActiveView] = useState('dashboard');
      const [orders, setOrders] = useState([]);
      const [users, setUsers] = useState([]);
      const [products, setProducts] = useState([]);
      const [categories, setCategories] = useState([]);
      const [suppliers, setSuppliers] = useState([]);
      const [showAddUserModal, setShowAddUserModal] = useState(false);
      const [showAddProductModal, setShowAddProductModal] = useState(false);
      const [showAddCategoryModal, setShowAddCategoryModal] = useState(false);
      const [editingUser, setEditingUser] = useState(null);
      const [editingProduct, setEditingProduct] = useState(null);
      const [editingCategory, setEditingCategory] = useState(null);
      const [selectedOrders, setSelectedOrders] = useState([]);
      const [showBulkModal, setShowBulkModal] = useState(false);
      const [bulkOperation, setBulkOperation] = useState('');
      const [bulkResults, setBulkResults] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [statusFilter, setStatusFilter] = useState('all');
      const [showSearchFilter, setShowSearchFilter] = useState(false);
      const [filteredOrders, setFilteredOrders] = useState([]);
      const [selectedOrder, setSelectedOrder] = useState(null);
      const [showOrderDetails, setShowOrderDetails] = useState(false);
      const [showOrderTools, setShowOrderTools] = useState(false);
      const [selectedProducts, setSelectedProducts] = useState([]);
      const [showProductBulkModal, setShowProductBulkModal] = useState(false);
      const [productBulkOperation, setProductBulkOperation] = useState('');
      const [showProductSearchFilter, setShowProductSearchFilter] = useState(false);
      const [productSearchTerm, setProductSearchTerm] = useState('');
      const [productCategoryFilter, setProductCategoryFilter] = useState('all');
      const [productStatusFilter, setProductStatusFilter] = useState('all');
      const [filteredProducts, setFilteredProducts] = useState([]);
      const [showProductAnalytics, setShowProductAnalytics] = useState(false);
      const [analyticsData, setAnalyticsData] = useState(null);
      const [editingSupplier, setEditingSupplier] = useState(null);
      const [showEditSupplierModal, setShowEditSupplierModal] = useState(false);
      const [viewingSupplier, setViewingSupplier] = useState(null);
      const [showViewSupplierModal, setShowViewSupplierModal] = useState(false);
      const [supplierDetails, setSupplierDetails] = useState(null);
      const [selectedSuppliers, setSelectedSuppliers] = useState([]);
      const [showSupplierBulkModal, setShowSupplierBulkModal] = useState(false);
      const [supplierBulkOperation, setSupplierBulkOperation] = useState('');
      const [showHomepageConfigModal, setShowHomepageConfigModal] = useState(false);
      const [homepageConfig, setHomepageConfig] = useState({
        mainTop: [],
        mainShop: []
      });
      const [companySettings, setCompanySettings] = useState({
        name: '',
        email: '',
        phone: '',
        address: '',
        city: '',
        state: '',
        zipCode: '',
        country: '',
        contactPerson: '',
        website: '',
        vatNumber: '',
        registrationNumber: '',
        description: ''
      });
      const [showCompanySettingsModal, setShowCompanySettingsModal] = useState(false);
      const [showExcelImportModal, setShowExcelImportModal] = useState(false);
      const [excelFile, setExcelFile] = useState(null);
      const [importResults, setImportResults] = useState(null);
      
      useEffect(() => {
        fetchStats();
      }, []);
      
      // Filter orders based on search and status
      useEffect(() => {
        let filtered = orders;
        
        if (searchTerm) {
          filtered = filtered.filter(order => 
            order.id.toString().includes(searchTerm) ||
            order.shippingAddress.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
            order.shippingAddress.city.toLowerCase().includes(searchTerm.toLowerCase()) ||
            order.status.toLowerCase().includes(searchTerm.toLowerCase())
          );
        }
        
        if (statusFilter !== 'all') {
          filtered = filtered.filter(order => order.status === statusFilter);
        }
        
        setFilteredOrders(filtered);
      }, [orders, searchTerm, statusFilter]);
      
      // Filter products based on search and filters
      useEffect(() => {
        let filtered = products;
        
        if (productSearchTerm) {
          filtered = filtered.filter(product => 
            product.name.toLowerCase().includes(productSearchTerm.toLowerCase()) ||
            product.id.toString().includes(productSearchTerm) ||
            product.category?.name?.toLowerCase().includes(productSearchTerm.toLowerCase()) ||
            product.description?.toLowerCase().includes(productSearchTerm.toLowerCase())
          );
        }
        
        if (productCategoryFilter !== 'all') {
          filtered = filtered.filter(product => product.categoryId === parseInt(productCategoryFilter));
        }
        
        if (productStatusFilter !== 'all') {
          filtered = filtered.filter(product => (product.status || 'active') === productStatusFilter);
        }
        
        setFilteredProducts(filtered);
        console.log('Products filtered:', {
          searchTerm: productSearchTerm,
          categoryFilter: productCategoryFilter,
          statusFilter: productStatusFilter,
          totalProducts: products.length,
          filteredProducts: filtered.length
        });
      }, [products, productSearchTerm, productCategoryFilter, productStatusFilter]);
      
      const fetchStats = async () => {
        try {
          const response = await fetch('/admin/api/stats', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            setStats(data);
          } else {
            setError(data.message || 'Failed to fetch stats');
          }
        } catch (err) {
          setError('Network error. Please try again.');
        } finally {
          setLoading(false);
        }
      };

      const fetchUsers = async () => {
        try {
          const response = await fetch('/admin/api/users', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            setUsers(data);
          } else {
            console.error('Failed to fetch users:', data.message);
          }
        } catch (err) {
          console.error('Network error fetching users:', err);
        }
      };

      const fetchOrders = async () => {
        try {
          const response = await fetch('/admin/api/orders', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            setOrders(data);
          } else {
            console.error('Failed to fetch orders:', data.message);
          }
        } catch (err) {
          console.error('Network error fetching orders:', err);
        }
      };

      const fetchProducts = async () => {
        try {
          const response = await fetch('/admin/api/products', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            setProducts(data);
          } else {
            console.error('Failed to fetch products:', data.message);
          }
        } catch (err) {
          console.error('Network error fetching products:', err);
        }
      };

      const fetchCategories = async () => {
        try {
          const response = await fetch('/admin/api/categories', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            setCategories(data);
          } else {
            console.error('Failed to fetch categories:', data.message);
          }
        } catch (err) {
          console.error('Network error fetching categories:', err);
        }
      };

      const fetchSuppliers = async () => {
        try {
          const response = await fetch('/admin/api/suppliers', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            setSuppliers(data);
          } else {
            console.error('Failed to fetch suppliers:', data.message);
          }
        } catch (err) {
          console.error('Network error fetching suppliers:', err);
        }
      };

      // Create category
      const createCategory = async (categoryData) => {
        try {
          const token = localStorage.getItem('adminToken');
          const response = await fetch('/admin/api/categories', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(categoryData)
          });
          
          const data = await response.json();
          
          if (response.ok) {
            await fetchCategories(); // Refresh categories list
            return { success: true, message: 'Category created successfully' };
          } else {
            return { success: false, message: data.message || 'Failed to create category' };
          }
        } catch (error) {
          console.error('Error creating category:', error);
          return { success: false, message: 'Network error. Please try again.' };
        }
      };

      // Update category
      const updateCategory = async (categoryId, categoryData) => {
        try {
          const response = await fetch(`/admin/api/categories/${categoryId}`, {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(categoryData)
          });
          
          const data = await response.json();
          
          if (response.ok) {
            await fetchCategories(); // Refresh categories list
            return { success: true, message: 'Category updated successfully' };
          } else {
            return { success: false, message: data.message || 'Failed to update category' };
          }
        } catch (error) {
          console.error('Error updating category:', error);
          return { success: false, message: 'Network error. Please try again.' };
        }
      };

      // Sync supplier prices
      const syncSupplierPrices = async (supplierId) => {
        try {
          const response = await fetch(`/admin/api/suppliers/${supplierId}/sync-prices`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            }
          });
          const data = await response.json();
          
          if (response.ok) {
            alert(`‚úÖ Price Sync Successful!\n\n${data.message}\n\nUpdated Products:\n${data.data.filter(r => r.success).map(r => `‚Ä¢ ${r.productName}: ‚Ç¨${r.oldPrice} ‚Üí ‚Ç¨${r.newPrice}`).join('\n')}`);
            // Refresh products data
            fetchProducts();
          } else {
            alert(`‚ùå Price Sync Failed\n\n${data.message}`);
          }
        } catch (error) {
          console.error('Error syncing prices:', error);
          alert('‚ùå Network error during price sync');
        }
      };

      // Sync supplier stock
      const syncSupplierStock = async (supplierId) => {
        try {
          const response = await fetch(`/admin/api/suppliers/${supplierId}/sync-stock`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            }
          });
          const data = await response.json();
          
          if (response.ok) {
            alert(`‚úÖ Stock Sync Successful!\n\n${data.message}\n\nUpdated Products:\n${data.data.filter(r => r.success).map(r => `‚Ä¢ ${r.productName}: ${r.oldStock} ‚Üí ${r.newStock} units`).join('\n')}`);
            // Refresh products data
            fetchProducts();
          } else {
            alert(`‚ùå Stock Sync Failed\n\n${data.message}`);
          }
        } catch (error) {
          console.error('Error syncing stock:', error);
          alert('‚ùå Network error during stock sync');
        }
      };

      // Forward order to suppliers
      const forwardOrderToSuppliers = async (orderId) => {
        try {
          const response = await fetch('/admin/api/suppliers/forward-order', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ orderId })
          });
          const data = await response.json();
          
          if (response.ok) {
            const results = data.data.map(r => 
              `‚Ä¢ ${r.supplierName}: ${r.success ? '‚úÖ Forwarded' : '‚ùå Failed'} (${r.itemCount} items)`
            ).join('\n');
            alert(`üì§ Order Forward Results\n\n${data.message}\n\nSupplier Results:\n${results}`);
          } else {
            alert(`‚ùå Order Forward Failed\n\n${data.message}`);
          }
        } catch (error) {
          console.error('Error forwarding order:', error);
          alert('‚ùå Network error during order forwarding');
        }
      };

      // Update supplier
      const updateSupplier = async (supplierId, supplierData) => {
        try {
          const response = await fetch(`/admin/api/suppliers/${supplierId}`, {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(supplierData)
          });
          const data = await response.json();
          
          if (response.ok) {
            return { success: true, data };
          } else {
            return { success: false, message: data.message };
          }
        } catch (error) {
          console.error('Error updating supplier:', error);
          return { success: false, message: 'Network error during supplier update' };
        }
      };

      // Fetch supplier details with related data
      const fetchSupplierDetails = async (supplierId) => {
        try {
          // Fetch supplier info
          const supplierResponse = await fetch(`/admin/api/suppliers/${supplierId}`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          const supplier = await supplierResponse.json();

          // Fetch products associated with this supplier
          const productsResponse = await fetch(`/admin/api/products?supplierId=${supplierId}`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          const supplierProducts = await productsResponse.json();

          // Fetch orders containing products from this supplier
          const ordersResponse = await fetch(`/admin/api/orders?supplierId=${supplierId}`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          const supplierOrders = await ordersResponse.json();

          return {
            supplier,
            products: supplierProducts || [],
            orders: supplierOrders || [],
            totalProducts: supplierProducts?.length || 0,
            totalOrders: supplierOrders?.length || 0,
            totalRevenue: supplierOrders?.reduce((sum, order) => sum + parseFloat(order.totalAmount || 0), 0) || 0
          };
        } catch (error) {
          console.error('Error fetching supplier details:', error);
          return null;
        }
      };

      // Handle supplier selection
      const handleSupplierSelection = (supplierId, isChecked) => {
        setSelectedSuppliers(prev => {
          if (isChecked) {
            return [...prev, supplierId];
          } else {
            return prev.filter(id => id !== supplierId);
          }
        });
      };

      // Handle select all suppliers
      const handleSelectAllSuppliers = (isChecked) => {
        if (isChecked) {
          setSelectedSuppliers(suppliers.map(s => s.id));
        } else {
          setSelectedSuppliers([]);
        }
      };

      // Perform bulk operations on suppliers
      const performSupplierBulkOperation = async (operation, formData) => {
        try {
          const response = await fetch('/admin/api/suppliers/bulk', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              operation,
              supplierIds: selectedSuppliers,
              ...formData
            })
          });

          const result = await response.json();
          
          if (response.ok) {
            alert(`‚úÖ Bulk operation completed successfully!\n\n${result.message}\nProcessed: ${result.processed} suppliers\nSuccess: ${result.success}\nFailed: ${result.failed}`);
            
            // Refresh suppliers list
            fetchSuppliers();
            
            // Reset selection
            setSelectedSuppliers([]);
            setShowSupplierBulkModal(false);
          } else {
            alert(`‚ùå Bulk operation failed: ${result.message}`);
          }
        } catch (error) {
          console.error('Error performing bulk operation:', error);
          alert('‚ùå Network error during bulk operation');
        }
      };

      const generateProductAnalytics = () => {
        console.log('Generating product analytics with data:', products.length, 'products');
        console.log('Categories available:', categories.length, 'categories');
        
        if (products.length === 0) {
          setAnalyticsData({
            error: 'No products found to analyze'
          });
          return;
        }
        
        // Make sure categories are loaded
        if (categories.length === 0) {
          fetchCategories();
        }

        // Calculate analytics based on actual product data
        const analytics = {
          totalProducts: products.length,
          
          // Category analysis
          categoryBreakdown: categories.reduce((acc, cat) => {
            const categoryProducts = products.filter(p => p.categoryId === cat.id);
            if (categoryProducts.length > 0) {
              acc[cat.name] = {
                count: categoryProducts.length,
                percentage: ((categoryProducts.length / products.length) * 100).toFixed(1)
              };
            }
            return acc;
          }, {}),
          
          // Status analysis
          statusBreakdown: {
            active: products.filter(p => (p.status || 'active') === 'active').length,
            inactive: products.filter(p => p.status === 'inactive').length,
            draft: products.filter(p => p.status === 'draft').length,
            discontinued: products.filter(p => p.status === 'discontinued').length
          },
          
          // Price analysis
          priceAnalysis: (() => {
            const prices = products.map(p => parseFloat(p.price) || 0).filter(p => p > 0);
            if (prices.length === 0) return { avg: 0, min: 0, max: 0 };
            
            return {
              avg: (prices.reduce((sum, p) => sum + p, 0) / prices.length).toFixed(2),
              min: Math.min(...prices).toFixed(2),
              max: Math.max(...prices).toFixed(2)
            };
          })(),
          
          // Stock analysis
          stockAnalysis: {
            totalStock: products.reduce((sum, p) => sum + (p.stockQuantity || 0), 0),
            inStock: products.filter(p => (p.stockQuantity || 0) > 0).length,
            outOfStock: products.filter(p => (p.stockQuantity || 0) === 0).length,
            lowStock: products.filter(p => (p.stockQuantity || 0) > 0 && (p.stockQuantity || 0) < 10).length
          },
          
          // Top products by price
          topPriceProducts: products
            .filter(p => p.price && parseFloat(p.price) > 0)
            .sort((a, b) => parseFloat(b.price) - parseFloat(a.price))
            .slice(0, 5)
            .map(p => ({
              name: p.name,
              price: parseFloat(p.price).toFixed(2),
              category: categories.find(c => c.id === p.categoryId)?.name || 'Unknown'
            })),
          
          // Generated timestamp
          generatedAt: new Date().toLocaleString()
        };

        console.log('Analytics generated:', analytics);
        setAnalyticsData(analytics);
      };

      // CRUD Operations
      const createUser = async (userData) => {
        try {
          const response = await fetch('/admin/api/users', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(userData)
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchUsers(); // Refresh user list
            return { success: true, message: data.message };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      const updateUser = async (userId, userData) => {
        try {
          const response = await fetch(`/admin/api/users/${userId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(userData)
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchUsers(); // Refresh user list
            return { success: true, message: data.message };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      const deleteUser = async (userId) => {
        try {
          const response = await fetch(`/admin/api/users/${userId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchUsers(); // Refresh user list
            return { success: true, message: data.message };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      const createProduct = async (productData) => {
        try {
          const response = await fetch('/admin/api/products', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(productData)
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchProducts(); // Refresh product list
            return { success: true, message: data.message };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      const updateProduct = async (productId, productData) => {
        try {
          const response = await fetch(`/admin/api/products/${productId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(productData)
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchProducts(); // Refresh product list
            return { success: true, message: data.message };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      const deleteProduct = async (productId) => {
        try {
          const response = await fetch(`/admin/api/products/${productId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchProducts(); // Refresh product list
            return { success: true, message: data.message };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      // Download Excel template for bulk product import
      const downloadExcelTemplate = () => {
        // Create sample data structure for Excel template
        const templateData = [
          {
            'Product Name': 'Example Product',
            'Description': 'This is an example product description',
            'Price': '29.99',
            'Stock Quantity': '100',
            'Category ID': '1',
            'Category Name': 'Cleaning & Sanitizing',
            'Status': 'active',
            'VAT %': '19',
            'Product Code': 'KO001',
            'NC Code': '3924100000',
            'CPV Code': '39830000-9',
            'Supplier Name': 'KitchenOff Direct'
          },
          {
            'Product Name': 'Another Product',
            'Description': 'Second example product',
            'Price': '45.50',
            'Stock Quantity': '50',
            'Category ID': '2',
            'Category Name': 'Food Labels',
            'Status': 'active',
            'VAT %': '19',
            'Product Code': 'KO002',
            'NC Code': '4821100000',
            'CPV Code': '30199700-3',
            'Supplier Name': 'KitchenOff Direct'
          }
        ];

        // Create workbook and worksheet
        const ws = XLSX.utils.json_to_sheet(templateData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Products');

        // Add instructions sheet
        const instructionsData = [
          { Field: 'Product Name', Required: 'Yes', Description: 'Unique product name' },
          { Field: 'Description', Required: 'No', Description: 'Product description' },
          { Field: 'Price', Required: 'Yes', Description: 'Product price in decimal format (e.g., 29.99)' },
          { Field: 'Stock Quantity', Required: 'Yes', Description: 'Available stock quantity' },
          { Field: 'Category ID', Required: 'Yes', Description: 'Category ID number from system' },
          { Field: 'Category Name', Required: 'No', Description: 'Category name for reference only' },
          { Field: 'Status', Required: 'No', Description: 'Product status: active, inactive, draft, discontinued' },
          { Field: 'VAT %', Required: 'No', Description: 'VAT percentage (default: 19)' },
          { Field: 'Product Code', Required: 'No', Description: 'Alphanumeric product code' },
          { Field: 'NC Code', Required: 'No', Description: 'Nomenclature code' },
          { Field: 'CPV Code', Required: 'No', Description: 'Common Procurement Vocabulary code' },
          { Field: 'Supplier Name', Required: 'No', Description: 'Supplier name (default: KitchenOff Direct)' }
        ];

        const instructionsWs = XLSX.utils.json_to_sheet(instructionsData);
        XLSX.utils.book_append_sheet(wb, instructionsWs, 'Instructions');

        // Download file
        XLSX.writeFile(wb, 'KitchenOff_Products_Import_Template.xlsx');
        alert('‚úÖ Excel template downloaded successfully!\\n\\nPlease fill in the template with your product data and use "Import from Excel" to upload it.');
      };

      // Import products from Excel file
      const importProductsFromExcel = async (file) => {
        if (!file) {
          alert('Please select an Excel file to import.');
          return;
        }

        try {
          setImportResults({ loading: true });
          
          const formData = new FormData();
          formData.append('excelFile', file);

          const response = await fetch('/admin/api/products/import-excel', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`
            },
            body: formData
          });

          const result = await response.json();

          if (response.ok) {
            setImportResults({
              success: true,
              imported: result.imported || 0,
              errors: result.errors || [],
              duplicates: result.duplicates || [],
              total: result.total || 0
            });
            
            // Refresh products list
            fetchProducts();
            
            alert(`‚úÖ Import completed!\\n\\nImported: ${result.imported}\\nErrors: ${result.errors?.length || 0}\\nDuplicates: ${result.duplicates?.length || 0}`);
          } else {
            setImportResults({
              success: false,
              message: result.message || 'Import failed'
            });
            alert('‚ùå Import failed: ' + (result.message || 'Unknown error'));
          }
        } catch (error) {
          console.error('Error importing Excel:', error);
          setImportResults({
            success: false,
            message: 'Network error during import'
          });
          alert('‚ùå Network error during import');
        }
      };

      const updateOrderStatus = async (orderId, status) => {
        try {
          const response = await fetch(`/admin/api/orders/${orderId}/status`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ status })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchOrders(); // Refresh order list
            return { success: true, message: data.message };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      // AWB Generation Function
      const generateAWB = async (orderId) => {
        try {
          const response = await fetch(`/api/orders/${orderId}/generate-awb`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchOrders(); // Refresh order list to show new AWB
            alert(`‚úÖ AWB Generated Successfully!\\n\\nAWB Number: ${data.awbNumber}\\nCourier: ${data.courier}\\nCost: ${data.cost} ${data.currency}\\n\\nOrder status updated to "shipped"`);
          } else {
            alert(`‚ùå AWB Generation Failed\\n\\nError: ${data.message || 'Unknown error occurred'}`);
          }
        } catch (err) {
          console.error('AWB generation error:', err);
          alert('‚ùå Network error during AWB generation');
        }
      };

      const acceptOrder = async (orderId) => {
        try {
          const response = await fetch(`/admin/api/orders/${orderId}/accept`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchOrders(); // Refresh order list
            return { 
              success: true, 
              message: data.message, 
              notifications: data.notifications 
            };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      const performBulkOperation = async (operation, orderIds, data = {}) => {
        try {
          let endpoint = '';
          let payload = { orderIds, ...data };
          
          switch (operation) {
            case 'status':
              endpoint = '/admin/api/orders/bulk/status';
              break;
            case 'shipping':
              endpoint = '/admin/api/orders/bulk/shipping-labels';
              break;
            case 'notifications':
              endpoint = '/admin/api/orders/bulk/notifications';
              break;
            case 'refunds':
              endpoint = '/admin/api/orders/bulk/refunds';
              break;
            default:
              return { success: false, message: 'Invalid operation' };
          }
          
          const response = await fetch(endpoint, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(payload)
          });
          
          const result = await response.json();
          
          if (response.ok) {
            fetchOrders(); // Refresh order list
            return { success: true, message: result.message, results: result.results };
          } else {
            return { success: false, message: result.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      const performProductBulkOperation = async (operation, productIds, data = {}) => {
        try {
          let endpoint = '';
          let payload = { productIds, ...data };
          
          switch (operation) {
            case 'update-prices':
              endpoint = '/admin/api/products/bulk/prices';
              break;
            case 'update-categories':
              endpoint = '/admin/api/products/bulk/categories';
              break;
            case 'update-status':
              endpoint = '/admin/api/products/bulk/status';
              break;
            case 'update-stock':
              endpoint = '/admin/api/products/bulk/stock';
              break;
            case 'export':
              endpoint = '/admin/api/products/bulk/export';
              break;
            case 'delete':
              endpoint = '/admin/api/products/bulk/delete';
              break;
            default:
              return { success: false, message: 'Invalid operation' };
          }
          
          const response = await fetch(endpoint, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(payload)
          });

      // Category management API functions (fetchCategories moved to global scope)

      const createCategory = async (categoryData) => {
        try {
          const response = await fetch('/admin/api/categories', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(categoryData)
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchCategories(); // Refresh category list
            return { success: true, message: 'Category created successfully' };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      const updateCategory = async (categoryId, categoryData) => {
        try {
          const token = localStorage.getItem('adminToken');
          const response = await fetch(`/admin/api/categories/${categoryId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(categoryData)
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchCategories(); // Refresh category list
            return { success: true, message: 'Category updated successfully' };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };



      const deleteCategory = async (categoryId) => {
        try {
          const token = localStorage.getItem('adminToken');
          const response = await fetch(`/admin/api/categories/${categoryId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchCategories(); // Refresh category list
            return { success: true, message: data.message };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      const updateHomepageCategories = async (mainTopCategories, mainShopCategories) => {
        try {
          const token = localStorage.getItem('adminToken');
          const response = await fetch('/admin/api/categories/bulk/homepage', {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
              mainTopCategories,
              mainShopCategories
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            fetchCategories(); // Refresh category list
            return { success: true, message: data.message };
          } else {
            return { success: false, message: data.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };
          
          const result = await response.json();
          
          if (response.ok) {
            fetchProducts(); // Refresh product list
            return { success: true, message: result.message, results: result.results };
          } else {
            return { success: false, message: result.message };
          }
        } catch (err) {
          return { success: false, message: 'Network error' };
        }
      };

      // Fetch company settings
      const fetchCompanySettings = async () => {
        try {
          const response = await fetch('/admin/api/company-settings', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok && data) {
            setCompanySettings(data);
          } else {
            // Set default values if no company settings exist
            setCompanySettings({
              name: 'KitchenOff',
              email: 'info@kitchen-off.com',
              phone: '+40 123 456 789',
              address: 'Calea Mosilor 158',
              city: 'Bucharest',
              state: 'Bucuresti',
              zipCode: '020883',
              country: 'Romania',
              contactPerson: 'Company Administrator',
              website: 'https://kitchen-off.com',
              vatNumber: '',
              registrationNumber: '',
              defaultCurrency: 'EUR',
              defaultVatPercentage: '19.00',
              reverseChargeVat: '0.00',
              freeShippingThreshold: '500.00',
              standardShippingCost: '25.00',
              description: 'Professional kitchen equipment and supplies for the HORECA industry.'
            });
          }
        } catch (err) {
          console.error('Network error fetching company settings:', err);
        }
      };
      
      // Fetch company defaults for new products
      const fetchCompanyDefaults = async () => {
        try {
          const response = await fetch('/admin/api/company-settings', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok && data) {
            return {
              currency: data.defaultCurrency || 'EUR',
              vatPercentage: data.defaultVatPercentage || '19.00'
            };
          }
        } catch (err) {
          console.error('Error fetching company defaults:', err);
        }
        
        // Return defaults if fetch fails
        return {
          currency: 'EUR',
          vatPercentage: '19.00'
        };
      };

      // Currency conversion rates (approximate)
      const exchangeRates = {
        'EUR': { 'RON': 4.95, 'USD': 1.10, 'GBP': 0.86 },
        'RON': { 'EUR': 0.20, 'USD': 0.22, 'GBP': 0.17 },
        'USD': { 'EUR': 0.91, 'RON': 4.50, 'GBP': 0.78 },
        'GBP': { 'EUR': 1.16, 'RON': 5.88, 'USD': 1.28 }
      };

      // Handle currency change for shipping values
      const handleCurrencyChange = (event) => {
        const newCurrency = event.target.value;
        const currentCurrency = companySettings.defaultCurrency || 'EUR';
        
        if (newCurrency === currentCurrency) return;
        
        const form = event.target.closest('form');
        const shippingThresholdInput = form.querySelector('input[name="freeShippingThreshold"]');
        const shippingCostInput = form.querySelector('input[name="standardShippingCost"]');
        
        if (shippingThresholdInput && shippingCostInput) {
          const currentThreshold = parseFloat(shippingThresholdInput.value) || 500;
          const currentCost = parseFloat(shippingCostInput.value) || 25;
          
          // Convert values to new currency
          const rate = exchangeRates[currentCurrency]?.[newCurrency] || 1;
          const newThreshold = (currentThreshold * rate).toFixed(2);
          const newCost = (currentCost * rate).toFixed(2);
          
          shippingThresholdInput.value = newThreshold;
          shippingCostInput.value = newCost;
          
          // Update shipping threshold label
          const thresholdLabel = shippingThresholdInput.parentNode.querySelector('label');
          if (thresholdLabel) {
            thresholdLabel.innerHTML = `Free Shipping Threshold (${newCurrency})`;
          }
          
          // Update shipping cost label
          const costLabel = shippingCostInput.parentNode.querySelector('label');
          if (costLabel) {
            costLabel.innerHTML = `Standard Shipping Cost (${newCurrency})`;
          }
          
          console.log(`Currency changed from ${currentCurrency} to ${newCurrency}: Threshold ${currentThreshold} ‚Üí ${newThreshold}, Cost ${currentCost} ‚Üí ${newCost}`);
        }
      };

      // Update company settings
      const updateCompanySettings = async (settingsData) => {
        try {
          const response = await fetch('/admin/api/company-settings', {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(settingsData)
          });
          
          const data = await response.json();
          
          if (response.ok) {
            return { success: true, message: 'Company settings updated successfully' };
          } else {
            return { success: false, message: data.message || 'Failed to update company settings' };
          }
        } catch (error) {
          console.error('Error updating company settings:', error);
          return { success: false, message: 'Network error. Please try again.' };
        }
      };

      const handleViewChange = (view) => {
        setActiveView(view);
        if (view === 'users' && users.length === 0) {
          fetchUsers();
        } else if (view === 'orders' && orders.length === 0) {
          fetchOrders();
        } else if (view === 'products') {
          if (products.length === 0) {
            fetchProducts();
          }
          if (suppliers.length === 0) {
            fetchSuppliers();
          }
        } else if (view === 'categories' && categories.length === 0) {
          fetchCategories();
        } else if (view === 'suppliers' && suppliers.length === 0) {
          fetchSuppliers();
        } else if (view === 'company-settings') {
          fetchCompanySettings();
        }
      };
      
      const handleLogout = async () => {
        try {
          await fetch('/admin/api/logout', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
        } catch (err) {
          console.error('Logout error:', err);
        } finally {
          // Clear all admin session data
          localStorage.removeItem('adminToken');
          localStorage.removeItem('adminUser');
          // Force page reload to ensure clean state
          window.location.reload();
        }
      };
      
      if (loading) {
        return (
          <div className="container">
            <div className="text-center">
              <div className="loading"></div>
              <p>Loading dashboard...</p>
            </div>
          </div>
        );
      }
      
      if (error) {
        return (
          <div className="container">
            <div className="error-message">{error}</div>
            <button onClick={handleLogout} className="btn btn-secondary">
              Logout
            </button>
          </div>
        );
      }
      
      const renderContent = () => {
        switch (activeView) {
          case 'orders':
            return (
              <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                  <h3 style={{color: '#333', margin: '0'}}>üìã Order Management</h3>
                  <div style={{display: 'flex', gap: '10px'}}>
                    <button 
                      className="btn" 
                      style={{background: '#17a2b8', width: 'auto', padding: '8px 16px'}}
                      onClick={() => alert('Export orders functionality:\n\n‚Ä¢ Export to CSV/Excel\n‚Ä¢ Filter by date range\n‚Ä¢ Include customer details\n‚Ä¢ Sales reports\n‚Ä¢ Tax documentation')}
                    >
                      üìä Export Orders
                    </button>
                    <button 
                      className="btn" 
                      style={{background: '#6c757d', width: 'auto', padding: '8px 16px'}}
                      onClick={() => alert('Order analytics:\n\n‚Ä¢ Sales performance\n‚Ä¢ Revenue trends\n‚Ä¢ Customer behavior\n‚Ä¢ Popular products\n‚Ä¢ Seasonal patterns')}
                    >
                      üìà Analytics
                    </button>
                  </div>
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <h4 style={{color: '#333', marginBottom: '15px'}}>Order Actions</h4>
                  <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                    <button 
                      className="btn" 
                      style={{background: '#007bff', width: 'auto', padding: '8px 16px'}}
                      onClick={() => setShowSearchFilter(!showSearchFilter)}
                    >
                      üîç Search & Filter
                    </button>
                    <button 
                      className="btn" 
                      style={{background: '#28a745', width: 'auto', padding: '8px 16px'}}
                      onClick={() => {
                        if (selectedOrders.length === 0) {
                          alert('Please select orders first by checking the checkboxes.');
                          return;
                        }
                        setBulkOperation('status');
                        setShowBulkModal(true);
                      }}
                    >
                      üîÑ Bulk Operations
                    </button>
                    <button 
                      className="btn" 
                      style={{background: '#dc3545', width: 'auto', padding: '8px 16px'}}
                      onClick={() => {
                        if (selectedOrders.length === 0) {
                          alert('Please select orders first by checking the checkboxes.');
                          return;
                        }
                        setShowOrderTools(true);
                      }}
                    >
                      üõ†Ô∏è Order Tools
                    </button>
                  </div>
                </div>
                
                {showSearchFilter && (
                  <div style={{background: '#f8f9fa', padding: '20px', borderRadius: '8px', marginBottom: '20px', border: '1px solid #dee2e6'}}>
                    <h4 style={{color: '#333', marginBottom: '15px'}}>üîç Search & Filter Orders</h4>
                    <div style={{display: 'flex', gap: '15px', flexWrap: 'wrap', alignItems: 'center'}}>
                      <div style={{flex: '1', minWidth: '200px'}}>
                        <input
                          type="text"
                          placeholder="Search by order ID, customer name, or city..."
                          value={searchTerm}
                          onChange={(e) => setSearchTerm(e.target.value)}
                          style={{
                            width: '100%',
                            padding: '10px',
                            borderRadius: '4px',
                            border: '1px solid #ddd',
                            fontSize: '14px'
                          }}
                        />
                      </div>
                      <div style={{minWidth: '150px'}}>
                        <select
                          value={statusFilter}
                          onChange={(e) => setStatusFilter(e.target.value)}
                          style={{
                            width: '100%',
                            padding: '10px',
                            borderRadius: '4px',
                            border: '1px solid #ddd',
                            fontSize: '14px'
                          }}
                        >
                          <option value="all">All Status</option>
                          <option value="pending">Pending</option>
                          <option value="accepted">Accepted</option>
                          <option value="processing">Processing</option>
                          <option value="shipped">Shipped</option>
                          <option value="delivered">Delivered</option>
                          <option value="cancelled">Cancelled</option>
                        </select>
                      </div>
                      <button
                        className="btn"
                        style={{background: '#6c757d', width: 'auto', padding: '8px 16px'}}
                        onClick={() => {
                          setSearchTerm('');
                          setStatusFilter('all');
                        }}
                      >
                        Clear
                      </button>
                    </div>
                    <div style={{marginTop: '10px', color: '#666', fontSize: '14px'}}>
                      Showing {filteredOrders.length} of {orders.length} orders
                    </div>
                  </div>
                )}
                
                {orders.length > 0 ? (
                  <div style={{overflowX: 'auto'}}>
                    <table style={{width: '100%', borderCollapse: 'collapse'}}>
                      <thead>
                        <tr style={{backgroundColor: '#f5f5f5'}}>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>
                            <input 
                              type="checkbox" 
                              onChange={(e) => {
                                if (e.target.checked) {
                                  setSelectedOrders(filteredOrders.map(order => order.id));
                                } else {
                                  setSelectedOrders([]);
                                }
                              }}
                              checked={selectedOrders.length === filteredOrders.length && filteredOrders.length > 0}
                              style={{marginRight: '8px'}}
                            />
                            Select
                          </th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Order ID</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Customer</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Amount</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Status</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Date</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {filteredOrders.slice(0, 10).map((order, index) => (
                          <tr key={index} style={{borderBottom: '1px solid #eee'}}>
                            <td style={{padding: '12px'}}>
                              <input 
                                type="checkbox" 
                                checked={selectedOrders.includes(order.id)}
                                onChange={(e) => {
                                  if (e.target.checked) {
                                    setSelectedOrders([...selectedOrders, order.id]);
                                  } else {
                                    setSelectedOrders(selectedOrders.filter(id => id !== order.id));
                                  }
                                }}
                              />
                            </td>
                            <td style={{padding: '12px', fontWeight: '500'}}>#{order.id}</td>
                            <td style={{padding: '12px'}}>User #{order.userId}</td>
                            <td style={{padding: '12px', color: '#28a745', fontWeight: 'bold'}}>${order.totalAmount}</td>
                            <td style={{padding: '12px'}}>
                              <span style={{
                                padding: '4px 8px', 
                                borderRadius: '4px', 
                                backgroundColor: order.status === 'pending' ? '#fff3cd' : 
                                                order.status === 'accepted' ? '#d1ecf1' : 
                                                order.status === 'processing' ? '#cce5ff' : 
                                                order.status === 'shipped' ? '#d4edda' : 
                                                order.status === 'delivered' ? '#d4edda' : 
                                                order.status === 'cancelled' ? '#f8d7da' : '#e2e3e5',
                                color: order.status === 'pending' ? '#856404' : 
                                       order.status === 'accepted' ? '#0c5460' : 
                                       order.status === 'processing' ? '#0056b3' : 
                                       order.status === 'shipped' ? '#155724' : 
                                       order.status === 'delivered' ? '#155724' : 
                                       order.status === 'cancelled' ? '#721c24' : '#383d41'
                              }}>
                                {order.status}
                              </span>
                            </td>
                            <td style={{padding: '12px'}}>{new Date(order.createdAt).toLocaleDateString()}</td>
                            <td style={{padding: '12px'}}>
                              <div style={{display: 'flex', gap: '5px', flexWrap: 'wrap'}}>
                                <button 
                                  style={{
                                    padding: '4px 8px', 
                                    border: 'none', 
                                    borderRadius: '3px', 
                                    backgroundColor: '#007bff', 
                                    color: 'white', 
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={() => {
                                    setSelectedOrder(order);
                                    setShowOrderDetails(true);
                                  }}
                                >
                                  üëÅÔ∏è View
                                </button>
                                {order.status === 'pending' && (
                                  <button 
                                    style={{
                                      padding: '4px 8px', 
                                      border: 'none', 
                                      borderRadius: '3px', 
                                      backgroundColor: '#17a2b8', 
                                      color: 'white', 
                                      cursor: 'pointer',
                                      fontSize: '12px'
                                    }}
                                    onClick={async () => {
                                      if (confirm(`Accept order #${order.id}?\n\nThis will:\n‚Ä¢ Update order status to 'accepted'\n‚Ä¢ Send confirmation email to customer\n‚Ä¢ Send notification to logistics team`)) {
                                        const result = await acceptOrder(order.id);
                                        if (result.success) {
                                          let message = 'Order accepted successfully!';
                                          if (result.notifications) {
                                            message += '\n\nEmail notifications:';
                                            message += result.notifications.customerEmail ? '\n‚úÖ Customer confirmation sent' : '\n‚ùå Customer email failed';
                                            message += result.notifications.logisticsEmail ? '\n‚úÖ Logistics notification sent' : '\n‚ùå Logistics email failed';
                                          }
                                          alert(message);
                                        } else {
                                          alert('Error: ' + result.message);
                                        }
                                      }
                                    }}
                                  >
                                    ‚úÖ Accept
                                  </button>
                                )}
                                {order.status === 'processing' && !order.awbNumber && (
                                  <button 
                                    style={{
                                      padding: '4px 8px', 
                                      border: 'none', 
                                      borderRadius: '3px', 
                                      backgroundColor: '#8e44ad', 
                                      color: 'white', 
                                      cursor: 'pointer',
                                      fontSize: '12px'
                                    }}
                                    onClick={() => generateAWB(order.id)}
                                  >
                                    üöõ Generate AWB
                                  </button>
                                )}
                                {order.awbNumber && (
                                  <button 
                                    style={{
                                      padding: '4px 8px', 
                                      border: 'none', 
                                      borderRadius: '3px', 
                                      backgroundColor: '#17a2b8', 
                                      color: 'white', 
                                      cursor: 'pointer',
                                      fontSize: '12px'
                                    }}
                                    onClick={() => window.open(`https://sameday.ro/track/${order.awbNumber}`, '_blank')}
                                  >
                                    üì¶ Track Package
                                  </button>
                                )}
                                <button 
                                  style={{
                                    padding: '4px 8px', 
                                    border: 'none', 
                                    borderRadius: '3px', 
                                    backgroundColor: '#fd7e14', 
                                    color: 'white', 
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={() => forwardOrderToSuppliers(order.id)}
                                >
                                  üì§ Forward to Suppliers
                                </button>
                                <button 
                                  style={{
                                    padding: '4px 8px', 
                                    border: 'none', 
                                    borderRadius: '3px', 
                                    backgroundColor: '#28a745', 
                                    color: 'white', 
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={async () => {
                                    const newStatus = prompt(`Update order status for Order #${order.id}:\n\nCurrent status: ${order.status}\n\nEnter new status (pending, accepted, processing, shipped, delivered, cancelled):`);
                                    if (newStatus && ['pending', 'accepted', 'processing', 'shipped', 'delivered', 'cancelled'].includes(newStatus.toLowerCase())) {
                                      const result = await updateOrderStatus(order.id, newStatus.toLowerCase());
                                      if (result.success) {
                                        alert('Order status updated successfully');
                                      } else {
                                        alert('Error: ' + result.message);
                                      }
                                    } else if (newStatus) {
                                      alert('Invalid status. Please use: pending, accepted, processing, shipped, delivered, or cancelled');
                                    }
                                  }}
                                >
                                  ‚úèÔ∏è Update
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                ) : (
                  <div style={{padding: '40px', textAlign: 'center', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <p style={{color: '#666', fontSize: '18px', marginBottom: '15px'}}>No orders found</p>
                    <p style={{color: '#6c757d', marginBottom: '20px'}}>Orders will appear here once customers start purchasing your products.</p>
                    <button 
                      className="btn" 
                      style={{background: '#007bff', width: 'auto', padding: '12px 24px'}}
                      onClick={() => setActiveView('dashboard')}
                    >
                      üìä View Dashboard
                    </button>
                  </div>
                )}
              </div>
            );
          
          case 'users':
            return (
              <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                  <h3 style={{color: '#333', margin: '0'}}>üë• User Management</h3>
                  <button 
                    className="btn" 
                    style={{background: '#28a745', width: 'auto', padding: '8px 16px'}}
                    onClick={() => setShowAddUserModal(true)}
                  >
                    ‚ûï Add New User
                  </button>
                </div>
                
                <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px', marginBottom: '20px'}}>
                  <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{marginBottom: '10px', color: '#495057'}}>Total Users</h4>
                    <p style={{fontSize: '24px', fontWeight: 'bold', color: '#007bff', margin: '0'}}>{stats?.totalUsers || '0'}</p>
                  </div>
                  <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{marginBottom: '10px', color: '#495057'}}>Regular Users</h4>
                    <p style={{fontSize: '24px', fontWeight: 'bold', color: '#28a745', margin: '0'}}>{users.filter(u => !u.isAdmin).length}</p>
                  </div>
                  <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{marginBottom: '10px', color: '#495057'}}>Admin Users</h4>
                    <p style={{fontSize: '24px', fontWeight: 'bold', color: '#dc3545', margin: '0'}}>{users.filter(u => u.isAdmin).length}</p>
                  </div>
                </div>
                
                {users.length > 0 ? (
                  <div style={{overflowX: 'auto'}}>
                    <table style={{width: '100%', borderCollapse: 'collapse'}}>
                      <thead>
                        <tr style={{backgroundColor: '#f5f5f5'}}>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>User ID</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Name</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Email</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Role</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {users.map((user, index) => (
                          <tr key={index} style={{borderBottom: '1px solid #eee'}}>
                            <td style={{padding: '12px'}}>#{user.id}</td>
                            <td style={{padding: '12px', fontWeight: '500'}}>{user.firstName} {user.lastName}</td>
                            <td style={{padding: '12px'}}>{user.email}</td>
                            <td style={{padding: '12px'}}>
                              <span style={{
                                padding: '4px 8px', 
                                borderRadius: '4px', 
                                backgroundColor: user.isAdmin ? '#f8d7da' : '#d4edda',
                                color: user.isAdmin ? '#721c24' : '#155724'
                              }}>
                                {user.isAdmin ? 'Admin' : 'User'}
                              </span>
                            </td>
                            <td style={{padding: '12px'}}>
                              <div style={{display: 'flex', gap: '5px'}}>
                                <button 
                                  style={{
                                    padding: '4px 8px', 
                                    border: 'none', 
                                    borderRadius: '3px', 
                                    backgroundColor: '#007bff', 
                                    color: 'white', 
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={() => setEditingUser(user)}
                                >
                                  ‚úèÔ∏è Edit
                                </button>
                                <button 
                                  style={{
                                    padding: '4px 8px', 
                                    border: 'none', 
                                    borderRadius: '3px', 
                                    backgroundColor: '#dc3545', 
                                    color: 'white', 
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={async () => {
                                    if (confirm(`Delete user "${user.firstName} ${user.lastName}"?\n\nThis action cannot be undone.`)) {
                                      const result = await deleteUser(user.id);
                                      if (result.success) {
                                        alert('User deleted successfully');
                                      } else {
                                        alert('Error: ' + result.message);
                                      }
                                    }
                                  }}
                                >
                                  üóëÔ∏è Delete
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                ) : (
                  <div style={{padding: '40px', textAlign: 'center', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <p style={{color: '#666', fontSize: '18px', marginBottom: '15px'}}>No users found</p>
                    <p style={{color: '#6c757d', marginBottom: '20px'}}>Create your first user to get started with user management.</p>
                    <button 
                      className="btn" 
                      style={{background: '#28a745', width: 'auto', padding: '12px 24px'}}
                      onClick={() => setShowAddUserModal(true)}
                    >
                      ‚ûï Add Your First User
                    </button>
                  </div>
                )}
              </div>
            );
          
          case 'products':
            return (
              <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                  <h3 style={{color: '#333', margin: '0'}}>üì¶ Product Management</h3>
                  <div style={{display: 'flex', gap: '10px'}}>
                    <button 
                      className="btn" 
                      style={{background: '#fd7e14', width: 'auto', padding: '8px 16px'}}
                      onClick={() => setShowExcelImportModal(true)}
                    >
                      üì§ Import from Excel
                    </button>
                    <button 
                      className="btn" 
                      style={{background: '#28a745', width: 'auto', padding: '8px 16px'}}
                      onClick={async () => {
                        fetchCategories();
                        fetchSuppliers();
                        
                        // Fetch company defaults and pre-populate form
                        const defaults = await fetchCompanyDefaults();
                        console.log('Company defaults loaded:', defaults);
                        console.log('Setting currency to:', defaults.currency);
                        console.log('Setting VAT to:', defaults.vatPercentage);
                        setEditingProduct({
                          name: '',
                          description: '',
                          price: '',
                          compareAtPrice: '',
                          stockQuantity: '',
                          categoryId: '',
                          slug: '',
                          images: [],
                          productCode: '',
                          ncCode: '',
                          cpvCode: '',
                          vatPercentage: defaults.vatPercentage,
                          currency: defaults.currency,
                          supplierId: '',
                          status: 'active'
                        });
                        
                        // Also set the productFormData to match
                        setProductFormData({
                          name: '',
                          description: '',
                          price: '',
                          compareAtPrice: '',
                          categoryId: '',
                          supplierId: '',
                          imageUrl: '',
                          stockQuantity: '',
                          featured: false,
                          vatValue: '',
                          vatPercentage: defaults.vatPercentage,
                          currency: defaults.currency,
                          productCode: '',
                          ncCode: '',
                          cpvCode: '',
                          status: 'active',
                          images: []
                        });
                        
                        setShowAddProductModal(true);
                      }}
                    >
                      ‚ûï Add New Product
                    </button>
                  </div>
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <h4 style={{color: '#333', marginBottom: '15px'}}>Product Actions</h4>
                  <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                    <button 
                      className="btn" 
                      style={{background: '#007bff', width: 'auto', padding: '8px 16px'}}
                      onClick={() => {
                        if (selectedProducts.length === 0) {
                          alert('Please select products first by checking the boxes in the product list.');
                          return;
                        }
                        setShowProductBulkModal(true);
                      }}
                      disabled={selectedProducts.length === 0}
                    >
                      üîÑ Bulk Operations {selectedProducts.length > 0 && `(${selectedProducts.length})`}
                    </button>
                    <button 
                      className="btn" 
                      style={{background: '#17a2b8', width: 'auto', padding: '8px 16px'}}
                      onClick={() => {
                        setShowProductSearchFilter(!showProductSearchFilter);
                        if (!showProductSearchFilter) {
                          fetchCategories(); // Fetch categories when opening search filter
                        }
                        console.log('Product search filter toggled:', !showProductSearchFilter);
                      }}
                    >
                      üîç Search & Filter
                    </button>
                    <button 
                      className="btn" 
                      style={{background: '#6c757d', width: 'auto', padding: '8px 16px'}}
                      onClick={() => {
                        setShowProductAnalytics(!showProductAnalytics);
                        if (!showProductAnalytics) {
                          generateProductAnalytics();
                        }
                        console.log('Product analytics toggled:', !showProductAnalytics);
                      }}
                    >
                      üìä Analytics
                    </button>
                    <button 
                      className="btn" 
                      style={{background: '#28a745', width: 'auto', padding: '8px 16px'}}
                      onClick={downloadExcelTemplate}
                    >
                      üì• Download Excel Template
                    </button>
                  </div>
                </div>
                
                {showProductSearchFilter && (
                  <div style={{background: '#f8f9fa', padding: '20px', borderRadius: '6px', marginBottom: '20px', border: '1px solid #dee2e6'}}>
                    <h4 style={{color: '#333', marginBottom: '15px'}}>üîç Search & Filter Products</h4>
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', marginBottom: '15px'}}>
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: '500'}}>Search Products:</label>
                        <input 
                          type="text" 
                          placeholder="Search by name, ID, category, or description..."
                          value={productSearchTerm}
                          onChange={(e) => {
                            setProductSearchTerm(e.target.value);
                            console.log('Product search term changed:', e.target.value);
                          }}
                          style={{width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px'}}
                        />
                      </div>
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: '500'}}>Category:</label>
                        <select 
                          value={productCategoryFilter}
                          onChange={(e) => setProductCategoryFilter(e.target.value)}
                          style={{width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px'}}
                        >
                          <option value="all">All Categories</option>
                          {categories.map(cat => (
                            <option key={cat.id} value={cat.id}>{cat.name}</option>
                          ))}
                        </select>
                      </div>
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: '500'}}>Status:</label>
                        <select 
                          value={productStatusFilter}
                          onChange={(e) => setProductStatusFilter(e.target.value)}
                          style={{width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px'}}
                        >
                          <option value="all">All Status</option>
                          <option value="active">Active</option>
                          <option value="inactive">Inactive</option>
                          <option value="draft">Draft</option>
                          <option value="discontinued">Discontinued</option>
                        </select>
                      </div>
                    </div>
                    <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                      <button 
                        className="btn" 
                        style={{background: '#28a745', width: 'auto', padding: '6px 12px', fontSize: '14px'}}
                        onClick={() => {
                          console.log('Search applied with filters:', {
                            searchTerm: productSearchTerm,
                            categoryFilter: productCategoryFilter,
                            statusFilter: productStatusFilter
                          });
                          alert(`Search applied! Found ${filteredProducts.length} products out of ${products.length} total.`);
                        }}
                      >
                        ‚úÖ Apply Search
                      </button>
                      <button 
                        className="btn" 
                        style={{background: '#6c757d', width: 'auto', padding: '6px 12px', fontSize: '14px'}}
                        onClick={() => {
                          setProductSearchTerm('');
                          setProductCategoryFilter('all');
                          setProductStatusFilter('all');
                          console.log('Product filters cleared');
                        }}
                      >
                        üóëÔ∏è Clear Filters
                      </button>
                    </div>
                    <div style={{marginTop: '10px', fontSize: '14px', color: '#666'}}>
                      Showing {filteredProducts.length} of {products.length} products
                    </div>
                  </div>
                )}
                
                {showProductAnalytics && (
                  <div style={{background: '#f8f9fa', padding: '20px', borderRadius: '6px', marginBottom: '20px', border: '1px solid #dee2e6'}}>
                    <h4 style={{color: '#333', marginBottom: '20px'}}>üìä Product Analytics Dashboard</h4>
                    
                    {analyticsData && !analyticsData.error ? (
                      <div>
                        {/* Overview Stats */}
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', marginBottom: '25px'}}>
                          <div style={{background: 'white', padding: '20px', borderRadius: '8px', textAlign: 'center', boxShadow: '0 2px 4px rgba(0,0,0,0.1)'}}>
                            <h5 style={{color: '#007bff', fontSize: '28px', margin: '0 0 10px 0'}}>{analyticsData.totalProducts}</h5>
                            <p style={{color: '#666', margin: '0', fontSize: '14px'}}>Total Products</p>
                          </div>
                          <div style={{background: 'white', padding: '20px', borderRadius: '8px', textAlign: 'center', boxShadow: '0 2px 4px rgba(0,0,0,0.1)'}}>
                            <h5 style={{color: '#28a745', fontSize: '28px', margin: '0 0 10px 0'}}>{analyticsData.stockAnalysis.inStock}</h5>
                            <p style={{color: '#666', margin: '0', fontSize: '14px'}}>In Stock</p>
                          </div>
                          <div style={{background: 'white', padding: '20px', borderRadius: '8px', textAlign: 'center', boxShadow: '0 2px 4px rgba(0,0,0,0.1)'}}>
                            <h5 style={{color: '#ffc107', fontSize: '28px', margin: '0 0 10px 0'}}>{analyticsData.stockAnalysis.lowStock}</h5>
                            <p style={{color: '#666', margin: '0', fontSize: '14px'}}>Low Stock</p>
                          </div>
                          <div style={{background: 'white', padding: '20px', borderRadius: '8px', textAlign: 'center', boxShadow: '0 2px 4px rgba(0,0,0,0.1)'}}>
                            <h5 style={{color: '#dc3545', fontSize: '28px', margin: '0 0 10px 0'}}>{analyticsData.stockAnalysis.outOfStock}</h5>
                            <p style={{color: '#666', margin: '0', fontSize: '14px'}}>Out of Stock</p>
                          </div>
                        </div>

                        {/* Category Breakdown */}
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '25px'}}>
                          <div style={{background: 'white', padding: '20px', borderRadius: '8px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)'}}>
                            <h5 style={{color: '#333', marginBottom: '15px', fontSize: '16px'}}>üìÇ Products by Category</h5>
                            {Object.entries(analyticsData.categoryBreakdown).map(([category, data]) => (
                              <div key={category} style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px', padding: '8px', background: '#f8f9fa', borderRadius: '4px'}}>
                                <span style={{fontSize: '14px', color: '#333'}}>{category}</span>
                                <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                                  <span style={{fontSize: '14px', fontWeight: 'bold', color: '#007bff'}}>{data.count}</span>
                                  <span style={{fontSize: '12px', color: '#666', background: '#e9ecef', padding: '2px 8px', borderRadius: '12px'}}>{data.percentage}%</span>
                                </div>
                              </div>
                            ))}
                          </div>
                          
                          <div style={{background: 'white', padding: '20px', borderRadius: '8px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)'}}>
                            <h5 style={{color: '#333', marginBottom: '15px', fontSize: '16px'}}>üìà Status Distribution</h5>
                            {Object.entries(analyticsData.statusBreakdown).map(([status, count]) => (
                              <div key={status} style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px', padding: '8px', background: '#f8f9fa', borderRadius: '4px'}}>
                                <span style={{fontSize: '14px', color: '#333', textTransform: 'capitalize'}}>{status}</span>
                                <span style={{fontSize: '14px', fontWeight: 'bold', color: status === 'active' ? '#28a745' : status === 'inactive' ? '#6c757d' : status === 'draft' ? '#ffc107' : '#dc3545'}}>{count}</span>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* Price Analysis */}
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '25px'}}>
                          <div style={{background: 'white', padding: '20px', borderRadius: '8px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)'}}>
                            <h5 style={{color: '#333', marginBottom: '15px', fontSize: '16px'}}>üí∞ Price Analysis</h5>
                            <div style={{display: 'flex', flexDirection: 'column', gap: '10px'}}>
                              <div style={{display: 'flex', justifyContent: 'space-between', padding: '8px', background: '#f8f9fa', borderRadius: '4px'}}>
                                <span style={{fontSize: '14px', color: '#333'}}>Average Price</span>
                                <span style={{fontSize: '14px', fontWeight: 'bold', color: '#007bff'}}>${analyticsData.priceAnalysis.avg}</span>
                              </div>
                              <div style={{display: 'flex', justifyContent: 'space-between', padding: '8px', background: '#f8f9fa', borderRadius: '4px'}}>
                                <span style={{fontSize: '14px', color: '#333'}}>Lowest Price</span>
                                <span style={{fontSize: '14px', fontWeight: 'bold', color: '#28a745'}}>${analyticsData.priceAnalysis.min}</span>
                              </div>
                              <div style={{display: 'flex', justifyContent: 'space-between', padding: '8px', background: '#f8f9fa', borderRadius: '4px'}}>
                                <span style={{fontSize: '14px', color: '#333'}}>Highest Price</span>
                                <span style={{fontSize: '14px', fontWeight: 'bold', color: '#dc3545'}}>${analyticsData.priceAnalysis.max}</span>
                              </div>
                            </div>
                          </div>
                          
                          <div style={{background: 'white', padding: '20px', borderRadius: '8px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)'}}>
                            <h5 style={{color: '#333', marginBottom: '15px', fontSize: '16px'}}>üèÜ Top Products by Price</h5>
                            {analyticsData.topPriceProducts.length > 0 ? (
                              <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                                {analyticsData.topPriceProducts.map((product, index) => (
                                  <div key={index} style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '8px', background: '#f8f9fa', borderRadius: '4px'}}>
                                    <div style={{display: 'flex', flexDirection: 'column'}}>
                                      <span style={{fontSize: '13px', fontWeight: '500', color: '#333'}}>{product.name}</span>
                                      <span style={{fontSize: '12px', color: '#666'}}>{product.category}</span>
                                    </div>
                                    <span style={{fontSize: '14px', fontWeight: 'bold', color: '#007bff'}}>{product.price} lei</span>
                                  </div>
                                ))}
                              </div>
                            ) : (
                              <p style={{color: '#666', fontSize: '14px', textAlign: 'center', margin: '20px 0'}}>No products with prices found</p>
                            )}
                          </div>
                        </div>

                        {/* Generated timestamp */}
                        <div style={{textAlign: 'center', marginTop: '20px', padding: '10px', background: '#e9ecef', borderRadius: '4px'}}>
                          <p style={{color: '#666', fontSize: '12px', margin: '0'}}>Analytics generated at: {analyticsData.generatedAt}</p>
                        </div>
                      </div>
                    ) : analyticsData && analyticsData.error ? (
                      <div style={{textAlign: 'center', padding: '40px', color: '#dc3545'}}>
                        <h5>Error: {analyticsData.error}</h5>
                        <p>Please make sure products are loaded and try again.</p>
                      </div>
                    ) : (
                      <div style={{textAlign: 'center', padding: '40px'}}>
                        <div className="loading"></div>
                        <p style={{color: '#666', marginTop: '10px'}}>Generating analytics...</p>
                      </div>
                    )}
                    
                    <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                      <button 
                        className="btn" 
                        style={{background: '#28a745', width: 'auto', padding: '6px 12px', fontSize: '14px'}}
                        onClick={() => {
                          generateProductAnalytics();
                          console.log('Analytics refreshed');
                        }}
                      >
                        üîÑ Refresh Analytics
                      </button>
                      <button 
                        className="btn" 
                        style={{background: '#6c757d', width: 'auto', padding: '6px 12px', fontSize: '14px'}}
                        onClick={() => {
                          setShowProductAnalytics(false);
                          console.log('Analytics closed');
                        }}
                      >
                        ‚úñÔ∏è Close
                      </button>
                    </div>
                  </div>
                )}
                
                {(showProductSearchFilter ? filteredProducts : products).length > 0 ? (
                  <div style={{overflowX: 'auto'}}>
                    <table style={{width: '100%', borderCollapse: 'collapse'}}>
                      <thead>
                        <tr style={{backgroundColor: '#f5f5f5'}}>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd', width: '50px'}}>
                            <input 
                              type="checkbox" 
                              checked={selectedProducts.length === (showProductSearchFilter ? filteredProducts : products).length && (showProductSearchFilter ? filteredProducts : products).length > 0}
                              onChange={(e) => {
                                const currentProducts = showProductSearchFilter ? filteredProducts : products;
                                if (e.target.checked) {
                                  setSelectedProducts(currentProducts.map(p => p.id));
                                } else {
                                  setSelectedProducts([]);
                                }
                              }}
                            />
                          </th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Image</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Product ID</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Name</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Price</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Category</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Stock</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Status</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>VAT %</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Currency</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Product Code</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>NC Code</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>CPV Code</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {(showProductSearchFilter ? filteredProducts : products).slice(0, 10).map((product, index) => (
                          <tr key={index} style={{borderBottom: '1px solid #eee'}}>
                            <td style={{padding: '12px', textAlign: 'center'}}>
                              <input 
                                type="checkbox" 
                                checked={selectedProducts.includes(product.id)}
                                onChange={(e) => {
                                  if (e.target.checked) {
                                    setSelectedProducts([...selectedProducts, product.id]);
                                  } else {
                                    setSelectedProducts(selectedProducts.filter(id => id !== product.id));
                                  }
                                }}
                              />
                            </td>
                            <td style={{padding: '12px'}}>
                              <div style={{position: 'relative', display: 'inline-block'}}>
                                {product.images && product.images.length > 0 ? (
                                  <>
                                    <img 
                                      src={product.images[0].thumbnailUrl || product.images[0].url} 
                                      alt={product.name}
                                      style={{
                                        width: '50px',
                                        height: '50px',
                                        objectFit: 'cover',
                                        borderRadius: '6px',
                                        border: '1px solid #ddd'
                                      }}
                                    />
                                    {product.images.length > 1 && (
                                      <span style={{
                                        position: 'absolute',
                                        top: '-5px',
                                        right: '-5px',
                                        backgroundColor: '#007bff',
                                        color: 'white',
                                        borderRadius: '50%',
                                        width: '20px',
                                        height: '20px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontSize: '10px',
                                        fontWeight: 'bold',
                                        border: '2px solid white'
                                      }}>
                                        {product.images.length}
                                      </span>
                                    )}
                                  </>
                                ) : product.imageUrl ? (
                                  <img 
                                    src={product.imageUrl} 
                                    alt={product.name}
                                    style={{
                                      width: '50px',
                                      height: '50px',
                                      objectFit: 'cover',
                                      borderRadius: '6px',
                                      border: '1px solid #ddd'
                                    }}
                                  />
                                ) : (
                                  <div style={{
                                    width: '50px',
                                    height: '50px',
                                    backgroundColor: '#f8f9fa',
                                    border: '1px solid #ddd',
                                    borderRadius: '6px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    color: '#6c757d',
                                    fontSize: '12px'
                                  }}>
                                    üì∑
                                  </div>
                                )}
                              </div>
                            </td>
                            <td style={{padding: '12px'}}>#{product.id}</td>
                            <td style={{padding: '12px', fontWeight: '500'}}>{product.name}</td>
                            <td style={{padding: '12px', color: '#28a745', fontWeight: 'bold'}}>${product.price}</td>
                            <td style={{padding: '12px'}}>{product.category?.name || 'N/A'}</td>
                            <td style={{padding: '12px'}}>
                              <span style={{
                                padding: '4px 8px', 
                                borderRadius: '4px', 
                                backgroundColor: product.stock > 10 ? '#d4edda' : '#f8d7da',
                                color: product.stock > 10 ? '#155724' : '#721c24'
                              }}>
                                {product.stock || 'N/A'}
                              </span>
                            </td>
                            <td style={{padding: '12px'}}>
                              <span style={{
                                padding: '4px 8px', 
                                borderRadius: '4px', 
                                backgroundColor: product.status === 'active' ? '#d4edda' : product.status === 'inactive' ? '#f8d7da' : product.status === 'draft' ? '#fff3cd' : '#e2e3e5',
                                color: product.status === 'active' ? '#155724' : product.status === 'inactive' ? '#721c24' : product.status === 'draft' ? '#856404' : '#6c757d'
                              }}>
                                {product.status || 'active'}
                              </span>
                            </td>
                            <td style={{padding: '12px', color: '#6c757d', fontSize: '14px'}}>{product.vatPercentage || product.vatValue || 'N/A'}%</td>
                            <td style={{padding: '12px', color: '#007bff', fontSize: '14px', fontWeight: '500'}}>{product.currency || 'EUR'}</td>
                            <td style={{padding: '12px', color: '#6c757d', fontSize: '14px', fontFamily: 'monospace'}}>{product.productCode || 'N/A'}</td>
                            <td style={{padding: '12px', color: '#6c757d', fontSize: '14px', fontFamily: 'monospace'}}>{product.ncCode || 'N/A'}</td>
                            <td style={{padding: '12px', color: '#6c757d', fontSize: '14px', fontFamily: 'monospace'}}>{product.cpvCode || 'N/A'}</td>
                            <td style={{padding: '12px'}}>
                              <div style={{display: 'flex', gap: '5px'}}>
                                <button 
                                  style={{
                                    padding: '4px 8px', 
                                    border: 'none', 
                                    borderRadius: '3px', 
                                    backgroundColor: '#007bff', 
                                    color: 'white', 
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={() => {
                                    fetchCategories();
                                    fetchSuppliers();
                                    setEditingProduct(product);
                                  }}
                                >
                                  ‚úèÔ∏è Edit
                                </button>
                                <button 
                                  style={{
                                    padding: '4px 8px', 
                                    border: 'none', 
                                    borderRadius: '3px', 
                                    backgroundColor: '#dc3545', 
                                    color: 'white', 
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={async () => {
                                    if (confirm(`Delete product "${product.name}"?\n\nThis action cannot be undone.`)) {
                                      const result = await deleteProduct(product.id);
                                      if (result.success) {
                                        alert('Product deleted successfully');
                                      } else {
                                        alert('Error: ' + result.message);
                                      }
                                    }
                                  }}
                                >
                                  üóëÔ∏è Delete
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                ) : (
                  <div style={{padding: '40px', textAlign: 'center', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <p style={{color: '#666', fontSize: '18px', marginBottom: '15px'}}>No products found</p>
                    <p style={{color: '#6c757d', marginBottom: '20px'}}>Start building your product catalog by adding your first product.</p>
                    <button 
                      className="btn" 
                      style={{background: '#28a745', width: 'auto', padding: '12px 24px'}}
                      onClick={() => alert('Add your first product:\n\n‚Ä¢ Product name and description\n‚Ä¢ High-quality images\n‚Ä¢ Pricing information\n‚Ä¢ Category assignment\n‚Ä¢ Inventory management')}
                    >
                      ‚ûï Add Your First Product
                    </button>
                  </div>
                )}
              </div>
            );
          
          case 'categories':
            return (
              <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                  <h3 style={{color: '#333', margin: '0'}}>üìÅ Category Management</h3>
                  <button 
                    className="btn" 
                    style={{background: '#28a745', width: 'auto', padding: '8px 16px'}}
                    onClick={() => setShowAddCategoryModal(true)}
                  >
                    ‚ûï Add New Category
                  </button>
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <h4 style={{color: '#333', marginBottom: '15px'}}>Homepage Category Settings</h4>
                  <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px', marginBottom: '20px'}}>
                    <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '8px', border: '1px solid #dee2e6'}}>
                      <h5 style={{color: '#495057', marginBottom: '15px'}}>Main Top Categories (Max 4)</h5>
                      <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                        {categories.filter(cat => cat.showOnMainTop).sort((a, b) => a.sortOrder - b.sortOrder).map(category => (
                          <div key={category.id} style={{
                            padding: '8px 12px',
                            background: '#007bff',
                            color: 'white',
                            borderRadius: '4px',
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center'
                          }}>
                            <span>{category.name}</span>
                            <span style={{fontSize: '12px', opacity: '0.8'}}>#{category.sortOrder}</span>
                          </div>
                        ))}
                        {categories.filter(cat => cat.showOnMainTop).length === 0 && (
                          <p style={{color: '#6c757d', fontStyle: 'italic'}}>No categories assigned to main top section</p>
                        )}
                      </div>
                    </div>
                    
                    <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '8px', border: '1px solid #dee2e6'}}>
                      <h5 style={{color: '#495057', marginBottom: '15px'}}>Shop Categories (Max 3)</h5>
                      <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                        {categories.filter(cat => cat.showOnMainShop).sort((a, b) => a.sortOrder - b.sortOrder).map(category => (
                          <div key={category.id} style={{
                            padding: '8px 12px',
                            background: '#28a745',
                            color: 'white',
                            borderRadius: '4px',
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center'
                          }}>
                            <span>{category.name}</span>
                            <span style={{fontSize: '12px', opacity: '0.8'}}>#{category.sortOrder}</span>
                          </div>
                        ))}
                        {categories.filter(cat => cat.showOnMainShop).length === 0 && (
                          <p style={{color: '#6c757d', fontStyle: 'italic'}}>No categories assigned to shop section</p>
                        )}
                      </div>
                    </div>
                  </div>
                  
                  <button 
                    className="btn" 
                    style={{background: '#6c757d', width: 'auto', padding: '8px 16px'}}
                    onClick={() => {
                      const mainTopCategories = categories.filter(cat => cat.showOnMainTop).sort((a, b) => a.sortOrder - b.sortOrder);
                      const mainShopCategories = categories.filter(cat => cat.showOnMainShop).sort((a, b) => a.sortOrder - b.sortOrder);
                      
                      alert(`Homepage Category Configuration:\n\nMain Top (${mainTopCategories.length}/4): ${mainTopCategories.map(c => c.name).join(', ') || 'None'}\n\nShop Section (${mainShopCategories.length}/3): ${mainShopCategories.map(c => c.name).join(', ') || 'None'}\n\nTo modify these settings, use the "Configure Homepage" button below.`);
                    }}
                  >
                    üìã View Homepage Config
                  </button>
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <button 
                    className="btn" 
                    style={{background: '#007bff', width: 'auto', padding: '8px 16px'}}
                    onClick={() => {
                      // Initialize homepage config with current settings
                      console.log('All categories:', categories);
                      console.log('Categories with showOnMainTop:', categories.filter(cat => cat.showOnMainTop));
                      console.log('Categories with showOnMainShop:', categories.filter(cat => cat.showOnMainShop));
                      
                      const currentMainTop = categories.filter(cat => cat.showOnMainTop).sort((a, b) => a.sortOrder - b.sortOrder);
                      const currentMainShop = categories.filter(cat => cat.showOnMainShop).sort((a, b) => a.sortOrder - b.sortOrder);
                      
                      console.log('Current Main Top:', currentMainTop);
                      console.log('Current Main Shop:', currentMainShop);
                      
                      setHomepageConfig({
                        mainTop: currentMainTop.map(cat => cat.id),
                        mainShop: currentMainShop.map(cat => cat.id)
                      });
                      
                      setShowHomepageConfigModal(true);
                    }}
                  >
                    ‚öôÔ∏è Configure Homepage
                  </button>
                </div>
                
                {categories.length > 0 ? (
                  <div style={{overflowX: 'auto'}}>
                    <table style={{width: '100%', borderCollapse: 'collapse'}}>
                      <thead>
                        <tr style={{backgroundColor: '#f5f5f5'}}>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>ID</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Image</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Name</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Slug</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Description</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Homepage</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {categories.map((category, index) => (
                          <tr key={index} style={{borderBottom: '1px solid #eee'}}>
                            <td style={{padding: '12px'}}>#{category.id}</td>
                            <td style={{padding: '12px'}}>
                              {category.imageUrl ? (
                                <img 
                                  src={category.imageUrl} 
                                  alt={category.name}
                                  style={{
                                    width: '40px',
                                    height: '40px',
                                    objectFit: 'cover',
                                    borderRadius: '4px',
                                    border: '1px solid #ddd'
                                  }}
                                />
                              ) : (
                                <div style={{
                                  width: '40px',
                                  height: '40px',
                                  backgroundColor: '#f5f5f5',
                                  borderRadius: '4px',
                                  border: '1px solid #ddd',
                                  display: 'flex',
                                  alignItems: 'center',
                                  justifyContent: 'center',
                                  color: '#999'
                                }}>
                                  üì∑
                                </div>
                              )}
                            </td>
                            <td style={{padding: '12px', fontWeight: '500'}}>{category.name}</td>
                            <td style={{padding: '12px', fontFamily: 'monospace', fontSize: '14px', color: '#666'}}>{category.slug}</td>
                            <td style={{padding: '12px', maxWidth: '200px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap'}}>
                              {category.description || 'No description'}
                            </td>
                            <td style={{padding: '12px'}}>
                              <div style={{display: 'flex', flexDirection: 'column', gap: '4px'}}>
                                {category.showOnMainTop && (
                                  <span style={{
                                    padding: '2px 6px',
                                    borderRadius: '3px',
                                    backgroundColor: '#007bff',
                                    color: 'white',
                                    fontSize: '11px'
                                  }}>
                                    Main Top #{category.sortOrder}
                                  </span>
                                )}
                                {category.showOnMainShop && (
                                  <span style={{
                                    padding: '2px 6px',
                                    borderRadius: '3px',
                                    backgroundColor: '#28a745',
                                    color: 'white',
                                    fontSize: '11px'
                                  }}>
                                    Shop #{category.sortOrder}
                                  </span>
                                )}
                                {!category.showOnMainTop && !category.showOnMainShop && (
                                  <span style={{color: '#6c757d', fontSize: '12px'}}>Not featured</span>
                                )}
                              </div>
                            </td>
                            <td style={{padding: '12px'}}>
                              <div style={{display: 'flex', gap: '5px'}}>
                                <button 
                                  style={{
                                    padding: '4px 8px',
                                    border: 'none',
                                    borderRadius: '3px',
                                    backgroundColor: '#007bff',
                                    color: 'white',
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={() => setEditingCategory(category)}
                                >
                                  ‚úèÔ∏è Edit
                                </button>
                                <button 
                                  style={{
                                    padding: '4px 8px',
                                    border: 'none',
                                    borderRadius: '3px',
                                    backgroundColor: '#dc3545',
                                    color: 'white',
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={async () => {
                                    if (confirm(`Delete category "${category.name}"?\n\nThis action cannot be undone. Make sure no products are assigned to this category.`)) {
                                      const result = await deleteCategory(category.id);
                                      if (result.success) {
                                        alert('Category deleted successfully');
                                      } else {
                                        alert('Error: ' + result.message);
                                      }
                                    }
                                  }}
                                >
                                  üóëÔ∏è Delete
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                ) : (
                  <div style={{padding: '40px', textAlign: 'center', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <p style={{color: '#666', fontSize: '18px', marginBottom: '15px'}}>No categories found</p>
                    <p style={{color: '#6c757d', marginBottom: '20px'}}>Create your first category to organize your products effectively.</p>
                    <button 
                      className="btn" 
                      style={{background: '#28a745', width: 'auto', padding: '12px 24px'}}
                      onClick={() => setShowAddCategoryModal(true)}
                    >
                      ‚ûï Add Your First Category
                    </button>
                  </div>
                )}
              </div>
            );
          
          case 'suppliers':
            return (
              <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                  <h3 style={{color: '#333', margin: '0'}}>üè¢ Supplier Management</h3>
                  <button 
                    className="btn" 
                    style={{background: '#28a745', width: 'auto', padding: '12px 20px'}}
                    onClick={() => alert('Add new supplier:\n\n‚Ä¢ Company details\n‚Ä¢ Contact information\n‚Ä¢ API integration settings\n‚Ä¢ Product assignments\n‚Ä¢ Email notifications')}
                  >
                    ‚ûï Add New Supplier
                  </button>
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <h4 style={{color: '#333', marginBottom: '15px'}}>Supplier Overview</h4>
                  <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                    <button 
                      className="btn" 
                      style={{background: '#007bff', width: 'auto', padding: '8px 16px'}}
                      onClick={() => alert('Supplier analytics:\n\n‚Ä¢ Order volume by supplier\n‚Ä¢ Performance metrics\n‚Ä¢ Delivery times\n‚Ä¢ Quality ratings\n‚Ä¢ Cost analysis')}
                    >
                      üìä Analytics
                    </button>
                    <button 
                      className="btn" 
                      style={{background: '#17a2b8', width: 'auto', padding: '8px 16px'}}
                      onClick={() => {
                        if (selectedSuppliers.length === 0) {
                          alert('Please select suppliers first by checking the boxes in the table');
                        } else {
                          setSupplierBulkOperation('menu');
                          setShowSupplierBulkModal(true);
                        }
                      }}
                    >
                      üîÑ Bulk Operations {selectedSuppliers.length > 0 ? `(${selectedSuppliers.length})` : ''}
                    </button>
                    <button 
                      className="btn" 
                      style={{background: '#6c757d', width: 'auto', padding: '8px 16px'}}
                      onClick={() => alert('Export suppliers:\n\n‚Ä¢ Contact directory\n‚Ä¢ Performance reports\n‚Ä¢ Contract details\n‚Ä¢ Integration settings\n‚Ä¢ Compliance documentation')}
                    >
                      üì§ Export
                    </button>
                  </div>
                </div>
                
                {suppliers.length > 0 ? (
                  <div style={{marginTop: '20px', maxHeight: '500px', overflowY: 'auto'}}>
                    <table style={{width: '100%', borderCollapse: 'collapse', border: '1px solid #dee2e6'}}>
                      <thead>
                        <tr style={{backgroundColor: '#f8f9fa'}}>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '1px solid #dee2e6', color: '#333', width: '50px'}}>
                            <input 
                              type="checkbox" 
                              checked={selectedSuppliers.length === suppliers.length && suppliers.length > 0}
                              onChange={(e) => handleSelectAllSuppliers(e.target.checked)}
                              style={{cursor: 'pointer'}}
                            />
                          </th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '1px solid #dee2e6', color: '#333'}}>Supplier Name</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '1px solid #dee2e6', color: '#333'}}>Contact</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '1px solid #dee2e6', color: '#333'}}>Location</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '1px solid #dee2e6', color: '#333'}}>Integration</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '1px solid #dee2e6', color: '#333'}}>Status</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '1px solid #dee2e6', color: '#333'}}>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {suppliers.map((supplier) => (
                          <tr key={supplier.id} style={{borderBottom: '1px solid #dee2e6'}}>
                            <td style={{padding: '12px', textAlign: 'center'}}>
                              <input 
                                type="checkbox" 
                                checked={selectedSuppliers.includes(supplier.id)}
                                onChange={(e) => handleSupplierSelection(supplier.id, e.target.checked)}
                                style={{cursor: 'pointer'}}
                              />
                            </td>
                            <td style={{padding: '12px', color: '#333'}}>
                              <div style={{fontWeight: 'bold'}}>{supplier.name}</div>
                              <div style={{fontSize: '12px', color: '#666'}}>{supplier.contactPerson}</div>
                            </td>
                            <td style={{padding: '12px', color: '#333'}}>
                              <div style={{fontSize: '14px'}}>{supplier.email}</div>
                              <div style={{fontSize: '12px', color: '#666'}}>{supplier.phone}</div>
                            </td>
                            <td style={{padding: '12px', color: '#333'}}>
                              <div style={{fontSize: '14px'}}>{supplier.city}, {supplier.country}</div>
                              <div style={{fontSize: '12px', color: '#666'}}>{supplier.address}</div>
                            </td>
                            <td style={{padding: '12px', color: '#333'}}>
                              <span style={{
                                padding: '4px 8px',
                                borderRadius: '12px',
                                fontSize: '12px',
                                backgroundColor: supplier.integrationType === 'api' ? '#d4edda' : '#fff3cd',
                                color: supplier.integrationType === 'api' ? '#155724' : '#856404'
                              }}>
                                {supplier.integrationType === 'api' ? 'üîó API' : 'üìß Email'}
                              </span>
                            </td>
                            <td style={{padding: '12px', color: '#333'}}>
                              <span style={{
                                padding: '4px 8px',
                                borderRadius: '12px',
                                fontSize: '12px',
                                backgroundColor: supplier.isActive ? '#d4edda' : '#f8d7da',
                                color: supplier.isActive ? '#155724' : '#721c24'
                              }}>
                                {supplier.isActive ? '‚úÖ Active' : '‚ùå Inactive'}
                              </span>
                            </td>
                            <td style={{padding: '12px'}}>
                              <div style={{display: 'flex', gap: '8px'}}>
                                <button 
                                  style={{
                                    padding: '4px 8px',
                                    border: 'none',
                                    borderRadius: '3px',
                                    backgroundColor: '#28a745',
                                    color: 'white',
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={() => syncSupplierPrices(supplier.id)}
                                >
                                  üí∞ Sync Prices
                                </button>
                                <button 
                                  style={{
                                    padding: '4px 8px',
                                    border: 'none',
                                    borderRadius: '3px',
                                    backgroundColor: '#ffc107',
                                    color: 'black',
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={() => syncSupplierStock(supplier.id)}
                                >
                                  üì¶ Sync Stock
                                </button>
                                <button 
                                  style={{
                                    padding: '4px 8px',
                                    border: 'none',
                                    borderRadius: '3px',
                                    backgroundColor: '#17a2b8',
                                    color: 'white',
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={() => {
                                    setEditingSupplier(supplier);
                                    setShowEditSupplierModal(true);
                                  }}
                                >
                                  ‚úèÔ∏è Edit
                                </button>
                                <button 
                                  style={{
                                    padding: '4px 8px',
                                    border: 'none',
                                    borderRadius: '3px',
                                    backgroundColor: '#6c757d',
                                    color: 'white',
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={async () => {
                                    setViewingSupplier(supplier);
                                    setShowViewSupplierModal(true);
                                    const details = await fetchSupplierDetails(supplier.id);
                                    setSupplierDetails(details);
                                  }}
                                >
                                  üëÅÔ∏è View
                                </button>
                                <button 
                                  style={{
                                    padding: '4px 8px',
                                    border: 'none',
                                    borderRadius: '3px',
                                    backgroundColor: '#dc3545',
                                    color: 'white',
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                  }}
                                  onClick={() => {
                                    if (confirm(`Delete supplier "${supplier.name}"?\n\nThis will remove the supplier and unassign all associated products.\n\nThis action cannot be undone.`)) {
                                      alert('Supplier deletion functionality:\n\n‚Ä¢ Remove supplier record\n‚Ä¢ Unassign products\n‚Ä¢ Archive order history\n‚Ä¢ Send notifications\n‚Ä¢ Update system logs');
                                    }
                                  }}
                                >
                                  üóëÔ∏è Delete
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                ) : (
                  <div style={{padding: '40px', textAlign: 'center', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <p style={{color: '#666', fontSize: '18px', marginBottom: '15px'}}>No suppliers found</p>
                    <p style={{color: '#6c757d', marginBottom: '20px'}}>Start building your supplier network by adding your first supplier.</p>
                    <button 
                      className="btn" 
                      style={{background: '#28a745', width: 'auto', padding: '12px 24px'}}
                      onClick={() => alert('Add your first supplier:\n\n‚Ä¢ Company name and details\n‚Ä¢ Contact information\n‚Ä¢ Integration preferences\n‚Ä¢ Email notifications\n‚Ä¢ Product assignments')}
                    >
                      ‚ûï Add Your First Supplier
                    </button>
                  </div>
                )}
              </div>
            );
          
          case 'company-settings':
            return (
              <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                  <h3 style={{color: '#333', margin: '0'}}>üè¢ Company Settings</h3>
                  <button 
                    className="btn" 
                    style={{background: '#007bff', width: 'auto', padding: '8px 16px'}}
                    onClick={() => setShowCompanySettingsModal(true)}
                  >
                    ‚úèÔ∏è Edit Company Info
                  </button>
                </div>
                
                <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px'}}>
                  {/* Basic Information */}
                  <div style={{background: '#f8f9fa', padding: '20px', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{color: '#333', marginBottom: '15px', borderBottom: '2px solid #007bff', paddingBottom: '5px'}}>Basic Information</h4>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Company Name:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.name || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Email:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.email || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Phone:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.phone || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Website:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.website || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Logistics Email:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.logisticsEmail || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>IBAN:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d', fontFamily: 'monospace'}}>{companySettings.iban || 'Not set'}</p>
                    </div>
                  </div>
                  
                  {/* Address Information */}
                  <div style={{background: '#f8f9fa', padding: '20px', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{color: '#333', marginBottom: '15px', borderBottom: '2px solid #28a745', paddingBottom: '5px'}}>Address</h4>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Street Address:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.address || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>City:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.city || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>State/Province:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.state || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>ZIP/Postal Code:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.zipCode || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Country:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.country || 'Not set'}</p>
                    </div>
                  </div>
                  
                  {/* Legal & Business Information */}
                  <div style={{background: '#f8f9fa', padding: '20px', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{color: '#333', marginBottom: '15px', borderBottom: '2px solid #ffc107', paddingBottom: '5px'}}>Legal & Business</h4>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Contact Person:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.contactPerson || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>VAT Number:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.vatNumber || 'Not set'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Registration Number:</strong>
                      <p style={{margin: '5px 0', color: '#6c757d'}}>{companySettings.registrationNumber || 'Not set'}</p>
                    </div>
                  </div>
                  
                  {/* Default Product Settings */}
                  <div style={{background: '#f0f8ff', padding: '20px', borderRadius: '6px', border: '1px solid #007bff'}}>
                    <h4 style={{color: '#007bff', marginBottom: '15px', borderBottom: '2px solid #007bff', paddingBottom: '5px'}}>üí∞ Default Product Settings</h4>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Default Currency:</strong>
                      <p style={{margin: '5px 0', color: '#007bff', fontWeight: '500'}}>{companySettings.defaultCurrency || 'EUR'}</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Default VAT Percentage:</strong>
                      <p style={{margin: '5px 0', color: '#007bff', fontWeight: '500'}}>{companySettings.defaultVatPercentage || '19.00'}%</p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Reverse Charge VAT:</strong>
                      <p style={{margin: '5px 0', color: '#007bff', fontWeight: '500'}}>{companySettings.reverseChargeVat || '0.00'}%</p>
                    </div>
                    <p style={{fontSize: '12px', color: '#666', marginTop: '10px', fontStyle: 'italic'}}>
                      Used as defaults when creating new products
                    </p>
                  </div>
                  
                  {/* Shipping Settings Display */}
                  <div style={{background: '#e3f2fd', padding: '20px', borderRadius: '6px', border: '1px solid #bbdefb'}}>
                    <h4 style={{color: '#1976d2', marginBottom: '15px', borderBottom: '2px solid #2196f3', paddingBottom: '5px'}}>üöö Shipping Settings</h4>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Free Shipping Threshold:</strong>
                      <p style={{margin: '5px 0', color: '#1976d2', fontWeight: '500'}}>
                        {companySettings.freeShippingThreshold || '500.00'} {companySettings.defaultCurrency || 'EUR'}
                      </p>
                    </div>
                    <div style={{marginBottom: '10px'}}>
                      <strong style={{color: '#495057'}}>Standard Shipping Cost:</strong>
                      <p style={{margin: '5px 0', color: '#1976d2', fontWeight: '500'}}>
                        {companySettings.standardShippingCost || '25.00'} {companySettings.defaultCurrency || 'EUR'}
                      </p>
                    </div>
                    <p style={{fontSize: '12px', color: '#666', marginTop: '10px', fontStyle: 'italic'}}>
                      Orders over {companySettings.freeShippingThreshold || '500.00'} {companySettings.defaultCurrency || 'EUR'} qualify for free shipping
                    </p>
                  </div>
                  
                  {/* Company Description */}
                  <div style={{background: '#f8f9fa', padding: '20px', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{color: '#333', marginBottom: '15px', borderBottom: '2px solid #dc3545', paddingBottom: '5px'}}>Company Description</h4>
                    <p style={{margin: '0', color: '#6c757d', lineHeight: '1.6'}}>
                      {companySettings.description || 'No description available. Click "Edit Company Info" to add your company description.'}
                    </p>
                  </div>
                </div>
                
                <div style={{marginTop: '30px', padding: '20px', background: '#e8f4f8', borderRadius: '6px', border: '1px solid #bee5eb'}}>
                  <h4 style={{color: '#333', marginBottom: '10px'}}>üìù Important Notes</h4>
                  <ul style={{margin: '0', paddingLeft: '20px', color: '#495057'}}>
                    <li style={{marginBottom: '5px'}}>This information is used throughout the system for invoices, emails, and customer communications</li>
                    <li style={{marginBottom: '5px'}}>VAT Number and Registration Number are required for proper invoice generation</li>
                    <li style={{marginBottom: '5px'}}>Contact information will be displayed to customers for support inquiries</li>
                    <li>All changes are automatically saved and will be reflected in new orders and communications</li>
                  </ul>
                </div>
              </div>
            );
          
          default:
            return (
              <>
                <div className="dashboard-grid">
                  <div className="stat-card">
                    <div className="stat-number">{stats?.totalUsers || '0'}</div>
                    <div className="stat-label">Total Users</div>
                  </div>
                  
                  <div className="stat-card">
                    <div className="stat-number">{stats?.totalOrders || '0'}</div>
                    <div className="stat-label">Total Orders</div>
                  </div>
                  
                  <div className="stat-card">
                    <div className="stat-number">{stats?.totalProducts || '0'}</div>
                    <div className="stat-label">Total Products</div>
                  </div>
                  
                  <div className="stat-card">
                    <div className="stat-number">{stats?.recentOrders?.length || '0'}</div>
                    <div className="stat-label">Recent Orders</div>
                  </div>
                </div>
                
                <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>System Overview</h3>
                  <p style={{color: '#666', lineHeight: '1.6'}}>
                    Welcome to the KitchenOff Admin Panel. Here you can manage your e-commerce platform, 
                    view statistics, and monitor system performance. The dashboard shows real-time data 
                    from your PostgreSQL database.
                  </p>
                  
                  <div style={{marginTop: '30px', padding: '20px', background: '#f8f9ff', borderRadius: '6px'}}>
                    <h4 style={{color: '#333', marginBottom: '10px'}}>Quick Stats Summary</h4>
                    <ul style={{listStyle: 'none', padding: 0}}>
                      <li style={{marginBottom: '5px'}}>üìä {stats?.totalUsers || '0'} registered users</li>
                      <li style={{marginBottom: '5px'}}>üõí {stats?.totalOrders || '0'} orders processed</li>
                      <li style={{marginBottom: '5px'}}>üì¶ {stats?.totalProducts || '0'} products in catalog</li>
                      <li style={{marginBottom: '5px'}}>üîÑ {stats?.recentOrders?.length || '0'} recent orders</li>
                    </ul>
                  </div>
                  
                  <div style={{marginTop: '30px', padding: '20px', background: '#fff8e1', borderRadius: '6px'}}>
                    <h4 style={{color: '#333', marginBottom: '10px'}}>Admin Actions</h4>
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', marginTop: '15px'}}>
                      <button 
                        className="btn" 
                        style={{background: activeView === 'orders' ? '#2E7D32' : '#4CAF50', width: 'auto', padding: '10px 16px'}}
                        onClick={() => handleViewChange('orders')}
                      >
                        üìã Manage Orders
                      </button>
                      <button 
                        className="btn" 
                        style={{background: activeView === 'users' ? '#1565C0' : '#2196F3', width: 'auto', padding: '10px 16px'}}
                        onClick={() => handleViewChange('users')}
                      >
                        üë• Manage Users
                      </button>
                      <button 
                        className="btn" 
                        style={{background: activeView === 'products' ? '#F57C00' : '#FF9800', width: 'auto', padding: '10px 16px'}}
                        onClick={() => handleViewChange('products')}
                      >
                        üì¶ Manage Products
                      </button>
                      <button 
                        className="btn" 
                        style={{background: '#9C27B0', width: 'auto', padding: '10px 16px'}}
                        onClick={() => setShowTwoFactor(!showTwoFactor)}
                      >
                        üîê Two-Factor Auth
                      </button>
                    </div>
                  </div>
                  
                  {showTwoFactor && (
                    <div style={{marginTop: '30px', padding: '20px', background: '#e8f5e8', borderRadius: '6px', border: '2px solid #4CAF50'}}>
                      <h4 style={{color: '#333', marginBottom: '10px'}}>üîê Two-Factor Authentication</h4>
                      <p style={{color: '#666', marginBottom: '15px'}}>
                        Status: {admin?.twoFactorEnabled ? 
                          <span style={{color: '#4CAF50', fontWeight: 'bold'}}>‚úÖ Enabled</span> : 
                          <span style={{color: '#f44336', fontWeight: 'bold'}}>‚ùå Disabled</span>
                        }
                      </p>
                      <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                        <button 
                          className="btn" 
                          style={{background: admin?.twoFactorEnabled ? '#f44336' : '#4CAF50', width: 'auto', padding: '8px 16px'}}
                          onClick={() => alert('2FA management functionality will be implemented')}
                        >
                          {admin?.twoFactorEnabled ? 'üîì Disable 2FA' : 'üîí Enable 2FA'}
                        </button>
                        {admin?.twoFactorEnabled && (
                          <button 
                            className="btn" 
                            style={{background: '#FF9800', width: 'auto', padding: '8px 16px'}}
                            onClick={() => alert('Backup codes regeneration will be implemented')}
                          >
                            üîÑ Regenerate Backup Codes
                          </button>
                        )}
                      </div>
                    </div>
                  )}
                  
                  <div style={{marginTop: '30px', padding: '20px', background: '#f0f8ff', borderRadius: '6px'}}>
                    <h4 style={{color: '#333', marginBottom: '10px'}}>Recent Activity</h4>
                    {stats?.recentOrders?.length > 0 ? (
                      <div style={{maxHeight: '200px', overflowY: 'auto'}}>
                        {stats.recentOrders.map((order, index) => (
                          <div key={index} style={{
                            padding: '10px',
                            marginBottom: '10px',
                            background: 'white',
                            borderRadius: '4px',
                            borderLeft: '4px solid #2196F3'
                          }}>
                            <div style={{fontWeight: 'bold'}}>Order #{order.id}</div>
                            <div style={{fontSize: '14px', color: '#666'}}>
                              Amount: ${order.totalAmount} | Status: {order.status}
                            </div>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <p style={{color: '#666', fontStyle: 'italic'}}>No recent orders</p>
                    )}
                  </div>
                </div>
              </>
            );
        }
      };

      // Bulk Operations Components
      const BulkStatusComponent = () => {
        const [newStatus, setNewStatus] = useState('');
        const [isProcessing, setIsProcessing] = useState(false);
        
        const handleStatusUpdate = async () => {
          if (!newStatus) {
            alert('Please select a status');
            return;
          }
          
          setIsProcessing(true);
          const result = await performBulkOperation('status', selectedOrders, { status: newStatus });
          
          if (result.success) {
            alert(`Status updated successfully for ${selectedOrders.length} orders`);
            setSelectedOrders([]);
            setShowBulkModal(false);
            setBulkOperation('');
          } else {
            alert('Error: ' + result.message);
          }
          setIsProcessing(false);
        };
        
        return (
          <div>
            <div className="form-group">
              <label className="form-label">Select New Status</label>
              <select
                className="form-input"
                value={newStatus}
                onChange={(e) => setNewStatus(e.target.value)}
              >
                <option value="">Choose Status...</option>
                <option value="pending">Pending</option>
                <option value="processing">Processing</option>
                <option value="shipped">Shipped</option>
                <option value="delivered">Delivered</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <button
              className="btn"
              style={{background: '#28a745'}}
              onClick={handleStatusUpdate}
              disabled={isProcessing}
            >
              {isProcessing ? 'Updating...' : 'Update Status'}
            </button>
          </div>
        );
      };
      
      const BulkToolsComponent = () => {
        const [selectedTool, setSelectedTool] = useState('');
        const [isProcessing, setIsProcessing] = useState(false);
        const [notificationMessage, setNotificationMessage] = useState('');
        
        const handleToolOperation = async (operation) => {
          setIsProcessing(true);
          let result;
          
          switch (operation) {
            case 'shipping':
              result = await performBulkOperation('shipping', selectedOrders);
              break;
            case 'notifications':
              result = await performBulkOperation('notifications', selectedOrders, { message: notificationMessage });
              break;
            case 'refunds':
              result = await performBulkOperation('refunds', selectedOrders);
              break;
            default:
              result = { success: false, message: 'Invalid operation' };
          }
          
          if (result.success) {
            alert(`${operation} operation completed successfully for ${selectedOrders.length} orders`);
            setSelectedOrders([]);
            setShowBulkModal(false);
            setBulkOperation('');
          } else {
            alert('Error: ' + result.message);
          }
          setIsProcessing(false);
        };
        
        return (
          <div>
            <div style={{display: 'flex', flexDirection: 'column', gap: '15px'}}>
              <button
                className="btn"
                style={{background: '#17a2b8'}}
                onClick={() => handleToolOperation('shipping')}
                disabled={isProcessing}
              >
                üì¶ Generate Shipping Labels
              </button>
              
              <div>
                <div className="form-group">
                  <label className="form-label">Custom Notification Message</label>
                  <textarea
                    className="form-input"
                    value={notificationMessage}
                    onChange={(e) => setNotificationMessage(e.target.value)}
                    placeholder="Enter custom notification message..."
                    rows="3"
                  />
                </div>
                <button
                  className="btn"
                  style={{background: '#ffc107'}}
                  onClick={() => handleToolOperation('notifications')}
                  disabled={isProcessing}
                >
                  üìß Send Notifications
                </button>
              </div>
              
              <button
                className="btn"
                style={{background: '#dc3545'}}
                onClick={() => {
                  if (confirm('Are you sure you want to process refunds for the selected orders? This action cannot be undone.')) {
                    handleToolOperation('refunds');
                  }
                }}
                disabled={isProcessing}
              >
                üí∏ Process Refunds
              </button>
            </div>
            
            {isProcessing && (
              <div style={{textAlign: 'center', marginTop: '20px'}}>
                <div className="loading"></div>
                <p>Processing operation...</p>
              </div>
            )}
          </div>
        );
      };
      
      // Product Bulk Operations Component
      const ProductBulkOperationsComponent = () => {
        const [selectedOperation, setSelectedOperation] = useState('');
        const [isProcessing, setIsProcessing] = useState(false);
        const [priceMultiplier, setPriceMultiplier] = useState('');
        const [fixedPrice, setFixedPrice] = useState('');
        const [newCategoryId, setNewCategoryId] = useState('');
        const [newStatus, setNewStatus] = useState('');
        const [stockOperation, setStockOperation] = useState('set');
        const [stockValue, setStockValue] = useState('');
        
        const handleOperation = async () => {
          if (!selectedOperation) {
            alert('Please select an operation');
            return;
          }
          
          setIsProcessing(true);
          let result;
          
          switch (selectedOperation) {
            case 'update-prices':
              if (!priceMultiplier && !fixedPrice) {
                alert('Please enter a price multiplier or fixed price');
                setIsProcessing(false);
                return;
              }
              result = await performProductBulkOperation('update-prices', selectedProducts, {
                multiplier: priceMultiplier ? parseFloat(priceMultiplier) : null,
                fixedPrice: fixedPrice ? parseFloat(fixedPrice) : null
              });
              break;
            case 'update-categories':
              if (!newCategoryId) {
                alert('Please select a category');
                setIsProcessing(false);
                return;
              }
              result = await performProductBulkOperation('update-categories', selectedProducts, {
                categoryId: parseInt(newCategoryId)
              });
              break;
            case 'update-status':
              if (!newStatus) {
                alert('Please select a status');
                setIsProcessing(false);
                return;
              }
              result = await performProductBulkOperation('update-status', selectedProducts, {
                status: newStatus
              });
              break;
            case 'update-stock':
              if (!stockValue) {
                alert('Please enter a stock value');
                setIsProcessing(false);
                return;
              }
              result = await performProductBulkOperation('update-stock', selectedProducts, {
                operation: stockOperation,
                value: parseInt(stockValue)
              });
              break;
            case 'export':
              result = await performProductBulkOperation('export', selectedProducts);
              break;
            case 'delete':
              if (!confirm(`Are you sure you want to delete ${selectedProducts.length} products? This action cannot be undone.`)) {
                setIsProcessing(false);
                return;
              }
              result = await performProductBulkOperation('delete', selectedProducts);
              break;
            default:
              result = { success: false, message: 'Invalid operation' };
          }
          
          if (result.success) {
            alert(`${selectedOperation} operation completed successfully for ${selectedProducts.length} products`);
            setSelectedProducts([]);
            setShowProductBulkModal(false);
            setProductBulkOperation('');
            // Force refresh of products after bulk operations
            setTimeout(() => {
              fetchProducts();
            }, 1000);
          } else {
            alert('Error: ' + result.message);
          }
          setIsProcessing(false);
        };
        
        return (
          <div>
            <div className="form-group">
              <label className="form-label">Select Operation</label>
              <select
                className="form-input"
                value={selectedOperation}
                onChange={(e) => setSelectedOperation(e.target.value)}
              >
                <option value="">Choose Operation...</option>
                <option value="update-prices">üí∞ Update Prices</option>
                <option value="update-categories">üìÅ Update Categories</option>
                <option value="update-status">üîÑ Update Status</option>
                <option value="update-stock">üì¶ Update Stock</option>
                <option value="export">üì§ Export Products</option>
                <option value="delete">üóëÔ∏è Delete Products</option>
              </select>
            </div>
            
            {selectedOperation === 'update-prices' && (
              <div>
                <div className="form-group">
                  <label className="form-label">Price Multiplier (e.g., 1.1 for 10% increase)</label>
                  <input
                    type="number"
                    step="0.01"
                    className="form-input"
                    value={priceMultiplier}
                    onChange={(e) => setPriceMultiplier(e.target.value)}
                    placeholder="Enter multiplier (e.g., 1.1)"
                  />
                </div>
                <div className="form-group">
                  <label className="form-label">OR Set Fixed Price</label>
                  <input
                    type="number"
                    step="0.01"
                    className="form-input"
                    value={fixedPrice}
                    onChange={(e) => setFixedPrice(e.target.value)}
                    placeholder="Enter fixed price"
                  />
                </div>
              </div>
            )}
            
            {selectedOperation === 'update-categories' && (
              <div className="form-group">
                <label className="form-label">New Category</label>
                <select
                  className="form-input"
                  value={newCategoryId}
                  onChange={(e) => setNewCategoryId(e.target.value)}
                >
                  <option value="">Select Category...</option>
                  {categories.map(category => (
                    <option key={category.id} value={category.id}>{category.name}</option>
                  ))}
                </select>
              </div>
            )}
            
            {selectedOperation === 'update-status' && (
              <div className="form-group">
                <label className="form-label">New Status</label>
                <select
                  className="form-input"
                  value={newStatus}
                  onChange={(e) => setNewStatus(e.target.value)}
                >
                  <option value="">Select Status...</option>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="draft">Draft</option>
                  <option value="discontinued">Discontinued</option>
                </select>
              </div>
            )}
            
            {selectedOperation === 'update-stock' && (
              <div>
                <div className="form-group">
                  <label className="form-label">Stock Operation</label>
                  <select
                    className="form-input"
                    value={stockOperation}
                    onChange={(e) => setStockOperation(e.target.value)}
                  >
                    <option value="set">Set Stock To</option>
                    <option value="add">Add To Stock</option>
                    <option value="subtract">Subtract From Stock</option>
                  </select>
                </div>
                <div className="form-group">
                  <label className="form-label">Stock Value</label>
                  <input
                    type="number"
                    className="form-input"
                    value={stockValue}
                    onChange={(e) => setStockValue(e.target.value)}
                    placeholder="Enter stock value"
                  />
                </div>
              </div>
            )}
            
            <button
              className="btn"
              style={{background: '#28a745'}}
              onClick={handleOperation}
              disabled={isProcessing}
            >
              {isProcessing ? 'Processing...' : 'Execute Operation'}
            </button>
            
            {isProcessing && (
              <div style={{textAlign: 'center', marginTop: '20px'}}>
                <div className="loading"></div>
                <p>Processing operation...</p>
              </div>
            )}
          </div>
        );
      };
      
      // Modal Forms Component
      const ModalsComponent = () => {
        const [userFormData, setUserFormData] = useState({
          email: '',
          password: '',
          firstName: '',
          lastName: '',
          isAdmin: false
        });
        
        const [productFormData, setProductFormData] = useState({
          name: '',
          description: '',
          price: '',
          compareAtPrice: '',
          categoryId: '',
          supplierId: '',
          imageUrl: '',
          stockQuantity: '',
          featured: false,
          vatValue: '',
          vatPercentage: '19.00',
          currency: 'RON',
          productCode: '',
          ncCode: '',
          cpvCode: '',
          status: 'active',
          images: []
        });

        const [uploadedImages, setUploadedImages] = useState([]);
        const [uploading, setUploading] = useState(false);
        const [uploadProgress, setUploadProgress] = useState(0);

        const [supplierFormData, setSupplierFormData] = useState({
          name: '',
          email: '',
          phone: '',
          address: '',
          city: '',
          state: '',
          zipCode: '',
          country: '',
          contactPerson: '',
          apiEndpoint: '',
          apiKey: '',
          integrationType: 'email',
          notes: '',
          isActive: true
        });

        // Populate supplier form when editing
        useEffect(() => {
          if (editingSupplier) {
            setSupplierFormData({
              name: editingSupplier.name || '',
              email: editingSupplier.email || '',
              phone: editingSupplier.phone || '',
              address: editingSupplier.address || '',
              city: editingSupplier.city || '',
              state: editingSupplier.state || '',
              zipCode: editingSupplier.zipCode || '',
              country: editingSupplier.country || '',
              contactPerson: editingSupplier.contactPerson || '',
              apiEndpoint: editingSupplier.apiEndpoint || '',
              apiKey: editingSupplier.apiKey || '',
              integrationType: editingSupplier.integrationType || 'email',
              notes: editingSupplier.notes || '',
              isActive: editingSupplier.isActive !== undefined ? editingSupplier.isActive : true
            });
          }
        }, [editingSupplier]);

        // Handle supplier form submission
        const handleSupplierSubmit = async (e) => {
          e.preventDefault();
          
          const result = await updateSupplier(editingSupplier.id, supplierFormData);
          
          if (result.success) {
            alert('‚úÖ Supplier updated successfully!');
            setShowEditSupplierModal(false);
            setEditingSupplier(null);
            fetchSuppliers(); // Refresh the suppliers list
          } else {
            alert(`‚ùå Error updating supplier: ${result.message}`);
          }
        };

        // Image upload function
        const uploadImages = async (files) => {
          // Validate file types and sizes
          const validFiles = Array.from(files).filter(file => {
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            const maxSize = 5 * 1024 * 1024; // 5MB
            
            if (!validTypes.includes(file.type)) {
              alert(`Invalid file type: ${file.name}. Please use JPG, PNG, GIF, or WebP.`);
              return false;
            }
            
            if (file.size > maxSize) {
              alert(`File too large: ${file.name}. Maximum size is 5MB.`);
              return false;
            }
            
            return true;
          });
          
          if (validFiles.length === 0) return;
          
          if (uploadedImages.length + validFiles.length > 10) {
            alert('Maximum 10 images per product. Please remove some images first.');
            return;
          }
          
          setUploading(true);
          setUploadProgress(0);
          
          const formData = new FormData();
          validFiles.forEach(file => {
            formData.append('images', file);
          });

          try {
            const response = await fetch('/admin/api/upload-images', {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
              },
              body: formData
            });

            const result = await response.json();
            
            if (result.success) {
              const newImages = [...uploadedImages, ...result.files];
              setUploadedImages(newImages);
              setProductFormData(prev => ({
                ...prev,
                images: newImages
              }));
              
              alert(`${result.files.length} image(s) uploaded successfully`);
            } else {
              alert('Error: ' + result.message);
            }
          } catch (error) {
            console.error('Upload error:', error);
            alert('Error uploading images. Please try again.');
          } finally {
            setUploading(false);
            setUploadProgress(0);
          }
        };

        // Delete image function
        const deleteImage = async (filename, index) => {
          try {
            const response = await fetch(`/admin/api/delete-image/${filename}`, {
              method: 'DELETE',
              headers: {
                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
              }
            });

            const result = await response.json();
            
            if (result.success) {
              const newImages = uploadedImages.filter((_, i) => i !== index);
              setUploadedImages(newImages);
              setProductFormData(prev => ({
                ...prev,
                images: newImages
              }));
              
              alert('Image deleted successfully');
            } else {
              alert('Error: ' + result.message);
            }
          } catch (error) {
            console.error('Delete error:', error);
            alert('Error deleting image');
          }
        };

        // Set image as main function
        const setAsMainImage = async (selectedIndex) => {
          if (selectedIndex === 0) return; // Already main
          
          const newImages = [...uploadedImages];
          const mainImage = newImages.splice(selectedIndex, 1)[0];
          newImages.unshift(mainImage);
          
          setUploadedImages(newImages);
          setProductFormData(prev => ({
            ...prev,
            images: newImages
          }));
          
          // Images will be saved when the form is submitted
        };
        
        const handleUserSubmit = async (e) => {
          e.preventDefault();
          
          const result = editingUser 
            ? await updateUser(editingUser.id, userFormData)
            : await createUser(userFormData);
          
          if (result.success) {
            alert(result.message);
            setShowAddUserModal(false);
            setEditingUser(null);
            setUserFormData({
              email: '',
              password: '',
              firstName: '',
              lastName: '',
              isAdmin: false
            });
          } else {
            alert('Error: ' + result.message);
          }
        };
        
        const handleProductSubmit = async (e) => {
          e.preventDefault();
          
          // Include uploaded images in the product data
          const productData = {
            ...productFormData,
            images: uploadedImages
          };
          
          // Debug logging to see what data is being sent
          console.log('Product form data being submitted:', productData);
          console.log('Currency value:', productData.currency);
          console.log('VAT percentage:', productData.vatPercentage);
          
          const result = editingProduct 
            ? await updateProduct(editingProduct.id, productData)
            : await createProduct(productData);
          
          if (result.success) {
            alert(result.message);
            setShowAddProductModal(false);
            setEditingProduct(null);
            setProductFormData({
              name: '',
              description: '',
              price: '',
              compareAtPrice: '',
              categoryId: '',
              supplierId: '',
              imageUrl: '',
              stockQuantity: '',
              featured: false,
              vatValue: '',
              vatPercentage: '19.00',
              currency: 'EUR',
              productCode: '',
              ncCode: '',
              cpvCode: '',
              status: 'active',
              images: []
            });
            setUploadedImages([]);
            // Force immediate refresh to show updated currency/VAT values
            console.log('Product updated successfully, refreshing list...');
            fetchProducts();
            // Also refresh after a delay to ensure cache is updated
            setTimeout(() => {
              fetchProducts();
            }, 1500);
          } else {
            alert('Error: ' + result.message);
          }
        };
        
        // Set form data when editing
        React.useEffect(() => {
          if (editingUser) {
            setUserFormData({
              email: editingUser.email || '',
              password: '',
              firstName: editingUser.firstName || '',
              lastName: editingUser.lastName || '',
              isAdmin: editingUser.isAdmin || false
            });
            setShowAddUserModal(true);
          }
        }, [editingUser]);
        
        React.useEffect(() => {
          if (editingProduct) {
            setProductFormData({
              name: editingProduct.name || '',
              description: editingProduct.description || '',
              price: editingProduct.price || '',
              compareAtPrice: editingProduct.compareAtPrice || '',
              categoryId: editingProduct.categoryId || '',
              imageUrl: editingProduct.imageUrl || '',
              stockQuantity: editingProduct.stockQuantity || '',
              featured: editingProduct.featured || false,
              vatValue: editingProduct.vatValue || '',
              vatPercentage: editingProduct.vatPercentage || '19.00',
              currency: editingProduct.currency || 'EUR',
              productCode: editingProduct.productCode || '',
              ncCode: editingProduct.ncCode || '',
              cpvCode: editingProduct.cpvCode || '',
              status: editingProduct.status || 'active',
              images: editingProduct.images || []
            });
            setUploadedImages(editingProduct.images || []);
            setShowAddProductModal(true);
          }
        }, [editingProduct]);
        
        return (
          <>
            {/* Add/Edit User Modal */}
            {showAddUserModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '500px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    {editingUser ? 'Edit User' : 'Add New User'}
                  </h3>
                  <form onSubmit={handleUserSubmit}>
                    <div className="form-group">
                      <label className="form-label">Email</label>
                      <input
                        type="email"
                        className="form-input"
                        value={userFormData.email}
                        onChange={(e) => setUserFormData({...userFormData, email: e.target.value})}
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label className="form-label">Password {editingUser && '(leave empty to keep current)'}</label>
                      <input
                        type="password"
                        className="form-input"
                        value={userFormData.password}
                        onChange={(e) => setUserFormData({...userFormData, password: e.target.value})}
                        required={!editingUser}
                      />
                    </div>
                    <div className="form-group">
                      <label className="form-label">First Name</label>
                      <input
                        type="text"
                        className="form-input"
                        value={userFormData.firstName}
                        onChange={(e) => setUserFormData({...userFormData, firstName: e.target.value})}
                      />
                    </div>
                    <div className="form-group">
                      <label className="form-label">Last Name</label>
                      <input
                        type="text"
                        className="form-input"
                        value={userFormData.lastName}
                        onChange={(e) => setUserFormData({...userFormData, lastName: e.target.value})}
                      />
                    </div>
                    <div className="form-group">
                      <label style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                        <input
                          type="checkbox"
                          checked={userFormData.isAdmin}
                          onChange={(e) => setUserFormData({...userFormData, isAdmin: e.target.checked})}
                        />
                        Admin User
                      </label>
                    </div>
                    <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                      <button type="submit" className="btn" style={{background: '#28a745'}}>
                        {editingUser ? 'Update User' : 'Create User'}
                      </button>
                      <button
                        type="button"
                        className="btn"
                        style={{background: '#6c757d'}}
                        onClick={() => {
                          setShowAddUserModal(false);
                          setEditingUser(null);
                          setUserFormData({
                            email: '',
                            password: '',
                            firstName: '',
                            lastName: '',
                            isAdmin: false
                          });
                        }}
                      >
                        Cancel
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}
            
            {/* Add/Edit Product Modal */}
            {showAddProductModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '600px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    {editingProduct ? 'Edit Product' : 'Add New Product'}
                  </h3>
                  <form onSubmit={handleProductSubmit}>
                    <div className="form-group">
                      <label className="form-label">Product Name</label>
                      <input
                        type="text"
                        className="form-input"
                        value={productFormData.name}
                        onChange={(e) => setProductFormData({...productFormData, name: e.target.value})}
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label className="form-label">Description</label>
                      <textarea
                        className="form-input"
                        value={productFormData.description}
                        onChange={(e) => setProductFormData({...productFormData, description: e.target.value})}
                        rows="3"
                      />
                    </div>
                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'}}>
                      <div className="form-group">
                        <label className="form-label">Price</label>
                        <input
                          type="number"
                          step="0.01"
                          className="form-input"
                          value={productFormData.price}
                          onChange={(e) => setProductFormData({...productFormData, price: e.target.value})}
                          required
                        />
                      </div>
                      <div className="form-group">
                        <label className="form-label">Compare At Price</label>
                        <input
                          type="number"
                          step="0.01"
                          className="form-input"
                          value={productFormData.compareAtPrice}
                          onChange={(e) => setProductFormData({...productFormData, compareAtPrice: e.target.value})}
                        />
                      </div>
                    </div>
                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'}}>
                      <div className="form-group">
                        <label className="form-label">Category</label>
                        <select
                          className="form-input"
                          value={productFormData.categoryId}
                          onChange={(e) => setProductFormData({...productFormData, categoryId: e.target.value})}
                        >
                          <option value="">Select Category</option>
                          {categories.map(category => (
                            <option key={category.id} value={category.id}>{category.name}</option>
                          ))}
                        </select>
                      </div>
                      <div className="form-group">
                        <label className="form-label">Supplier</label>
                        <select
                          className="form-input"
                          value={productFormData.supplierId || ''}
                          onChange={(e) => setProductFormData({...productFormData, supplierId: e.target.value})}
                        >
                          <option value="">Select Supplier</option>
                          {suppliers.map(supplier => (
                            <option key={supplier.id} value={supplier.id}>{supplier.name}</option>
                          ))}
                        </select>
                      </div>
                    </div>
                    <div className="form-group">
                      <label className="form-label">Image URL (Legacy - Optional)</label>
                      <input
                        type="url"
                        className="form-input"
                        value={productFormData.imageUrl}
                        onChange={(e) => setProductFormData({...productFormData, imageUrl: e.target.value})}
                        placeholder="https://example.com/image.jpg"
                      />
                    </div>
                    
                    <div className="form-group">
                      <label className="form-label">Product Images</label>
                      <div 
                        className="image-upload-zone"
                        style={{
                          border: '2px dashed #ddd',
                          borderRadius: '8px',
                          padding: '20px',
                          textAlign: 'center',
                          backgroundColor: '#f9f9f9',
                          marginBottom: '15px'
                        }}
                        onDragOver={(e) => {
                          e.preventDefault();
                          e.currentTarget.style.borderColor = '#007bff';
                          e.currentTarget.style.backgroundColor = '#e3f2fd';
                        }}
                        onDragLeave={(e) => {
                          e.preventDefault();
                          e.currentTarget.style.borderColor = '#ddd';
                          e.currentTarget.style.backgroundColor = '#f9f9f9';
                        }}
                        onDrop={(e) => {
                          e.preventDefault();
                          e.currentTarget.style.borderColor = '#ddd';
                          e.currentTarget.style.backgroundColor = '#f9f9f9';
                          
                          const files = e.dataTransfer.files;
                          if (files && files.length > 0) {
                            uploadImages(files);
                          }
                        }}
                      >
                        <input
                          type="file"
                          multiple
                          accept="image/*"
                          onChange={(e) => {
                            if (e.target.files && e.target.files.length > 0) {
                              uploadImages(e.target.files);
                            }
                          }}
                          style={{display: 'none'}}
                          id="image-upload"
                        />
                        <label
                          htmlFor="image-upload"
                          style={{
                            cursor: uploading ? 'not-allowed' : 'pointer',
                            color: uploading ? '#666' : '#007bff',
                            textDecoration: uploading ? 'none' : 'underline'
                          }}
                        >
                          {uploading ? 'Uploading...' : 'Click to upload images or drag and drop'}
                        </label>
                        
                        {uploading && (
                          <div style={{
                            width: '100%',
                            height: '4px',
                            backgroundColor: '#e0e0e0',
                            borderRadius: '2px',
                            margin: '10px 0',
                            overflow: 'hidden'
                          }}>
                            <div style={{
                              height: '100%',
                              backgroundColor: '#007bff',
                              width: '100%',
                              animation: 'pulse 1.5s ease-in-out infinite'
                            }}></div>
                          </div>
                        )}
                        
                        <p style={{color: '#666', fontSize: '14px', marginTop: '10px'}}>
                          Maximum 10 images, 5MB each. Supported formats: JPG, PNG, GIF, WebP
                          {uploadedImages.length > 0 && (
                            <span style={{display: 'block', marginTop: '5px', color: '#28a745'}}>
                              ({uploadedImages.length}/10 images uploaded)
                            </span>
                          )}
                        </p>
                      </div>
                      
                      {uploadedImages.length > 0 && (
                        <div style={{
                          display: 'grid',
                          gridTemplateColumns: 'repeat(auto-fill, minmax(120px, 1fr))',
                          gap: '10px',
                          marginTop: '15px'
                        }}>
                          {uploadedImages.map((image, index) => (
                            <div key={index} className="image-thumbnail" style={{
                              position: 'relative',
                              border: '1px solid #ddd',
                              borderRadius: '8px',
                              overflow: 'hidden',
                              backgroundColor: '#fff'
                            }}>
                              <img
                                src={image.thumbnailUrl || image.url}
                                alt={`Product image ${index + 1}`}
                                style={{
                                  width: '100%',
                                  height: '100px',
                                  objectFit: 'cover',
                                  display: 'block'
                                }}
                              />
                              <div style={{
                                position: 'absolute',
                                top: '5px',
                                right: '5px',
                                display: 'flex',
                                gap: '5px'
                              }}>
                                {index === 0 && (
                                  <span style={{
                                    backgroundColor: '#28a745',
                                    color: 'white',
                                    padding: '2px 6px',
                                    borderRadius: '3px',
                                    fontSize: '10px',
                                    fontWeight: 'bold'
                                  }}>
                                    MAIN
                                  </span>
                                )}
                                <button
                                  type="button"
                                  onClick={() => deleteImage(image.filename, index)}
                                  style={{
                                    backgroundColor: '#dc3545',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '3px',
                                    padding: '2px 6px',
                                    fontSize: '10px',
                                    cursor: 'pointer'
                                  }}
                                >
                                  √ó
                                </button>
                              </div>
                              
                              {index !== 0 && (
                                <div style={{
                                  position: 'absolute',
                                  bottom: '25px',
                                  left: '5px',
                                  right: '5px'
                                }}>
                                  <button
                                    type="button"
                                    onClick={() => setAsMainImage(index)}
                                    style={{
                                      backgroundColor: '#007bff',
                                      color: 'white',
                                      border: 'none',
                                      borderRadius: '3px',
                                      padding: '3px 6px',
                                      fontSize: '10px',
                                      cursor: 'pointer',
                                      width: '100%'
                                    }}
                                  >
                                    Set as Main
                                  </button>
                                </div>
                              )}
                              <div style={{
                                padding: '5px',
                                fontSize: '11px',
                                color: '#666',
                                textAlign: 'center'
                              }}>
                                {image.originalName}
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                    <div className="form-group">
                      <label className="form-label">Stock Quantity</label>
                      <input
                        type="number"
                        className="form-input"
                        value={productFormData.stockQuantity}
                        onChange={(e) => setProductFormData({...productFormData, stockQuantity: e.target.value})}
                      />
                    </div>
                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '15px'}}>
                      <div className="form-group">
                        <label className="form-label">VAT Percentage (%)</label>
                        <select
                          className="form-input"
                          value={productFormData.vatPercentage || '19.00'}
                          onChange={(e) => setProductFormData({...productFormData, vatPercentage: e.target.value})}
                        >
                          <option value="0.00">0% (Reverse Charge)</option>
                          <option value="5.00">5% (Reduced VAT)</option>
                          <option value="9.00">9% (Reduced VAT)</option>
                          <option value="19.00">19% (Standard VAT)</option>
                          <option value="21.00">21% (Standard VAT - from 01.08.2025)</option>
                          <option value="24.00">24% (Luxury VAT)</option>
                        </select>
                      </div>
                      <div className="form-group">
                        <label className="form-label">Currency</label>
                        <select
                          className="form-input"
                          value={productFormData.currency}
                          onChange={(e) => setProductFormData({...productFormData, currency: e.target.value})}
                        >
                          <option value="EUR">EUR (Euro)</option>
                          <option value="RON">RON (Romanian Leu)</option>
                          <option value="USD">USD (US Dollar)</option>
                          <option value="GBP">GBP (British Pound)</option>
                        </select>
                      </div>
                      <div className="form-group">
                        <label className="form-label">VAT Value (%)</label>
                        <input
                          type="number"
                          step="0.01"
                          className="form-input"
                          value={productFormData.vatValue}
                          onChange={(e) => setProductFormData({...productFormData, vatValue: e.target.value})}
                          placeholder="19.00"
                        />
                      </div>
                    </div>
                    <div style={{display: 'grid', gridTemplateColumns: '1fr', gap: '15px'}}>
                      <div className="form-group">
                        <label className="form-label">Product Code</label>
                        <input
                          type="text"
                          className="form-input"
                          value={productFormData.productCode}
                          onChange={(e) => setProductFormData({...productFormData, productCode: e.target.value})}
                          placeholder="ABC-123-DEF"
                        />
                      </div>
                    </div>
                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'}}>
                      <div className="form-group">
                        <label className="form-label">NC Code</label>
                        <input
                          type="text"
                          className="form-input"
                          value={productFormData.ncCode}
                          onChange={(e) => setProductFormData({...productFormData, ncCode: e.target.value})}
                          placeholder="1234.56.78"
                        />
                      </div>
                      <div className="form-group">
                        <label className="form-label">CPV Code</label>
                        <input
                          type="text"
                          className="form-input"
                          value={productFormData.cpvCode}
                          onChange={(e) => setProductFormData({...productFormData, cpvCode: e.target.value})}
                          placeholder="39000000-0"
                        />
                      </div>
                    </div>
                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'}}>
                      <div className="form-group">
                        <label className="form-label">Status</label>
                        <select
                          className="form-input"
                          value={productFormData.status}
                          onChange={(e) => setProductFormData({...productFormData, status: e.target.value})}
                        >
                          <option value="active">Active</option>
                          <option value="inactive">Inactive</option>
                          <option value="draft">Draft</option>
                          <option value="discontinued">Discontinued</option>
                        </select>
                      </div>
                      <div className="form-group">
                        <label style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                          <input
                            type="checkbox"
                            checked={productFormData.featured}
                            onChange={(e) => setProductFormData({...productFormData, featured: e.target.checked})}
                          />
                          Featured Product
                        </label>
                      </div>
                    </div>
                    <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                      <button type="submit" className="btn" style={{background: '#28a745'}}>
                        {editingProduct ? 'Update Product' : 'Create Product'}
                      </button>
                      <button
                        type="button"
                        className="btn"
                        style={{background: '#6c757d'}}
                        onClick={() => {
                          setShowAddProductModal(false);
                          setEditingProduct(null);
                          setProductFormData({
                            name: '',
                            description: '',
                            price: '',
                            compareAtPrice: '',
                            categoryId: '',
                            supplierId: '',
                            imageUrl: '',
                            stockQuantity: '',
                            featured: false,
                            vatValue: '',
                            vatPercentage: '19.00',
                            currency: 'RON',
                            productCode: '',
                            ncCode: '',
                            cpvCode: '',
                            status: 'active',
                            images: []
                          });
                          setUploadedImages([]);
                        }}
                      >
                        Cancel
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}
            
            {/* Bulk Operations Modal */}
            {showBulkModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '600px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    {bulkOperation === 'status' ? 'üîÑ Bulk Status Update' : 'üõ†Ô∏è Bulk Order Tools'}
                  </h3>
                  <p style={{marginBottom: '20px', color: '#666'}}>
                    Selected {selectedOrders.length} orders for bulk operation.
                  </p>
                  
                  {bulkOperation === 'status' && (
                    <BulkStatusComponent />
                  )}
                  
                  {bulkOperation === 'tools' && (
                    <BulkToolsComponent />
                  )}
                  
                  <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                    <button
                      type="button"
                      className="btn"
                      style={{background: '#6c757d'}}
                      onClick={() => {
                        setShowBulkModal(false);
                        setBulkOperation('');
                        setBulkResults(null);
                      }}
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Product Bulk Operations Modal */}
            {showProductBulkModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '600px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    üì¶ Product Bulk Operations
                  </h3>
                  <p style={{marginBottom: '20px', color: '#666'}}>
                    Selected {selectedProducts.length} products for bulk operation.
                  </p>
                  
                  <ProductBulkOperationsComponent />
                  
                  <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                    <button
                      type="button"
                      className="btn"
                      style={{background: '#6c757d'}}
                      onClick={() => {
                        setShowProductBulkModal(false);
                        setProductBulkOperation('');
                      }}
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Order Details Modal */}
            {showOrderDetails && selectedOrder && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '800px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    üìã Order Details - #{selectedOrder.id}
                  </h3>
                  
                  <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '20px', marginBottom: '20px'}}>
                    <div style={{padding: '15px', background: '#f8f9fa', borderRadius: '6px'}}>
                      <h4 style={{color: '#333', marginBottom: '10px'}}>Order Information</h4>
                      <p><strong>Order ID:</strong> #{selectedOrder.id}</p>
                      <p><strong>Status:</strong> <span style={{
                        padding: '4px 8px', 
                        borderRadius: '4px', 
                        backgroundColor: selectedOrder.status === 'pending' ? '#fff3cd' : selectedOrder.status === 'processing' ? '#cce5ff' : '#d4edda',
                        color: selectedOrder.status === 'pending' ? '#856404' : selectedOrder.status === 'processing' ? '#0056b3' : '#155724'
                      }}>{selectedOrder.status}</span></p>
                      <p><strong>Total Amount:</strong> ${selectedOrder.totalAmount}</p>
                      <p><strong>Payment Method:</strong> {selectedOrder.paymentMethod}</p>
                      <p><strong>Payment Status:</strong> {selectedOrder.paymentStatus}</p>
                      <p><strong>Created:</strong> {new Date(selectedOrder.createdAt).toLocaleString()}</p>
                    </div>
                    
                    <div style={{padding: '15px', background: '#f8f9fa', borderRadius: '6px'}}>
                      <h4 style={{color: '#333', marginBottom: '10px'}}>Customer Information</h4>
                      <p><strong>Name:</strong> {selectedOrder.shippingAddress.name}</p>
                      <p><strong>User ID:</strong> #{selectedOrder.userId}</p>
                      <p><strong>Email:</strong> user_{selectedOrder.userId}@example.com</p>
                    </div>
                  </div>
                  
                  <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px', marginBottom: '20px'}}>
                    <div style={{padding: '15px', background: '#f8f9fa', borderRadius: '6px'}}>
                      <h4 style={{color: '#333', marginBottom: '10px'}}>Shipping Address</h4>
                      <p>{selectedOrder.shippingAddress.name}</p>
                      <p>{selectedOrder.shippingAddress.street}</p>
                      <p>{selectedOrder.shippingAddress.city}, {selectedOrder.shippingAddress.state} {selectedOrder.shippingAddress.zipCode}</p>
                      <p>{selectedOrder.shippingAddress.country}</p>
                    </div>
                    
                    <div style={{padding: '15px', background: '#f8f9fa', borderRadius: '6px'}}>
                      <h4 style={{color: '#333', marginBottom: '10px'}}>Billing Address</h4>
                      <p>{selectedOrder.billingAddress.name}</p>
                      <p>{selectedOrder.billingAddress.street}</p>
                      <p>{selectedOrder.billingAddress.city}, {selectedOrder.billingAddress.state} {selectedOrder.billingAddress.zipCode}</p>
                      <p>{selectedOrder.billingAddress.country}</p>
                    </div>
                  </div>
                  
                  <div style={{padding: '15px', background: '#f8f9fa', borderRadius: '6px', marginBottom: '20px'}}>
                    <h4 style={{color: '#333', marginBottom: '15px'}}>Order Items</h4>
                    <div style={{overflowX: 'auto'}}>
                      <table style={{width: '100%', borderCollapse: 'collapse'}}>
                        <thead>
                          <tr style={{backgroundColor: '#e9ecef'}}>
                            <th style={{padding: '10px', textAlign: 'left', borderBottom: '1px solid #dee2e6'}}>Product</th>
                            <th style={{padding: '10px', textAlign: 'left', borderBottom: '1px solid #dee2e6'}}>Quantity</th>
                            <th style={{padding: '10px', textAlign: 'left', borderBottom: '1px solid #dee2e6'}}>Price</th>
                            <th style={{padding: '10px', textAlign: 'left', borderBottom: '1px solid #dee2e6'}}>Total</th>
                          </tr>
                        </thead>
                        <tbody>
                          {selectedOrder.items && selectedOrder.items.map((item, index) => (
                            <tr key={index} style={{borderBottom: '1px solid #dee2e6'}}>
                              <td style={{padding: '10px'}}>
                                <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                                  {item.product && item.product.imageUrl && (
                                    <img 
                                      src={item.product.imageUrl} 
                                      alt={item.product.name}
                                      style={{width: '40px', height: '40px', objectFit: 'cover', borderRadius: '4px'}}
                                    />
                                  )}
                                  <span>{item.product ? item.product.name : `Product ID: ${item.productId}`}</span>
                                </div>
                              </td>
                              <td style={{padding: '10px'}}>{item.quantity}</td>
                              <td style={{padding: '10px'}}>${item.price}</td>
                              <td style={{padding: '10px', fontWeight: 'bold'}}>${item.totalPrice}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                  
                  {selectedOrder.notes && (
                    <div style={{padding: '15px', background: '#fff3cd', borderRadius: '6px', marginBottom: '20px'}}>
                      <h4 style={{color: '#333', marginBottom: '10px'}}>Order Notes</h4>
                      <p>{selectedOrder.notes}</p>
                    </div>
                  )}
                  
                  <div style={{padding: '15px', background: '#f8f9fa', borderRadius: '6px', marginBottom: '20px'}}>
                    <h4 style={{color: '#333', marginBottom: '15px'}}>Order Tools</h4>
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '10px'}}>
                      <button
                        className="btn"
                        style={{background: '#17a2b8', padding: '10px', display: 'flex', alignItems: 'center', gap: '8px', fontSize: '14px'}}
                        onClick={async () => {
                          const result = await performBulkOperation('shipping', [selectedOrder.id]);
                          if (result.success) {
                            alert(`Shipping label generated for Order #${selectedOrder.id}`);
                          } else {
                            alert('Error: ' + result.message);
                          }
                        }}
                      >
                        <span>üì¶</span>
                        <span>Generate Shipping Label</span>
                      </button>
                      
                      <button
                        className="btn"
                        style={{background: '#ffc107', padding: '10px', display: 'flex', alignItems: 'center', gap: '8px', fontSize: '14px'}}
                        onClick={() => {
                          const message = prompt('Enter notification message for customer:');
                          if (message) {
                            performBulkOperation('notifications', [selectedOrder.id], { message }).then(result => {
                              if (result.success) {
                                alert(`Notification sent to customer for Order #${selectedOrder.id}`);
                              } else {
                                alert('Error: ' + result.message);
                              }
                            });
                          }
                        }}
                      >
                        <span>üìß</span>
                        <span>Send Notification</span>
                      </button>
                      
                      <button
                        className="btn"
                        style={{background: '#dc3545', padding: '10px', display: 'flex', alignItems: 'center', gap: '8px', fontSize: '14px'}}
                        onClick={() => {
                          if (confirm(`Are you sure you want to process a refund for Order #${selectedOrder.id}? This action cannot be undone.`)) {
                            performBulkOperation('refunds', [selectedOrder.id]).then(result => {
                              if (result.success) {
                                alert(`Refund processed for Order #${selectedOrder.id}`);
                              } else {
                                alert('Error: ' + result.message);
                              }
                            });
                          }
                        }}
                      >
                        <span>üí∏</span>
                        <span>Process Refund</span>
                      </button>
                      
                      <button
                        className="btn"
                        style={{background: '#28a745', padding: '10px', display: 'flex', alignItems: 'center', gap: '8px', fontSize: '14px'}}
                        onClick={() => {
                          const csvContent = `Order ID,Customer,Status,Amount,Date\n${selectedOrder.id},${selectedOrder.shippingAddress.name},${selectedOrder.status},${selectedOrder.totalAmount},${new Date(selectedOrder.createdAt).toLocaleDateString()}`;
                          
                          const blob = new Blob([csvContent], { type: 'text/csv' });
                          const url = window.URL.createObjectURL(blob);
                          const a = document.createElement('a');
                          a.href = url;
                          a.download = `order_${selectedOrder.id}_${new Date().toISOString().split('T')[0]}.csv`;
                          a.click();
                          window.URL.revokeObjectURL(url);
                          
                          alert(`Order #${selectedOrder.id} exported to CSV`);
                        }}
                      >
                        <span>üìä</span>
                        <span>Export to CSV</span>
                      </button>
                      
                      <button
                        className="btn"
                        style={{background: '#6f42c1', padding: '10px', display: 'flex', alignItems: 'center', gap: '8px', fontSize: '14px'}}
                        onClick={() => {
                          const newStatus = prompt(`Update order status for Order #${selectedOrder.id}:\n\nCurrent status: ${selectedOrder.status}\n\nEnter new status (pending, processing, shipped, delivered, cancelled):`);
                          if (newStatus && ['pending', 'processing', 'shipped', 'delivered', 'cancelled'].includes(newStatus.toLowerCase())) {
                            updateOrderStatus(selectedOrder.id, newStatus.toLowerCase()).then(result => {
                              if (result.success) {
                                alert('Order status updated successfully');
                                // Update the selected order status in the modal
                                setSelectedOrder({...selectedOrder, status: newStatus.toLowerCase()});
                              } else {
                                alert('Error: ' + result.message);
                              }
                            });
                          } else if (newStatus) {
                            alert('Invalid status. Please use: pending, processing, shipped, delivered, or cancelled');
                          }
                        }}
                      >
                        <span>‚úèÔ∏è</span>
                        <span>Update Status</span>
                      </button>
                      
                      <button
                        className="btn"
                        style={{background: '#fd7e14', padding: '10px', display: 'flex', alignItems: 'center', gap: '8px', fontSize: '14px'}}
                        onClick={() => {
                          const invoice = `
INVOICE - Order #${selectedOrder.id}
========================================
Customer: ${selectedOrder.shippingAddress.name}
Date: ${new Date(selectedOrder.createdAt).toLocaleDateString()}
Status: ${selectedOrder.status}
Payment Method: ${selectedOrder.paymentMethod}
Payment Status: ${selectedOrder.paymentStatus}

SHIPPING ADDRESS:
${selectedOrder.shippingAddress.name}
${selectedOrder.shippingAddress.street}
${selectedOrder.shippingAddress.city}, ${selectedOrder.shippingAddress.state} ${selectedOrder.shippingAddress.zipCode}
${selectedOrder.shippingAddress.country}

ITEMS:
${selectedOrder.items ? selectedOrder.items.map(item => `${item.quantity}x ${item.product ? item.product.name : 'Product ID: ' + item.productId} - $${item.price} each = $${item.totalPrice}`).join('\n') : 'No items'}

TOTAL: $${selectedOrder.totalAmount}
========================================
                          `;
                          
                          const blob = new Blob([invoice], { type: 'text/plain' });
                          const url = window.URL.createObjectURL(blob);
                          const a = document.createElement('a');
                          a.href = url;
                          a.download = `invoice_${selectedOrder.id}.txt`;
                          a.click();
                          window.URL.revokeObjectURL(url);
                          
                          alert(`Invoice for Order #${selectedOrder.id} downloaded`);
                        }}
                      >
                        <span>üìÑ</span>
                        <span>Download Invoice</span>
                      </button>
                    </div>
                  </div>
                  
                  <div style={{display: 'flex', gap: '10px', justifyContent: 'flex-end'}}>
                    <button
                      type="button"
                      className="btn"
                      style={{background: '#6c757d'}}
                      onClick={() => {
                        setShowOrderDetails(false);
                        setSelectedOrder(null);
                      }}
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Order Tools Modal */}
            {showOrderTools && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '600px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    üõ†Ô∏è Order Tools
                  </h3>
                  <p style={{marginBottom: '20px', color: '#666'}}>
                    Selected {selectedOrders.length} orders for advanced operations.
                  </p>
                  
                  <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '15px', marginBottom: '20px'}}>
                    <button
                      className="btn"
                      style={{background: '#17a2b8', padding: '15px', display: 'flex', alignItems: 'center', gap: '10px'}}
                      onClick={async () => {
                        const result = await performBulkOperation('shipping', selectedOrders);
                        if (result.success) {
                          alert(`Shipping labels generated for ${selectedOrders.length} orders`);
                          setShowOrderTools(false);
                          setSelectedOrders([]);
                        } else {
                          alert('Error: ' + result.message);
                        }
                      }}
                    >
                      <span style={{fontSize: '20px'}}>üì¶</span>
                      <div style={{textAlign: 'left'}}>
                        <div style={{fontWeight: 'bold'}}>Generate Shipping Labels</div>
                        <div style={{fontSize: '12px', opacity: '0.8'}}>Create shipping labels for selected orders</div>
                      </div>
                    </button>
                    
                    <button
                      className="btn"
                      style={{background: '#ffc107', padding: '15px', display: 'flex', alignItems: 'center', gap: '10px'}}
                      onClick={() => {
                        const message = prompt('Enter notification message for customers:');
                        if (message) {
                          performBulkOperation('notifications', selectedOrders, { message }).then(result => {
                            if (result.success) {
                              alert(`Notifications sent to ${selectedOrders.length} customers`);
                              setShowOrderTools(false);
                              setSelectedOrders([]);
                            } else {
                              alert('Error: ' + result.message);
                            }
                          });
                        }
                      }}
                    >
                      <span style={{fontSize: '20px'}}>üìß</span>
                      <div style={{textAlign: 'left'}}>
                        <div style={{fontWeight: 'bold'}}>Send Notifications</div>
                        <div style={{fontSize: '12px', opacity: '0.8'}}>Send email notifications to customers</div>
                      </div>
                    </button>
                    
                    <button
                      className="btn"
                      style={{background: '#dc3545', padding: '15px', display: 'flex', alignItems: 'center', gap: '10px'}}
                      onClick={() => {
                        if (confirm('Are you sure you want to process refunds for the selected orders? This action cannot be undone.')) {
                          performBulkOperation('refunds', selectedOrders).then(result => {
                            if (result.success) {
                              alert(`Refunds processed for ${selectedOrders.length} orders`);
                              setShowOrderTools(false);
                              setSelectedOrders([]);
                            } else {
                              alert('Error: ' + result.message);
                            }
                          });
                        }
                      }}
                    >
                      <span style={{fontSize: '20px'}}>üí∏</span>
                      <div style={{textAlign: 'left'}}>
                        <div style={{fontWeight: 'bold'}}>Process Refunds</div>
                        <div style={{fontSize: '12px', opacity: '0.8'}}>Issue refunds for selected orders</div>
                      </div>
                    </button>
                    
                    <button
                      className="btn"
                      style={{background: '#28a745', padding: '15px', display: 'flex', alignItems: 'center', gap: '10px'}}
                      onClick={() => {
                        const orderIds = selectedOrders.join(', ');
                        const csvContent = `Order ID,Customer,Status,Amount,Date\n${selectedOrders.map(id => {
                          const order = filteredOrders.find(o => o.id === id);
                          return `${order.id},User ${order.userId},${order.status},${order.totalAmount},${new Date(order.createdAt).toLocaleDateString()}`;
                        }).join('\n')}`;
                        
                        const blob = new Blob([csvContent], { type: 'text/csv' });
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `orders_${new Date().toISOString().split('T')[0]}.csv`;
                        a.click();
                        window.URL.revokeObjectURL(url);
                        
                        alert(`Exported ${selectedOrders.length} orders to CSV`);
                        setShowOrderTools(false);
                        setSelectedOrders([]);
                      }}
                    >
                      <span style={{fontSize: '20px'}}>üìä</span>
                      <div style={{textAlign: 'left'}}>
                        <div style={{fontWeight: 'bold'}}>Export to CSV</div>
                        <div style={{fontSize: '12px', opacity: '0.8'}}>Download order data as CSV file</div>
                      </div>
                    </button>
                  </div>
                  
                  <div style={{display: 'flex', gap: '10px', justifyContent: 'flex-end'}}>
                    <button
                      type="button"
                      className="btn"
                      style={{background: '#6c757d'}}
                      onClick={() => {
                        setShowOrderTools(false);
                      }}
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Edit Supplier Modal */}
            {showEditSupplierModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '800px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    ‚úèÔ∏è Edit Supplier
                  </h3>
                  
                  <form onSubmit={handleSupplierSubmit}>
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px'}}>
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          Company Name *
                        </label>
                        <input
                          type="text"
                          value={supplierFormData.name}
                          onChange={(e) => setSupplierFormData({...supplierFormData, name: e.target.value})}
                          required
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          Email *
                        </label>
                        <input
                          type="email"
                          value={supplierFormData.email}
                          onChange={(e) => setSupplierFormData({...supplierFormData, email: e.target.value})}
                          required
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          Phone
                        </label>
                        <input
                          type="tel"
                          value={supplierFormData.phone}
                          onChange={(e) => setSupplierFormData({...supplierFormData, phone: e.target.value})}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          Contact Person
                        </label>
                        <input
                          type="text"
                          value={supplierFormData.contactPerson}
                          onChange={(e) => setSupplierFormData({...supplierFormData, contactPerson: e.target.value})}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                    </div>
                    
                    <div style={{marginTop: '20px'}}>
                      <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                        Address
                      </label>
                      <input
                        type="text"
                        value={supplierFormData.address}
                        onChange={(e) => setSupplierFormData({...supplierFormData, address: e.target.value})}
                        style={{
                          width: '100%',
                          padding: '8px',
                          border: '1px solid #ddd',
                          borderRadius: '4px'
                        }}
                      />
                    </div>
                    
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px', marginTop: '20px'}}>
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          City
                        </label>
                        <input
                          type="text"
                          value={supplierFormData.city}
                          onChange={(e) => setSupplierFormData({...supplierFormData, city: e.target.value})}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          State/Region
                        </label>
                        <input
                          type="text"
                          value={supplierFormData.state}
                          onChange={(e) => setSupplierFormData({...supplierFormData, state: e.target.value})}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          ZIP Code
                        </label>
                        <input
                          type="text"
                          value={supplierFormData.zipCode}
                          onChange={(e) => setSupplierFormData({...supplierFormData, zipCode: e.target.value})}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          Country
                        </label>
                        <input
                          type="text"
                          value={supplierFormData.country}
                          onChange={(e) => setSupplierFormData({...supplierFormData, country: e.target.value})}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                    </div>
                    
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px', marginTop: '20px'}}>
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          Integration Type
                        </label>
                        <select
                          value={supplierFormData.integrationType}
                          onChange={(e) => setSupplierFormData({...supplierFormData, integrationType: e.target.value})}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        >
                          <option value="email">Email</option>
                          <option value="api">API</option>
                          <option value="manual">Manual</option>
                        </select>
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                          Status
                        </label>
                        <select
                          value={supplierFormData.isActive}
                          onChange={(e) => setSupplierFormData({...supplierFormData, isActive: e.target.value === 'true'})}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        >
                          <option value="true">Active</option>
                          <option value="false">Inactive</option>
                        </select>
                      </div>
                    </div>
                    
                    {supplierFormData.integrationType === 'api' && (
                      <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px', marginTop: '20px'}}>
                        <div>
                          <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                            API Endpoint
                          </label>
                          <input
                            type="url"
                            value={supplierFormData.apiEndpoint}
                            onChange={(e) => setSupplierFormData({...supplierFormData, apiEndpoint: e.target.value})}
                            placeholder="https://api.supplier.com/v1/"
                            style={{
                              width: '100%',
                              padding: '8px',
                              border: '1px solid #ddd',
                              borderRadius: '4px'
                            }}
                          />
                        </div>
                        
                        <div>
                          <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                            API Key
                          </label>
                          <input
                            type="password"
                            value={supplierFormData.apiKey}
                            onChange={(e) => setSupplierFormData({...supplierFormData, apiKey: e.target.value})}
                            placeholder="Enter API key"
                            style={{
                              width: '100%',
                              padding: '8px',
                              border: '1px solid #ddd',
                              borderRadius: '4px'
                            }}
                          />
                        </div>
                      </div>
                    )}
                    
                    <div style={{marginTop: '20px'}}>
                      <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>
                        Notes
                      </label>
                      <textarea
                        value={supplierFormData.notes}
                        onChange={(e) => setSupplierFormData({...supplierFormData, notes: e.target.value})}
                        rows="3"
                        style={{
                          width: '100%',
                          padding: '8px',
                          border: '1px solid #ddd',
                          borderRadius: '4px',
                          resize: 'vertical'
                        }}
                      />
                    </div>
                    
                    <div style={{display: 'flex', gap: '10px', justifyContent: 'flex-end', marginTop: '20px'}}>
                      <button
                        type="button"
                        className="btn"
                        style={{background: '#6c757d'}}
                        onClick={() => {
                          setShowEditSupplierModal(false);
                          setEditingSupplier(null);
                        }}
                      >
                        Cancel
                      </button>
                      <button
                        type="submit"
                        className="btn"
                        style={{background: '#007bff'}}
                      >
                        ‚úÖ Update Supplier
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}
            
            {/* View Supplier Modal */}
            {showViewSupplierModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '1000px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    üëÅÔ∏è Supplier Details - {viewingSupplier?.name}
                  </h3>
                  
                  {supplierDetails ? (
                    <div>
                      {/* Supplier Overview */}
                      <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px', marginBottom: '30px'}}>
                        <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                          <h4 style={{marginBottom: '10px', color: '#495057'}}>Total Products</h4>
                          <p style={{fontSize: '24px', fontWeight: 'bold', color: '#007bff', margin: '0'}}>{supplierDetails.totalProducts}</p>
                        </div>
                        <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                          <h4 style={{marginBottom: '10px', color: '#495057'}}>Total Orders</h4>
                          <p style={{fontSize: '24px', fontWeight: 'bold', color: '#28a745', margin: '0'}}>{supplierDetails.totalOrders}</p>
                        </div>
                        <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                          <h4 style={{marginBottom: '10px', color: '#495057'}}>Total Revenue</h4>
                          <p style={{fontSize: '24px', fontWeight: 'bold', color: '#28a745', margin: '0'}}>‚Ç¨{supplierDetails.totalRevenue.toFixed(2)}</p>
                        </div>
                        <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                          <h4 style={{marginBottom: '10px', color: '#495057'}}>Status</h4>
                          <p style={{fontSize: '18px', fontWeight: 'bold', color: supplierDetails.supplier.isActive ? '#28a745' : '#dc3545', margin: '0'}}>
                            {supplierDetails.supplier.isActive ? 'Active' : 'Inactive'}
                          </p>
                        </div>
                      </div>
                      
                      {/* Contact Information */}
                      <div style={{marginBottom: '30px'}}>
                        <h4 style={{marginBottom: '15px', color: '#333', borderBottom: '2px solid #007bff', paddingBottom: '5px'}}>üìû Contact Information</h4>
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '15px'}}>
                          <div>
                            <strong>Email:</strong> {supplierDetails.supplier.email || 'Not provided'}
                          </div>
                          <div>
                            <strong>Phone:</strong> {supplierDetails.supplier.phone || 'Not provided'}
                          </div>
                          <div>
                            <strong>Contact Person:</strong> {supplierDetails.supplier.contactPerson || 'Not provided'}
                          </div>
                          <div>
                            <strong>Integration Type:</strong> {supplierDetails.supplier.integrationType || 'Email'}
                          </div>
                        </div>
                        
                        {supplierDetails.supplier.address && (
                          <div style={{marginTop: '15px'}}>
                            <strong>Address:</strong><br />
                            {supplierDetails.supplier.address}<br />
                            {supplierDetails.supplier.city && `${supplierDetails.supplier.city}, `}
                            {supplierDetails.supplier.state && `${supplierDetails.supplier.state} `}
                            {supplierDetails.supplier.zipCode}<br />
                            {supplierDetails.supplier.country}
                          </div>
                        )}
                        
                        {supplierDetails.supplier.notes && (
                          <div style={{marginTop: '15px'}}>
                            <strong>Notes:</strong><br />
                            <div style={{padding: '10px', background: '#f8f9fa', borderRadius: '4px', marginTop: '5px'}}>
                              {supplierDetails.supplier.notes}
                            </div>
                          </div>
                        )}
                      </div>
                      
                      {/* API Integration Info */}
                      {supplierDetails.supplier.integrationType === 'api' && (
                        <div style={{marginBottom: '30px'}}>
                          <h4 style={{marginBottom: '15px', color: '#333', borderBottom: '2px solid #17a2b8', paddingBottom: '5px'}}>üîó API Integration</h4>
                          <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '15px'}}>
                            <div>
                              <strong>API Endpoint:</strong> {supplierDetails.supplier.apiEndpoint || 'Not configured'}
                            </div>
                            <div>
                              <strong>API Key:</strong> {supplierDetails.supplier.apiKey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : 'Not configured'}
                            </div>
                          </div>
                        </div>
                      )}
                      
                      {/* Associated Products */}
                      <div style={{marginBottom: '30px'}}>
                        <h4 style={{marginBottom: '15px', color: '#333', borderBottom: '2px solid #ffc107', paddingBottom: '5px'}}>üì¶ Associated Products ({supplierDetails.totalProducts})</h4>
                        {supplierDetails.products.length > 0 ? (
                          <div style={{overflowX: 'auto'}}>
                            <table style={{width: '100%', borderCollapse: 'collapse'}}>
                              <thead>
                                <tr style={{backgroundColor: '#f5f5f5'}}>
                                  <th style={{padding: '8px', textAlign: 'left', borderBottom: '1px solid #ddd'}}>Product</th>
                                  <th style={{padding: '8px', textAlign: 'left', borderBottom: '1px solid #ddd'}}>Price</th>
                                  <th style={{padding: '8px', textAlign: 'left', borderBottom: '1px solid #ddd'}}>Stock</th>
                                  <th style={{padding: '8px', textAlign: 'left', borderBottom: '1px solid #ddd'}}>Status</th>
                                </tr>
                              </thead>
                              <tbody>
                                {supplierDetails.products.slice(0, 5).map((product, index) => (
                                  <tr key={index} style={{borderBottom: '1px solid #eee'}}>
                                    <td style={{padding: '8px'}}>{product.name}</td>
                                    <td style={{padding: '8px'}}>‚Ç¨{product.price}</td>
                                    <td style={{padding: '8px'}}>{product.stockQuantity}</td>
                                    <td style={{padding: '8px'}}>
                                      <span style={{
                                        padding: '2px 6px',
                                        borderRadius: '3px',
                                        backgroundColor: product.status === 'active' ? '#d4edda' : '#f8d7da',
                                        color: product.status === 'active' ? '#155724' : '#721c24',
                                        fontSize: '12px'
                                      }}>
                                        {product.status}
                                      </span>
                                    </td>
                                  </tr>
                                ))}
                              </tbody>
                            </table>
                            {supplierDetails.products.length > 5 && (
                              <p style={{textAlign: 'center', marginTop: '10px', color: '#666'}}>
                                ... and {supplierDetails.products.length - 5} more products
                              </p>
                            )}
                          </div>
                        ) : (
                          <p style={{color: '#666', fontStyle: 'italic'}}>No products associated with this supplier</p>
                        )}
                      </div>
                      
                      {/* Recent Orders */}
                      <div style={{marginBottom: '30px'}}>
                        <h4 style={{marginBottom: '15px', color: '#333', borderBottom: '2px solid #28a745', paddingBottom: '5px'}}>üìã Recent Orders ({supplierDetails.totalOrders})</h4>
                        {supplierDetails.orders.length > 0 ? (
                          <div style={{overflowX: 'auto'}}>
                            <table style={{width: '100%', borderCollapse: 'collapse'}}>
                              <thead>
                                <tr style={{backgroundColor: '#f5f5f5'}}>
                                  <th style={{padding: '8px', textAlign: 'left', borderBottom: '1px solid #ddd'}}>Order ID</th>
                                  <th style={{padding: '8px', textAlign: 'left', borderBottom: '1px solid #ddd'}}>Date</th>
                                  <th style={{padding: '8px', textAlign: 'left', borderBottom: '1px solid #ddd'}}>Amount</th>
                                  <th style={{padding: '8px', textAlign: 'left', borderBottom: '1px solid #ddd'}}>Status</th>
                                </tr>
                              </thead>
                              <tbody>
                                {supplierDetails.orders.slice(0, 5).map((order, index) => (
                                  <tr key={index} style={{borderBottom: '1px solid #eee'}}>
                                    <td style={{padding: '8px'}}>#{order.id}</td>
                                    <td style={{padding: '8px'}}>{new Date(order.createdAt).toLocaleDateString()}</td>
                                    <td style={{padding: '8px'}}>‚Ç¨{order.totalAmount}</td>
                                    <td style={{padding: '8px'}}>
                                      <span style={{
                                        padding: '2px 6px',
                                        borderRadius: '3px',
                                        backgroundColor: order.status === 'delivered' ? '#d4edda' : order.status === 'pending' ? '#fff3cd' : '#f8d7da',
                                        color: order.status === 'delivered' ? '#155724' : order.status === 'pending' ? '#856404' : '#721c24',
                                        fontSize: '12px'
                                      }}>
                                        {order.status}
                                      </span>
                                    </td>
                                  </tr>
                                ))}
                              </tbody>
                            </table>
                            {supplierDetails.orders.length > 5 && (
                              <p style={{textAlign: 'center', marginTop: '10px', color: '#666'}}>
                                ... and {supplierDetails.orders.length - 5} more orders
                              </p>
                            )}
                          </div>
                        ) : (
                          <p style={{color: '#666', fontStyle: 'italic'}}>No orders from this supplier yet</p>
                        )}
                      </div>
                    </div>
                  ) : (
                    <div style={{textAlign: 'center', padding: '40px'}}>
                      <div className="loading"></div>
                      <p style={{marginTop: '20px', color: '#666'}}>Loading supplier details...</p>
                    </div>
                  )}
                  
                  <div style={{display: 'flex', gap: '10px', justifyContent: 'flex-end', marginTop: '20px'}}>
                    <button
                      type="button"
                      className="btn"
                      style={{background: '#6c757d'}}
                      onClick={() => {
                        setShowViewSupplierModal(false);
                        setViewingSupplier(null);
                        setSupplierDetails(null);
                      }}
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Supplier Bulk Operations Modal */}
            {showSupplierBulkModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '600px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    üîÑ Bulk Operations - {selectedSuppliers.length} supplier(s) selected
                  </h3>
                  
                  {supplierBulkOperation === 'menu' && (
                    <div>
                      <h4 style={{marginBottom: '20px'}}>Choose Operation</h4>
                      <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '15px', marginBottom: '20px'}}>
                        <button
                          className="btn"
                          style={{
                            background: '#28a745',
                            padding: '20px',
                            textAlign: 'left',
                            height: 'auto',
                            display: 'flex',
                            flexDirection: 'column',
                            alignItems: 'flex-start'
                          }}
                          onClick={() => setSupplierBulkOperation('activate')}
                        >
                          <div style={{fontSize: '16px', fontWeight: 'bold', marginBottom: '8px'}}>‚úÖ Activate Suppliers</div>
                          <div style={{fontSize: '12px', opacity: '0.9'}}>Enable order processing and API sync</div>
                        </button>
                        
                        <button
                          className="btn"
                          style={{
                            background: '#ffc107',
                            padding: '20px',
                            textAlign: 'left',
                            height: 'auto',
                            display: 'flex',
                            flexDirection: 'column',
                            alignItems: 'flex-start'
                          }}
                          onClick={() => setSupplierBulkOperation('deactivate')}
                        >
                          <div style={{fontSize: '16px', fontWeight: 'bold', marginBottom: '8px'}}>‚ùå Deactivate Suppliers</div>
                          <div style={{fontSize: '12px', opacity: '0.9'}}>Disable order processing and pause sync</div>
                        </button>
                        
                        <button
                          className="btn"
                          style={{
                            background: '#17a2b8',
                            padding: '20px',
                            textAlign: 'left',
                            height: 'auto',
                            display: 'flex',
                            flexDirection: 'column',
                            alignItems: 'flex-start'
                          }}
                          onClick={() => setSupplierBulkOperation('sync-prices')}
                        >
                          <div style={{fontSize: '16px', fontWeight: 'bold', marginBottom: '8px'}}>üí∞ Sync Prices</div>
                          <div style={{fontSize: '12px', opacity: '0.9'}}>Fetch latest prices from supplier APIs</div>
                        </button>
                        
                        <button
                          className="btn"
                          style={{
                            background: '#fd7e14',
                            padding: '20px',
                            textAlign: 'left',
                            height: 'auto',
                            display: 'flex',
                            flexDirection: 'column',
                            alignItems: 'flex-start'
                          }}
                          onClick={() => setSupplierBulkOperation('sync-stock')}
                        >
                          <div style={{fontSize: '16px', fontWeight: 'bold', marginBottom: '8px'}}>üìä Sync Stock</div>
                          <div style={{fontSize: '12px', opacity: '0.9'}}>Update inventory levels from suppliers</div>
                        </button>
                        
                        <button
                          className="btn"
                          style={{
                            background: '#6c757d',
                            padding: '20px',
                            textAlign: 'left',
                            height: 'auto',
                            display: 'flex',
                            flexDirection: 'column',
                            alignItems: 'flex-start'
                          }}
                          onClick={() => setSupplierBulkOperation('status')}
                        >
                          <div style={{fontSize: '16px', fontWeight: 'bold', marginBottom: '8px'}}>üîÑ Update Status</div>
                          <div style={{fontSize: '12px', opacity: '0.9'}}>Change supplier status with options</div>
                        </button>
                        
                        <button
                          className="btn"
                          style={{
                            background: '#dc3545',
                            padding: '20px',
                            textAlign: 'left',
                            height: 'auto',
                            display: 'flex',
                            flexDirection: 'column',
                            alignItems: 'flex-start'
                          }}
                          onClick={() => setSupplierBulkOperation('delete')}
                        >
                          <div style={{fontSize: '16px', fontWeight: 'bold', marginBottom: '8px'}}>üóëÔ∏è Delete Suppliers</div>
                          <div style={{fontSize: '12px', opacity: '0.9'}}>Permanently remove suppliers (requires confirmation)</div>
                        </button>
                      </div>
                      
                      <div style={{display: 'flex', justifyContent: 'flex-end'}}>
                        <button
                          className="btn"
                          style={{background: '#6c757d'}}
                          onClick={() => setShowSupplierBulkModal(false)}
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  )}
                  
                  {supplierBulkOperation === 'status' && (
                    <div>
                      <h4>Update Status</h4>
                      <div style={{marginBottom: '15px'}}>
                        <label style={{display: 'block', marginBottom: '5px', color: '#555'}}>New Status:</label>
                        <select 
                          id="bulkStatus"
                          style={{width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ddd'}}
                          defaultValue="active"
                        >
                          <option value="active">Active</option>
                          <option value="inactive">Inactive</option>
                        </select>
                      </div>
                      <div style={{display: 'flex', gap: '10px', justifyContent: 'space-between'}}>
                        <button
                          className="btn"
                          style={{background: '#6c757d'}}
                          onClick={() => setSupplierBulkOperation('menu')}
                        >
                          ‚Üê Back to Menu
                        </button>
                        <div style={{display: 'flex', gap: '10px'}}>
                          <button
                            className="btn"
                            style={{background: '#6c757d'}}
                            onClick={() => setShowSupplierBulkModal(false)}
                          >
                            Cancel
                          </button>
                          <button
                            className="btn"
                            style={{background: '#28a745'}}
                            onClick={async () => {
                              const status = document.getElementById('bulkStatus').value;
                              await performSupplierBulkOperation('status', { status });
                            }}
                          >
                            Update Status
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                  
                  {supplierBulkOperation === 'activate' && (
                    <div>
                      <h4>Activate Suppliers</h4>
                      <p style={{marginBottom: '20px', color: '#666'}}>
                        Are you sure you want to activate {selectedSuppliers.length} supplier(s)? This will:
                      </p>
                      <ul style={{marginBottom: '20px', paddingLeft: '20px'}}>
                        <li>Enable order processing from these suppliers</li>
                        <li>Allow API synchronization (if configured)</li>
                        <li>Include suppliers in bulk operations</li>
                        <li>Enable automatic notifications</li>
                      </ul>
                      <div style={{display: 'flex', gap: '10px', justifyContent: 'space-between'}}>
                        <button
                          className="btn"
                          style={{background: '#6c757d'}}
                          onClick={() => setSupplierBulkOperation('menu')}
                        >
                          ‚Üê Back to Menu
                        </button>
                        <div style={{display: 'flex', gap: '10px'}}>
                          <button
                            className="btn"
                            style={{background: '#6c757d'}}
                            onClick={() => setShowSupplierBulkModal(false)}
                          >
                            Cancel
                          </button>
                          <button
                            className="btn"
                            style={{background: '#28a745'}}
                            onClick={async () => {
                              await performSupplierBulkOperation('activate', {});
                            }}
                          >
                            Activate Suppliers
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                  
                  {supplierBulkOperation === 'deactivate' && (
                    <div>
                      <h4>Deactivate Suppliers</h4>
                      <p style={{marginBottom: '20px', color: '#666'}}>
                        Are you sure you want to deactivate {selectedSuppliers.length} supplier(s)? This will:
                      </p>
                      <ul style={{marginBottom: '20px', paddingLeft: '20px'}}>
                        <li>Disable order processing from these suppliers</li>
                        <li>Pause API synchronization</li>
                        <li>Exclude suppliers from bulk operations</li>
                        <li>Stop automatic notifications</li>
                      </ul>
                      <div style={{display: 'flex', gap: '10px', justifyContent: 'space-between'}}>
                        <button
                          className="btn"
                          style={{background: '#6c757d'}}
                          onClick={() => setSupplierBulkOperation('menu')}
                        >
                          ‚Üê Back to Menu
                        </button>
                        <div style={{display: 'flex', gap: '10px'}}>
                          <button
                            className="btn"
                            style={{background: '#6c757d'}}
                            onClick={() => setShowSupplierBulkModal(false)}
                          >
                            Cancel
                          </button>
                          <button
                            className="btn"
                            style={{background: '#ffc107'}}
                            onClick={async () => {
                              await performSupplierBulkOperation('deactivate', {});
                            }}
                          >
                            Deactivate Suppliers
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                  
                  {supplierBulkOperation === 'sync-prices' && (
                    <div>
                      <h4>Sync Prices</h4>
                      <p style={{marginBottom: '20px', color: '#666'}}>
                        Sync product prices from {selectedSuppliers.length} supplier(s). This will:
                      </p>
                      <ul style={{marginBottom: '20px', paddingLeft: '20px'}}>
                        <li>Fetch latest prices from supplier APIs</li>
                        <li>Update all associated products</li>
                        <li>Maintain price history</li>
                        <li>Send notifications on significant changes</li>
                      </ul>
                      <div style={{display: 'flex', gap: '10px', justifyContent: 'space-between'}}>
                        <button
                          className="btn"
                          style={{background: '#6c757d'}}
                          onClick={() => setSupplierBulkOperation('menu')}
                        >
                          ‚Üê Back to Menu
                        </button>
                        <div style={{display: 'flex', gap: '10px'}}>
                          <button
                            className="btn"
                            style={{background: '#6c757d'}}
                            onClick={() => setShowSupplierBulkModal(false)}
                          >
                            Cancel
                          </button>
                          <button
                            className="btn"
                            style={{background: '#17a2b8'}}
                            onClick={async () => {
                              await performSupplierBulkOperation('sync-prices', {});
                            }}
                          >
                            Sync Prices
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                  
                  {supplierBulkOperation === 'sync-stock' && (
                    <div>
                      <h4>Sync Stock</h4>
                      <p style={{marginBottom: '20px', color: '#666'}}>
                        Sync stock levels from {selectedSuppliers.length} supplier(s). This will:
                      </p>
                      <ul style={{marginBottom: '20px', paddingLeft: '20px'}}>
                        <li>Fetch current inventory levels</li>
                        <li>Update product availability</li>
                        <li>Trigger low stock alerts</li>
                        <li>Update order processing status</li>
                      </ul>
                      <div style={{display: 'flex', gap: '10px', justifyContent: 'space-between'}}>
                        <button
                          className="btn"
                          style={{background: '#6c757d'}}
                          onClick={() => setSupplierBulkOperation('menu')}
                        >
                          ‚Üê Back to Menu
                        </button>
                        <div style={{display: 'flex', gap: '10px'}}>
                          <button
                            className="btn"
                            style={{background: '#6c757d'}}
                            onClick={() => setShowSupplierBulkModal(false)}
                          >
                            Cancel
                          </button>
                          <button
                            className="btn"
                            style={{background: '#ffc107'}}
                            onClick={async () => {
                              await performSupplierBulkOperation('sync-stock', {});
                            }}
                          >
                            Sync Stock
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                  
                  {supplierBulkOperation === 'delete' && (
                    <div>
                      <h4 style={{color: '#dc3545'}}>‚ö†Ô∏è Delete Suppliers</h4>
                      <p style={{marginBottom: '20px', color: '#666'}}>
                        <strong>WARNING:</strong> This action cannot be undone. Deleting {selectedSuppliers.length} supplier(s) will:
                      </p>
                      <ul style={{marginBottom: '20px', paddingLeft: '20px', color: '#dc3545'}}>
                        <li>Permanently remove supplier records</li>
                        <li>Unlink all associated products</li>
                        <li>Remove API integrations</li>
                        <li>Delete order history connections</li>
                      </ul>
                      <div style={{marginBottom: '20px'}}>
                        <label style={{display: 'block', marginBottom: '5px', color: '#555'}}>
                          Type "DELETE" to confirm:
                        </label>
                        <input 
                          type="text"
                          id="deleteConfirmation"
                          style={{width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ddd'}}
                          placeholder="Type DELETE to confirm"
                        />
                      </div>
                      <div style={{display: 'flex', gap: '10px', justifyContent: 'space-between'}}>
                        <button
                          className="btn"
                          style={{background: '#6c757d'}}
                          onClick={() => setSupplierBulkOperation('menu')}
                        >
                          ‚Üê Back to Menu
                        </button>
                        <div style={{display: 'flex', gap: '10px'}}>
                          <button
                            className="btn"
                            style={{background: '#6c757d'}}
                            onClick={() => setShowSupplierBulkModal(false)}
                          >
                            Cancel
                          </button>
                          <button
                            className="btn"
                            style={{background: '#dc3545'}}
                            onClick={async () => {
                              const confirmation = document.getElementById('deleteConfirmation').value;
                              if (confirmation === 'DELETE') {
                                await performSupplierBulkOperation('delete', {});
                              } else {
                                alert('Please type "DELETE" to confirm this action');
                              }
                            }}
                          >
                            Delete Suppliers
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}
            
            {/* Add/Edit Category Modal */}
            {(showAddCategoryModal || editingCategory) && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '500px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    {editingCategory ? 'Edit Category' : 'Add New Category'}
                  </h3>
                  <form onSubmit={async (e) => {
                    e.preventDefault();
                    
                    const formData = new FormData(e.target);
                    const categoryData = {
                      name: formData.get('name'),
                      description: formData.get('description'),
                      slug: formData.get('slug') || formData.get('name').toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '')
                    };
                    
                    let result;
                    if (editingCategory) {
                      result = await updateCategory(editingCategory.id, categoryData);
                    } else {
                      result = await createCategory(categoryData);
                    }
                    
                    if (result.success) {
                      alert(result.message);
                      setShowAddCategoryModal(false);
                      setEditingCategory(null);
                    } else {
                      alert('Error: ' + result.message);
                    }
                  }}>
                    <div className="form-group">
                      <label className="form-label">Category Name</label>
                      <input
                        type="text"
                        name="name"
                        className="form-input"
                        defaultValue={editingCategory?.name || ''}
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label className="form-label">Description</label>
                      <textarea
                        name="description"
                        className="form-input"
                        defaultValue={editingCategory?.description || ''}
                        rows={3}
                        placeholder="Brief description of the category"
                      />
                    </div>
                    <div className="form-group">
                      <label className="form-label">Slug (URL-friendly name)</label>
                      <input
                        type="text"
                        name="slug"
                        className="form-input"
                        defaultValue={editingCategory?.slug || ''}
                        placeholder="auto-generated-from-name"
                      />
                    </div>
                    
                    <div className="form-group">
                      <label className="form-label">Category Image</label>
                      {editingCategory?.imageUrl && (
                        <div style={{
                          marginBottom: '10px',
                          border: '1px solid #ddd',
                          borderRadius: '8px',
                          padding: '10px',
                          backgroundColor: '#f9f9f9'
                        }}>
                          <p style={{margin: '0 0 8px 0', fontWeight: 'bold'}}>Current Image:</p>
                          <img 
                            src={editingCategory.imageUrl} 
                            alt="Current category image" 
                            style={{
                              maxWidth: '100%',
                              height: '120px',
                              objectFit: 'cover',
                              borderRadius: '4px',
                              border: '1px solid #ddd'
                            }}
                          />
                        </div>
                      )}
                      
                      <div 
                        className="image-upload-zone"
                        style={{
                          border: '2px dashed #ddd',
                          borderRadius: '8px',
                          padding: '20px',
                          textAlign: 'center',
                          backgroundColor: '#f9f9f9',
                          cursor: 'pointer'
                        }}
                        onClick={() => document.getElementById('category-image-upload').click()}
                      >
                        <input
                          type="file"
                          accept="image/*"
                          id="category-image-upload"
                          style={{display: 'none'}}
                          onChange={async (e) => {
                            console.log('File input changed, files:', e.target.files);
                            if (e.target.files && e.target.files[0] && editingCategory) {
                              const file = e.target.files[0];
                              console.log('Starting category image upload for category:', editingCategory.id);
                              console.log('File selected:', file.name, file.size, file.type);
                              
                              try {
                                console.log('Checking if uploadCategoryImage function exists:', typeof window.uploadCategoryImage);
                                if (typeof window.uploadCategoryImage !== 'function') {
                                  console.error('uploadCategoryImage function not found on window object');
                                  alert('Upload function not available. Please refresh the page.');
                                  return;
                                }
                                const uploadResult = await window.uploadCategoryImage(editingCategory.id, file);
                                console.log('Upload result:', uploadResult);
                                
                                if (uploadResult.success) {
                                  alert('Image uploaded successfully!');
                                  // Update the current editing category with the new image URL
                                  const updatedCategory = {
                                    ...editingCategory,
                                    imageUrl: uploadResult.imageUrl
                                  };
                                  setEditingCategory(updatedCategory);
                                  
                                  // Refresh categories list to update the main table
                                  window.fetchCategories(setCategories);
                                } else {
                                  alert('Error uploading image: ' + uploadResult.message);
                                }
                              } catch (error) {
                                console.error('Upload error:', error);
                                alert('Upload failed: Network error');
                              }
                            } else {
                              console.log('Upload conditions not met:', {
                                hasFiles: !!e.target.files,
                                fileCount: e.target.files?.length,
                                hasEditingCategory: !!editingCategory
                              });
                            }
                          }}
                        />
                        <p style={{margin: '0', color: '#666'}}>
                          üì∑ Click to upload new image
                        </p>
                        <p style={{margin: '5px 0 0 0', fontSize: '12px', color: '#999'}}>
                          JPG, PNG, GIF up to 5MB
                        </p>
                      </div>
                    </div>
                    <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                      <button type="submit" className="btn" style={{background: '#28a745'}}>
                        {editingCategory ? 'Update Category' : 'Create Category'}
                      </button>
                      <button
                        type="button"
                        className="btn"
                        style={{background: '#6c757d'}}
                        onClick={() => {
                          setShowAddCategoryModal(false);
                          setEditingCategory(null);
                        }}
                      >
                        Cancel
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}
            
            {/* Homepage Configuration Modal */}
            {showHomepageConfigModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '800px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>
                    üè† Configure Homepage Categories
                  </h3>
                  
                  <div style={{
                    padding: '15px',
                    background: '#e3f2fd',
                    border: '1px solid #2196f3',
                    borderRadius: '6px',
                    marginBottom: '20px'
                  }}>
                    <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px'}}>
                      <span style={{color: '#1976d2', fontSize: '16px'}}>‚ÑπÔ∏è</span>
                      <strong style={{color: '#1976d2'}}>Important:</strong>
                    </div>
                    <p style={{color: '#1976d2', fontSize: '14px', margin: '0'}}>
                      You can select categories for both sections while configuring. When you save, categories that appear in both sections will be kept in Main Top and automatically removed from Shop Categories.
                    </p>
                  </div>
                  
                  <div style={{marginBottom: '30px'}}>
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(350px, 1fr))', gap: '30px'}}>
                      {/* Main Top Categories Section */}
                      <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '8px', border: '1px solid #dee2e6'}}>
                        <h4 style={{color: '#333', marginBottom: '15px', display: 'flex', alignItems: 'center', gap: '8px'}}>
                          <span style={{
                            display: 'inline-block',
                            width: '20px',
                            height: '20px',
                            backgroundColor: '#007bff',
                            borderRadius: '50%',
                            color: 'white',
                            textAlign: 'center',
                            lineHeight: '20px',
                            fontSize: '12px'
                          }}>1</span>
                          Main Top Categories (Max 4)
                        </h4>
                        <p style={{color: '#666', fontSize: '14px', marginBottom: '15px'}}>
                          These categories appear in the hero section of your homepage. Select up to 4 most important categories.
                        </p>
                        
                        <div style={{display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '15px'}}>
                          {homepageConfig.mainTop.map((categoryId, index) => {
                            const category = categories.find(c => c.id === categoryId);
                            return category ? (
                              <div key={categoryId} style={{
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between',
                                padding: '8px 12px',
                                background: '#007bff',
                                color: 'white',
                                borderRadius: '4px'
                              }}>
                                <span>{category.name}</span>
                                <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                  <span style={{fontSize: '12px', opacity: '0.8'}}>#{index + 1}</span>
                                  <button
                                    style={{
                                      background: 'rgba(255,255,255,0.2)',
                                      border: 'none',
                                      color: 'white',
                                      cursor: 'pointer',
                                      borderRadius: '3px',
                                      padding: '2px 6px',
                                      fontSize: '12px'
                                    }}
                                    onClick={() => {
                                      const newMainTop = homepageConfig.mainTop.filter(id => id !== categoryId);
                                      setHomepageConfig({...homepageConfig, mainTop: newMainTop});
                                    }}
                                  >
                                    ‚úï
                                  </button>
                                </div>
                              </div>
                            ) : null;
                          })}
                        </div>
                        
                        {homepageConfig.mainTop.length < 4 && (
                          <select
                            style={{
                              width: '100%',
                              padding: '8px',
                              border: '1px solid #ddd',
                              borderRadius: '4px',
                              backgroundColor: 'white'
                            }}
                            onChange={(e) => {
                              const categoryId = parseInt(e.target.value);
                              if (categoryId && !homepageConfig.mainTop.includes(categoryId)) {
                                setHomepageConfig({
                                  ...homepageConfig,
                                  mainTop: [...homepageConfig.mainTop, categoryId]
                                });
                              }
                              e.target.value = '';
                            }}
                            value=""
                          >
                            <option value="">+ Add Category to Main Top</option>
                            {categories.map(category => (
                              <option key={category.id} value={category.id}>
                                {category.name} 
                                {homepageConfig.mainTop.includes(category.id) && ' (Already selected)'}
                                {homepageConfig.mainShop.includes(category.id) && ' (In Shop section)'}
                              </option>
                            ))}
                          </select>
                        )}
                      </div>
                      
                      {/* Main Shop Categories Section */}
                      <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '8px', border: '1px solid #dee2e6'}}>
                        <h4 style={{color: '#333', marginBottom: '15px', display: 'flex', alignItems: 'center', gap: '8px'}}>
                          <span style={{
                            display: 'inline-block',
                            width: '20px',
                            height: '20px',
                            backgroundColor: '#28a745',
                            borderRadius: '50%',
                            color: 'white',
                            textAlign: 'center',
                            lineHeight: '20px',
                            fontSize: '12px'
                          }}>2</span>
                          Shop Categories (Max 3)
                        </h4>
                        <p style={{color: '#666', fontSize: '14px', marginBottom: '15px'}}>
                          These categories appear in the "Shop by Category" section. Select up to 3 popular categories.
                        </p>
                        
                        <div style={{display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '15px'}}>
                          {homepageConfig.mainShop.map((categoryId, index) => {
                            const category = categories.find(c => c.id === categoryId);
                            return category ? (
                              <div key={categoryId} style={{
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between',
                                padding: '8px 12px',
                                background: '#28a745',
                                color: 'white',
                                borderRadius: '4px'
                              }}>
                                <span>{category.name}</span>
                                <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                  <span style={{fontSize: '12px', opacity: '0.8'}}>#{index + 1}</span>
                                  <button
                                    style={{
                                      background: 'rgba(255,255,255,0.2)',
                                      border: 'none',
                                      color: 'white',
                                      cursor: 'pointer',
                                      borderRadius: '3px',
                                      padding: '2px 6px',
                                      fontSize: '12px'
                                    }}
                                    onClick={() => {
                                      const newMainShop = homepageConfig.mainShop.filter(id => id !== categoryId);
                                      setHomepageConfig({...homepageConfig, mainShop: newMainShop});
                                    }}
                                  >
                                    ‚úï
                                  </button>
                                </div>
                              </div>
                            ) : null;
                          })}
                        </div>
                        
                        {homepageConfig.mainShop.length < 3 && (
                          <select
                            style={{
                              width: '100%',
                              padding: '8px',
                              border: '1px solid #ddd',
                              borderRadius: '4px',
                              backgroundColor: 'white'
                            }}
                            onChange={(e) => {
                              const categoryId = parseInt(e.target.value);
                              if (categoryId && !homepageConfig.mainShop.includes(categoryId)) {
                                setHomepageConfig({
                                  ...homepageConfig,
                                  mainShop: [...homepageConfig.mainShop, categoryId]
                                });
                              }
                              e.target.value = '';
                            }}
                            value=""
                          >
                            <option value="">+ Add Category to Shop Section</option>
                            {categories.map(category => (
                              <option key={category.id} value={category.id}>
                                {category.name}
                                {homepageConfig.mainShop.includes(category.id) && ' (Already selected)'}
                                {homepageConfig.mainTop.includes(category.id) && ' (In Main Top)'}
                              </option>
                            ))}
                          </select>
                        )}
                      </div>
                    </div>
                  </div>
                  
                  <div style={{
                    padding: '15px',
                    background: '#e9ecef',
                    borderRadius: '6px',
                    marginBottom: '20px'
                  }}>
                    <h5 style={{color: '#495057', marginBottom: '10px'}}>Current Configuration Summary</h5>
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px'}}>
                      <div>
                        <strong style={{color: '#007bff'}}>Main Top ({homepageConfig.mainTop.length}/4):</strong>
                        <div style={{fontSize: '14px', color: '#666'}}>
                          {homepageConfig.mainTop.length > 0 ? 
                            homepageConfig.mainTop.map(id => categories.find(c => c.id === id)?.name).join(', ') : 
                            'None selected'
                          }
                        </div>
                      </div>
                      <div>
                        <strong style={{color: '#28a745'}}>Shop Section ({homepageConfig.mainShop.length}/3):</strong>
                        <div style={{fontSize: '14px', color: '#666'}}>
                          {homepageConfig.mainShop.length > 0 ? 
                            homepageConfig.mainShop.map(id => categories.find(c => c.id === id)?.name).join(', ') : 
                            'None selected'
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div style={{display: 'flex', gap: '10px', justifyContent: 'flex-end'}}>
                    <button
                      type="button"
                      className="btn"
                      style={{background: '#6c757d'}}
                      onClick={() => {
                        setShowHomepageConfigModal(false);
                        setHomepageConfig({ mainTop: [], mainShop: [] });
                      }}
                    >
                      Cancel
                    </button>
                    <button
                      type="button"
                      className="btn"
                      style={{background: '#28a745'}}
                      onClick={async () => {
                        try {
                          const response = await fetch('/admin/api/categories/bulk/homepage', {
                            method: 'PUT',
                            headers: {
                              'Content-Type': 'application/json',
                              'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                              mainTopCategories: homepageConfig.mainTop,
                              mainShopCategories: homepageConfig.mainShop
                            })
                          });
                          
                          const data = await response.json();
                          
                          if (response.ok) {
                            alert('Homepage categories updated successfully!');
                            setShowHomepageConfigModal(false);
                            setHomepageConfig({ mainTop: [], mainShop: [] }); // Reset the configuration
                            fetchCategories(); // Refresh the categories list
                          } else {
                            alert('Error: ' + data.message);
                          }
                        } catch (err) {
                          alert('Network error: ' + err.message);
                        }
                      }}
                    >
                      üíæ Save Configuration
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Company Settings Modal */}
            {showCompanySettingsModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  background: 'white',
                  borderRadius: '8px',
                  padding: '30px',
                  maxWidth: '600px',
                  width: '90%',
                  maxHeight: '90vh',
                  overflowY: 'auto',
                  boxShadow: '0 4px 20px rgba(0,0,0,0.3)'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>üè¢ Edit Company Settings</h3>
                  
                  <form onSubmit={async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const settingsData = {
                      name: formData.get('name'),
                      email: formData.get('email'),
                      logisticsEmail: formData.get('logisticsEmail'),
                      phone: formData.get('phone'),
                      address: formData.get('address'),
                      city: formData.get('city'),
                      state: formData.get('state'),
                      zipCode: formData.get('zipCode'),
                      country: formData.get('country'),
                      contactPerson: formData.get('contactPerson'),
                      website: formData.get('website'),
                      vatNumber: formData.get('vatNumber'),
                      registrationNumber: formData.get('registrationNumber'),
                      bankName: formData.get('bankName'),
                      iban: formData.get('iban'),
                      defaultCurrency: formData.get('defaultCurrency'),
                      defaultVatPercentage: formData.get('defaultVatPercentage'),
                      reverseChargeVat: formData.get('reverseChargeVat'),
                      freeShippingThreshold: formData.get('freeShippingThreshold'),
                      standardShippingCost: formData.get('standardShippingCost'),
                      description: formData.get('description')
                    };
                    
                    const result = await updateCompanySettings(settingsData);
                    
                    if (result.success) {
                      alert('‚úÖ Company settings updated successfully!');
                      setCompanySettings(settingsData);
                      setShowCompanySettingsModal(false);
                    } else {
                      alert(`‚ùå Error updating company settings: ${result.message}`);
                    }
                  }}>
                    
                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', marginBottom: '20px'}}>
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Company Name *</label>
                        <input
                          type="text"
                          name="name"
                          defaultValue={companySettings.name}
                          required
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Email *</label>
                        <input
                          type="email"
                          name="email"
                          defaultValue={companySettings.email}
                          required
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Logistics Email</label>
                        <input
                          type="email"
                          name="logisticsEmail"
                          defaultValue={companySettings.logisticsEmail}
                          placeholder="Email for order notifications"
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Phone</label>
                        <input
                          type="text"
                          name="phone"
                          defaultValue={companySettings.phone}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Website</label>
                        <input
                          type="url"
                          name="website"
                          defaultValue={companySettings.website}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Street Address</label>
                        <input
                          type="text"
                          name="address"
                          defaultValue={companySettings.address}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>City</label>
                        <input
                          type="text"
                          name="city"
                          defaultValue={companySettings.city}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>State/Province</label>
                        <input
                          type="text"
                          name="state"
                          defaultValue={companySettings.state}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>ZIP/Postal Code</label>
                        <input
                          type="text"
                          name="zipCode"
                          defaultValue={companySettings.zipCode}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Country</label>
                        <input
                          type="text"
                          name="country"
                          defaultValue={companySettings.country}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Contact Person</label>
                        <input
                          type="text"
                          name="contactPerson"
                          defaultValue={companySettings.contactPerson}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>VAT Number</label>
                        <input
                          type="text"
                          name="vatNumber"
                          defaultValue={companySettings.vatNumber}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Registration Number</label>
                        <input
                          type="text"
                          name="registrationNumber"
                          defaultValue={companySettings.registrationNumber}
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Bank Name</label>
                        <input
                          type="text"
                          name="bankName"
                          defaultValue={companySettings.bankName}
                          placeholder="Banca ComercialƒÉ Rom√¢nƒÉ"
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                      
                      <div>
                        <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>IBAN</label>
                        <input
                          type="text"
                          name="iban"
                          defaultValue={companySettings.iban}
                          placeholder="RO49 AAAA 1B31 0075 9384 0000"
                          style={{
                            width: '100%',
                            padding: '8px',
                            border: '1px solid #ddd',
                            borderRadius: '4px'
                          }}
                        />
                      </div>
                    </div>
                    
                    {/* Default VAT & Currency Settings */}
                    <div style={{marginBottom: '20px', padding: '15px', background: '#f0f8ff', border: '1px solid #007bff', borderRadius: '6px'}}>
                      <h4 style={{color: '#007bff', marginBottom: '15px', fontSize: '16px'}}>üí∞ Default Product Settings</h4>
                      <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '15px'}}>
                        <div>
                          <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Default Currency</label>
                          <select
                            name="defaultCurrency"
                            defaultValue={companySettings.defaultCurrency || 'EUR'}
                            onChange={handleCurrencyChange}
                            style={{
                              width: '100%',
                              padding: '8px',
                              border: '1px solid #ddd',
                              borderRadius: '4px'
                            }}
                          >
                            <option value="EUR">EUR (Euro)</option>
                            <option value="RON">RON (Romanian Leu)</option>
                            <option value="USD">USD (US Dollar)</option>
                            <option value="GBP">GBP (British Pound)</option>
                          </select>
                        </div>
                        
                        <div>
                          <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Default VAT %</label>
                          <select
                            name="defaultVatPercentage"
                            defaultValue={companySettings.defaultVatPercentage || '19.00'}
                            style={{
                              width: '100%',
                              padding: '8px',
                              border: '1px solid #ddd',
                              borderRadius: '4px'
                            }}
                          >
                            <option value="0.00">0% (Reverse Charge)</option>
                            <option value="5.00">5% (Reduced VAT)</option>
                            <option value="9.00">9% (Reduced VAT)</option>
                            <option value="19.00">19% (Standard VAT)</option>
                            <option value="21.00">21% (Standard VAT - from 01.08.2025)</option>
                            <option value="24.00">24% (Luxury VAT)</option>
                          </select>
                        </div>
                        
                        <div>
                          <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Reverse Charge VAT %</label>
                          <input
                            type="number"
                            step="0.01"
                            name="reverseChargeVat"
                            defaultValue={companySettings.reverseChargeVat || '0.00'}
                            placeholder="0.00"
                            style={{
                              width: '100%',
                              padding: '8px',
                              border: '1px solid #ddd',
                              borderRadius: '4px'
                            }}
                          />
                        </div>
                      </div>
                      
                      {/* Shipping Settings Section */}
                      <div style={{background: '#e3f2fd', padding: '20px', borderRadius: '6px', border: '1px solid #bbdefb', marginBottom: '20px'}}>
                        <h4 style={{color: '#1976d2', marginBottom: '15px', borderBottom: '2px solid #2196f3', paddingBottom: '5px'}}>
                          üöö Shipping Settings
                        </h4>
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'}}>
                          <div>
                            <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>
                              Free Shipping Threshold ({companySettings.defaultCurrency || 'EUR'})
                            </label>
                            <input
                              type="number"
                              step="0.01"
                              name="freeShippingThreshold"
                              defaultValue={companySettings.freeShippingThreshold || '500.00'}
                              placeholder="500.00"
                              style={{
                                width: '100%',
                                padding: '8px',
                                border: '1px solid #ddd',
                                borderRadius: '4px'
                              }}
                            />
                            <small style={{color: '#666', fontSize: '12px'}}>Orders above this amount get free shipping</small>
                          </div>
                          
                          <div>
                            <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>
                              Standard Shipping Cost ({companySettings.defaultCurrency || 'EUR'})
                            </label>
                            <input
                              type="number"
                              step="0.01"
                              name="standardShippingCost"
                              defaultValue={companySettings.standardShippingCost || '25.00'}
                              placeholder="25.00"
                              style={{
                                width: '100%',
                                padding: '8px',
                                border: '1px solid #ddd',
                                borderRadius: '4px'
                              }}
                            />
                            <small style={{color: '#666', fontSize: '12px'}}>Cost for orders below free shipping threshold</small>
                          </div>
                        </div>
                      </div>
                      <p style={{fontSize: '12px', color: '#666', marginTop: '10px', fontStyle: 'italic'}}>
                        These values will be used as defaults when creating new products. You can still modify them per product.
                      </p>
                    </div>
                    
                    <div style={{marginBottom: '20px'}}>
                      <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333'}}>Company Description</label>
                      <textarea
                        name="description"
                        defaultValue={companySettings.description}
                        rows="4"
                        style={{
                          width: '100%',
                          padding: '8px',
                          border: '1px solid #ddd',
                          borderRadius: '4px',
                          resize: 'vertical'
                        }}
                      />
                    </div>
                    
                    <div style={{display: 'flex', gap: '10px', justifyContent: 'flex-end'}}>
                      <button
                        type="button"
                        className="btn"
                        style={{background: '#6c757d'}}
                        onClick={() => setShowCompanySettingsModal(false)}
                      >
                        Cancel
                      </button>
                      <button
                        type="submit"
                        className="btn"
                        style={{background: '#007bff'}}
                      >
                        üíæ Save Settings
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}
            
            {/* Excel Import Modal */}
            {showExcelImportModal && (
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 1000
              }}>
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '8px',
                  width: '90%',
                  maxWidth: '600px',
                  maxHeight: '80vh',
                  overflow: 'auto'
                }}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>üì§ Import Products from Excel</h3>
                  
                  <div style={{marginBottom: '20px', padding: '15px', background: '#e7f3ff', borderRadius: '6px', border: '1px solid #b8daff'}}>
                    <h4 style={{color: '#0c5460', marginBottom: '10px'}}>üìã Import Instructions</h4>
                    <ul style={{color: '#0c5460', margin: '0', paddingLeft: '20px'}}>
                      <li>Download the Excel template first using the "Download Excel Template" button</li>
                      <li>Fill in your product data following the template format</li>
                      <li>Required fields: Product Name, Price, Stock Quantity, Category ID</li>
                      <li>Optional fields: Description, Status, VAT %, Product Code, NC Code, CPV Code</li>
                      <li>Category ID must match existing categories in the system</li>
                      <li>Price should be in decimal format (e.g., 29.99)</li>
                    </ul>
                  </div>

                  <div style={{marginBottom: '20px'}}>
                    <label style={{display: 'block', marginBottom: '10px', fontWeight: 'bold', color: '#333'}}>
                      Select Excel File (.xlsx)
                    </label>
                    <input
                      type="file"
                      accept=".xlsx,.xls"
                      onChange={(e) => setExcelFile(e.target.files[0])}
                      style={{
                        width: '100%',
                        padding: '10px',
                        border: '2px dashed #ddd',
                        borderRadius: '6px',
                        background: '#f8f9fa'
                      }}
                    />
                    {excelFile && (
                      <p style={{marginTop: '8px', color: '#28a745', fontSize: '14px'}}>
                        üìÅ Selected: {excelFile.name}
                      </p>
                    )}
                  </div>

                  {importResults && importResults.loading && (
                    <div style={{textAlign: 'center', marginBottom: '20px'}}>
                      <div className="loading"></div>
                      <p style={{color: '#666', marginTop: '10px'}}>Processing Excel file...</p>
                    </div>
                  )}

                  {importResults && !importResults.loading && (
                    <div style={{
                      marginBottom: '20px', 
                      padding: '15px', 
                      borderRadius: '6px',
                      background: importResults.success ? '#d4edda' : '#f8d7da',
                      border: importResults.success ? '1px solid #c3e6cb' : '1px solid #f5c6cb'
                    }}>
                      <h4 style={{
                        color: importResults.success ? '#155724' : '#721c24',
                        marginBottom: '10px'
                      }}>
                        {importResults.success ? '‚úÖ Import Results' : '‚ùå Import Failed'}
                      </h4>
                      {importResults.success ? (
                        <div style={{color: '#155724'}}>
                          <p><strong>Total processed:</strong> {importResults.total}</p>
                          <p><strong>Successfully imported:</strong> {importResults.imported}</p>
                          <p><strong>Errors:</strong> {importResults.errors?.length || 0}</p>
                          <p><strong>Duplicates skipped:</strong> {importResults.duplicates?.length || 0}</p>
                        </div>
                      ) : (
                        <p style={{color: '#721c24'}}>{importResults.message}</p>
                      )}
                    </div>
                  )}

                  <div style={{display: 'flex', gap: '10px', justifyContent: 'space-between'}}>
                    <div style={{display: 'flex', gap: '10px'}}>
                      <button
                        type="button"
                        className="btn"
                        style={{background: '#28a745'}}
                        onClick={downloadExcelTemplate}
                      >
                        üì• Download Template
                      </button>
                    </div>
                    <div style={{display: 'flex', gap: '10px'}}>
                      <button
                        type="button"
                        className="btn"
                        style={{background: '#6c757d'}}
                        onClick={() => {
                          setShowExcelImportModal(false);
                          setExcelFile(null);
                          setImportResults(null);
                        }}
                      >
                        Cancel
                      </button>
                      <button
                        type="button"
                        className="btn"
                        style={{background: '#fd7e14'}}
                        onClick={() => importProductsFromExcel(excelFile)}
                        disabled={!excelFile || (importResults && importResults.loading)}
                      >
                        üì§ Import Products
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </>
        );
      };

      return (
        <div className="container">
          <div className="admin-header">
            <div className="logo" onClick={() => setActiveView('dashboard')} style={{cursor: 'pointer'}}>
              <img src="/attached_assets/KitchenOff_Logo_Background_Removed_1752520997429.png" alt="KitchenOff Logo" />
              <span>KitchenOff Admin</span>
            </div>
            <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
              <span style={{fontSize: '14px', color: '#666'}}>Welcome, {admin?.firstName || 'Admin'}</span>
              <button onClick={handleLogout} className="btn btn-secondary" style={{padding: '8px 16px', fontSize: '14px', width: 'auto'}}>
                Logout
              </button>
            </div>
          </div>
          
          <div className="nav-tabs">
            <button 
              className={`nav-tab ${activeView === 'dashboard' ? 'active' : ''}`}
              onClick={() => handleViewChange('dashboard')}
            >
              <span style={{fontSize: '18px'}}>üìä</span>
              <span style={{fontSize: '12px'}}>Dashboard</span>
            </button>
            <button 
              className={`nav-tab ${activeView === 'orders' ? 'active' : ''}`}
              onClick={() => handleViewChange('orders')}
            >
              <span style={{fontSize: '18px'}}>üìã</span>
              <span style={{fontSize: '12px'}}>Orders</span>
            </button>
            <button 
              className={`nav-tab ${activeView === 'users' ? 'active' : ''}`}
              onClick={() => handleViewChange('users')}
            >
              <span style={{fontSize: '18px'}}>üë•</span>
              <span style={{fontSize: '12px'}}>Users</span>
            </button>
            <button 
              className={`nav-tab ${activeView === 'products' ? 'active' : ''}`}
              onClick={() => handleViewChange('products')}
            >
              <span style={{fontSize: '18px'}}>üì¶</span>
              <span style={{fontSize: '12px'}}>Products</span>
            </button>
            <button 
              className={`nav-tab ${activeView === 'categories' ? 'active' : ''}`}
              onClick={() => handleViewChange('categories')}
            >
              <span style={{fontSize: '18px'}}>üìÅ</span>
              <span style={{fontSize: '12px'}}>Categories</span>
            </button>
            <button 
              className={`nav-tab ${activeView === 'suppliers' ? 'active' : ''}`}
              onClick={() => handleViewChange('suppliers')}
            >
              <span style={{fontSize: '18px'}}>üè¢</span>
              <span style={{fontSize: '12px'}}>Suppliers</span>
            </button>
            <button 
              className={`nav-tab ${activeView === 'company-settings' ? 'active' : ''}`}
              onClick={() => handleViewChange('company-settings')}
            >
              <span style={{fontSize: '18px'}}>‚öôÔ∏è</span>
              <span style={{fontSize: '12px'}}>Company Settings</span>
            </button>
          </div>
          
          <div className="content-area">
            {renderContent()}
          </div>
          <ModalsComponent />
        </div>
      );
    }
    
    // Main Admin App Component - Optimized for speed
    function AdminApp() {
      // Initialize state synchronously to avoid delays
      const [token, setToken] = useState(localStorage.getItem('adminToken'));
      const [admin, setAdmin] = useState(() => {
        try {
          const savedAdmin = localStorage.getItem('adminUser');
          return savedAdmin ? JSON.parse(savedAdmin) : null;
        } catch {
          return null;
        }
      });
      const [isAuthenticated, setIsAuthenticated] = useState(
        !!(localStorage.getItem('adminToken') && localStorage.getItem('adminUser'))
      );
      const [loading, setLoading] = useState(false); // Start with false for immediate render
      
      useEffect(() => {
        // Minimal async validation - only if needed
        if (token && admin && !isAuthenticated) {
          setIsAuthenticated(true);
        } else if (!token || !admin) {
          // Clean up invalid state
          localStorage.removeItem('adminToken');
          localStorage.removeItem('adminUser');
          setIsAuthenticated(false);
        }
      }, [token, admin, isAuthenticated]);
      
      const handleLoginSuccess = (token, admin) => {
        setToken(token);
        setAdmin(admin);
        setIsAuthenticated(true);
      };
      
      const handleLogout = () => {
        // Clear localStorage
        localStorage.removeItem('adminToken');
        localStorage.removeItem('adminUser');
        
        // Clear state
        setToken(null);
        setAdmin(null);
        setIsAuthenticated(false);
      };
      
      // Render immediately without loading screen
      if (!isAuthenticated) {
        return <AdminLogin onLoginSuccess={handleLoginSuccess} />;
      }
      
      return <AdminDashboard token={token} admin={admin} onLogout={handleLogout} />;
    }
    
    // Hide initial loading overlay after a short delay and render app
    setTimeout(() => {
      const loadingElement = document.getElementById('initial-loading');
      if (loadingElement) {
        loadingElement.classList.add('hidden');
      }
    }, 1000);
    
    // Render the app immediately
    const root = ReactDOM.createRoot(document.getElementById('admin-root'));
    root.render(<AdminApp />);
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KitchenOff Admin Panel</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .login-container {
      max-width: 400px;
      margin: 50px auto;
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    }
    
    .admin-header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .stat-number {
      font-size: 36px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .stat-label {
      color: #666;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }
    
    .form-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .btn {
      background: #667eea;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: background-color 0.3s;
      width: 100%;
    }
    
    .btn:hover {
      background: #5a6fd8;
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: #f5f5f5;
      color: #333;
      border: 2px solid #e0e0e0;
    }
    
    .btn-secondary:hover {
      background: #e0e0e0;
    }
    
    .error-message {
      background: #fee;
      color: #c33;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      border: 1px solid #fcc;
    }
    
    .success-message {
      background: #efe;
      color: #393;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      border: 1px solid #cfc;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .hidden {
      display: none;
    }
    
    .text-center {
      text-align: center;
    }
    
    .mb-20 {
      margin-bottom: 20px;
    }
    
    .mb-30 {
      margin-bottom: 30px;
    }
    
    .text-sm {
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>
  <div id="admin-root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Admin Login Component
    function AdminLogin({ onLoginSuccess }) {
      const [formData, setFormData] = useState({ email: '', password: '' });
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');
        
        try {
          const response = await fetch('/admin/api/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
          });
          
          const data = await response.json();
          
          if (response.ok) {
            localStorage.setItem('adminToken', data.token);
            localStorage.setItem('adminUser', JSON.stringify(data.admin));
            onLoginSuccess(data.token, data.admin);
          } else {
            setError(data.message || 'Login failed');
          }
        } catch (err) {
          setError('Network error. Please try again.');
        } finally {
          setLoading(false);
        }
      };
      
      return (
        <div className="login-container">
          <div className="text-center mb-30">
            <div className="logo">üç¥ KitchenOff Admin</div>
          </div>
          
          {error && <div className="error-message">{error}</div>}
          
          <form onSubmit={handleSubmit}>
            <div className="form-group">
              <label className="form-label">Email</label>
              <input
                type="email"
                className="form-input"
                value={formData.email}
                onChange={(e) => setFormData({...formData, email: e.target.value})}
                required
                placeholder="admin@kitchen-off.com"
              />
            </div>
            
            <div className="form-group">
              <label className="form-label">Password</label>
              <input
                type="password"
                className="form-input"
                value={formData.password}
                onChange={(e) => setFormData({...formData, password: e.target.value})}
                required
                placeholder="Enter your password"
              />
            </div>
            
            <button type="submit" className="btn" disabled={loading}>
              {loading && <span className="loading"></span>}
              {loading ? 'Logging in...' : 'Login'}
            </button>
          </form>
          
          <div className="text-sm text-center" style={{marginTop: '20px'}}>
            <p><strong>Demo Credentials:</strong></p>
            <p>Email: admin@kitchen-off.com</p>
            <p>Password: admin123</p>
          </div>
        </div>
      );
    }
    
    // Admin Dashboard Component
    function AdminDashboard({ token, admin, onLogout }) {
      const [stats, setStats] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState('');
      const [showTwoFactor, setShowTwoFactor] = useState(false);
      const [activeView, setActiveView] = useState('dashboard');
      const [orders, setOrders] = useState([]);
      const [users, setUsers] = useState([]);
      const [products, setProducts] = useState([]);
      
      useEffect(() => {
        fetchStats();
      }, []);
      
      const fetchStats = async () => {
        try {
          const response = await fetch('/admin/api/stats', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            setStats(data);
          } else {
            setError(data.message || 'Failed to fetch stats');
          }
        } catch (err) {
          setError('Network error. Please try again.');
        } finally {
          setLoading(false);
        }
      };

      const fetchOrders = async () => {
        try {
          const response = await fetch('/api/orders', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            setOrders(data);
          } else {
            console.error('Failed to fetch orders:', data.message);
          }
        } catch (err) {
          console.error('Network error fetching orders:', err);
        }
      };

      const fetchProducts = async () => {
        try {
          const response = await fetch('/api/products', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            setProducts(data);
          } else {
            console.error('Failed to fetch products:', data.message);
          }
        } catch (err) {
          console.error('Network error fetching products:', err);
        }
      };

      const handleViewChange = (view) => {
        setActiveView(view);
        if (view === 'orders' && orders.length === 0) {
          fetchOrders();
        } else if (view === 'products' && products.length === 0) {
          fetchProducts();
        }
      };
      
      const handleLogout = async () => {
        try {
          await fetch('/admin/api/logout', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
        } catch (err) {
          console.error('Logout error:', err);
        } finally {
          localStorage.removeItem('adminToken');
          localStorage.removeItem('adminUser');
          onLogout();
        }
      };
      
      if (loading) {
        return (
          <div className="container">
            <div className="text-center">
              <div className="loading"></div>
              <p>Loading dashboard...</p>
            </div>
          </div>
        );
      }
      
      if (error) {
        return (
          <div className="container">
            <div className="error-message">{error}</div>
            <button onClick={handleLogout} className="btn btn-secondary">
              Logout
            </button>
          </div>
        );
      }
      
      const renderContent = () => {
        switch (activeView) {
          case 'orders':
            return (
              <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                <h3 style={{marginBottom: '20px', color: '#333'}}>üìã Order Management</h3>
                {orders.length > 0 ? (
                  <div style={{overflowX: 'auto'}}>
                    <table style={{width: '100%', borderCollapse: 'collapse'}}>
                      <thead>
                        <tr style={{backgroundColor: '#f5f5f5'}}>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Order ID</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Customer</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Amount</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Status</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Date</th>
                        </tr>
                      </thead>
                      <tbody>
                        {orders.slice(0, 10).map((order, index) => (
                          <tr key={index} style={{borderBottom: '1px solid #eee'}}>
                            <td style={{padding: '12px'}}>#{order.id}</td>
                            <td style={{padding: '12px'}}>User #{order.userId}</td>
                            <td style={{padding: '12px'}}>${order.totalAmount}</td>
                            <td style={{padding: '12px'}}>
                              <span style={{
                                padding: '4px 8px', 
                                borderRadius: '4px', 
                                backgroundColor: order.status === 'pending' ? '#fff3cd' : '#d4edda',
                                color: order.status === 'pending' ? '#856404' : '#155724'
                              }}>
                                {order.status}
                              </span>
                            </td>
                            <td style={{padding: '12px'}}>{new Date(order.createdAt).toLocaleDateString()}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                ) : (
                  <p style={{color: '#666', fontStyle: 'italic'}}>No orders found</p>
                )}
              </div>
            );
          
          case 'users':
            return (
              <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                <h3 style={{marginBottom: '20px', color: '#333'}}>üë• User Management</h3>
                <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px'}}>
                  <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{marginBottom: '10px', color: '#495057'}}>Total Users</h4>
                    <p style={{fontSize: '24px', fontWeight: 'bold', color: '#007bff', margin: '0'}}>{stats?.totalUsers || '0'}</p>
                  </div>
                  <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{marginBottom: '10px', color: '#495057'}}>Active Users</h4>
                    <p style={{fontSize: '24px', fontWeight: 'bold', color: '#28a745', margin: '0'}}>2</p>
                  </div>
                  <div style={{padding: '20px', background: '#f8f9fa', borderRadius: '6px', border: '1px solid #dee2e6'}}>
                    <h4 style={{marginBottom: '10px', color: '#495057'}}>Admin Users</h4>
                    <p style={{fontSize: '24px', fontWeight: 'bold', color: '#dc3545', margin: '0'}}>1</p>
                  </div>
                </div>
                <div style={{marginTop: '20px', padding: '15px', background: '#e9ecef', borderRadius: '6px'}}>
                  <p style={{color: '#6c757d', margin: '0'}}>
                    üí° User management features including user creation, editing, and role management will be implemented here.
                  </p>
                </div>
              </div>
            );
          
          case 'products':
            return (
              <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                <h3 style={{marginBottom: '20px', color: '#333'}}>üì¶ Product Management</h3>
                {products.length > 0 ? (
                  <div style={{overflowX: 'auto'}}>
                    <table style={{width: '100%', borderCollapse: 'collapse'}}>
                      <thead>
                        <tr style={{backgroundColor: '#f5f5f5'}}>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Product ID</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Name</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Price</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Category</th>
                          <th style={{padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd'}}>Stock</th>
                        </tr>
                      </thead>
                      <tbody>
                        {products.slice(0, 10).map((product, index) => (
                          <tr key={index} style={{borderBottom: '1px solid #eee'}}>
                            <td style={{padding: '12px'}}>#{product.id}</td>
                            <td style={{padding: '12px'}}>{product.name}</td>
                            <td style={{padding: '12px'}}>${product.price}</td>
                            <td style={{padding: '12px'}}>{product.category?.name || 'N/A'}</td>
                            <td style={{padding: '12px'}}>
                              <span style={{
                                padding: '4px 8px', 
                                borderRadius: '4px', 
                                backgroundColor: product.stock > 10 ? '#d4edda' : '#f8d7da',
                                color: product.stock > 10 ? '#155724' : '#721c24'
                              }}>
                                {product.stock || 'N/A'}
                              </span>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                ) : (
                  <p style={{color: '#666', fontStyle: 'italic'}}>No products found</p>
                )}
              </div>
            );
          
          default:
            return (
              <>
                <div className="dashboard-grid">
                  <div className="stat-card">
                    <div className="stat-number">{stats?.totalUsers || '0'}</div>
                    <div className="stat-label">Total Users</div>
                  </div>
                  
                  <div className="stat-card">
                    <div className="stat-number">{stats?.totalOrders || '0'}</div>
                    <div className="stat-label">Total Orders</div>
                  </div>
                  
                  <div className="stat-card">
                    <div className="stat-number">{stats?.totalProducts || '0'}</div>
                    <div className="stat-label">Total Products</div>
                  </div>
                  
                  <div className="stat-card">
                    <div className="stat-number">{stats?.recentOrders?.length || '0'}</div>
                    <div className="stat-label">Recent Orders</div>
                  </div>
                </div>
                
                <div style={{background: 'white', padding: '30px', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}}>
                  <h3 style={{marginBottom: '20px', color: '#333'}}>System Overview</h3>
                  <p style={{color: '#666', lineHeight: '1.6'}}>
                    Welcome to the KitchenOff Admin Panel. Here you can manage your e-commerce platform, 
                    view statistics, and monitor system performance. The dashboard shows real-time data 
                    from your PostgreSQL database.
                  </p>
                  
                  <div style={{marginTop: '30px', padding: '20px', background: '#f8f9ff', borderRadius: '6px'}}>
                    <h4 style={{color: '#333', marginBottom: '10px'}}>Quick Stats Summary</h4>
                    <ul style={{listStyle: 'none', padding: 0}}>
                      <li style={{marginBottom: '5px'}}>üìä {stats?.totalUsers || '0'} registered users</li>
                      <li style={{marginBottom: '5px'}}>üõí {stats?.totalOrders || '0'} orders processed</li>
                      <li style={{marginBottom: '5px'}}>üì¶ {stats?.totalProducts || '0'} products in catalog</li>
                      <li style={{marginBottom: '5px'}}>üîÑ {stats?.recentOrders?.length || '0'} recent orders</li>
                    </ul>
                  </div>
                  
                  <div style={{marginTop: '30px', padding: '20px', background: '#fff8e1', borderRadius: '6px'}}>
                    <h4 style={{color: '#333', marginBottom: '10px'}}>Admin Actions</h4>
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', marginTop: '15px'}}>
                      <button 
                        className="btn" 
                        style={{background: activeView === 'orders' ? '#2E7D32' : '#4CAF50', width: 'auto', padding: '10px 16px'}}
                        onClick={() => handleViewChange('orders')}
                      >
                        üìã Manage Orders
                      </button>
                      <button 
                        className="btn" 
                        style={{background: activeView === 'users' ? '#1565C0' : '#2196F3', width: 'auto', padding: '10px 16px'}}
                        onClick={() => handleViewChange('users')}
                      >
                        üë• Manage Users
                      </button>
                      <button 
                        className="btn" 
                        style={{background: activeView === 'products' ? '#F57C00' : '#FF9800', width: 'auto', padding: '10px 16px'}}
                        onClick={() => handleViewChange('products')}
                      >
                        üì¶ Manage Products
                      </button>
                      <button 
                        className="btn" 
                        style={{background: '#9C27B0', width: 'auto', padding: '10px 16px'}}
                        onClick={() => setShowTwoFactor(!showTwoFactor)}
                      >
                        üîê Two-Factor Auth
                      </button>
                    </div>
                  </div>
                  
                  {showTwoFactor && (
                    <div style={{marginTop: '30px', padding: '20px', background: '#e8f5e8', borderRadius: '6px', border: '2px solid #4CAF50'}}>
                      <h4 style={{color: '#333', marginBottom: '10px'}}>üîê Two-Factor Authentication</h4>
                      <p style={{color: '#666', marginBottom: '15px'}}>
                        Status: {admin?.twoFactorEnabled ? 
                          <span style={{color: '#4CAF50', fontWeight: 'bold'}}>‚úÖ Enabled</span> : 
                          <span style={{color: '#f44336', fontWeight: 'bold'}}>‚ùå Disabled</span>
                        }
                      </p>
                      <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                        <button 
                          className="btn" 
                          style={{background: admin?.twoFactorEnabled ? '#f44336' : '#4CAF50', width: 'auto', padding: '8px 16px'}}
                          onClick={() => alert('2FA management functionality will be implemented')}
                        >
                          {admin?.twoFactorEnabled ? 'üîì Disable 2FA' : 'üîí Enable 2FA'}
                        </button>
                        {admin?.twoFactorEnabled && (
                          <button 
                            className="btn" 
                            style={{background: '#FF9800', width: 'auto', padding: '8px 16px'}}
                            onClick={() => alert('Backup codes regeneration will be implemented')}
                          >
                            üîÑ Regenerate Backup Codes
                          </button>
                        )}
                      </div>
                    </div>
                  )}
                  
                  <div style={{marginTop: '30px', padding: '20px', background: '#f0f8ff', borderRadius: '6px'}}>
                    <h4 style={{color: '#333', marginBottom: '10px'}}>Recent Activity</h4>
                    {stats?.recentOrders?.length > 0 ? (
                      <div style={{maxHeight: '200px', overflowY: 'auto'}}>
                        {stats.recentOrders.map((order, index) => (
                          <div key={index} style={{
                            padding: '10px',
                            marginBottom: '10px',
                            background: 'white',
                            borderRadius: '4px',
                            borderLeft: '4px solid #2196F3'
                          }}>
                            <div style={{fontWeight: 'bold'}}>Order #{order.id}</div>
                            <div style={{fontSize: '14px', color: '#666'}}>
                              Amount: ${order.totalAmount} | Status: {order.status}
                            </div>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <p style={{color: '#666', fontStyle: 'italic'}}>No recent orders</p>
                    )}
                  </div>
                </div>
              </>
            );
        }
      };

      return (
        <div className="container">
          <div className="admin-header">
            <div className="logo">üç¥ KitchenOff Admin</div>
            <div>
              <span>Welcome, {admin?.firstName || 'Admin'}</span>
              <button onClick={() => setActiveView('dashboard')} className="btn btn-secondary" style={{marginLeft: '10px', marginRight: '10px'}}>
                üè† Dashboard
              </button>
              <button onClick={handleLogout} className="btn btn-secondary">
                Logout
              </button>
            </div>
          </div>
          
          {renderContent()}
        </div>
      );
    }
    
    // Main Admin App Component
    function AdminApp() {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [token, setToken] = useState(null);
      const [admin, setAdmin] = useState(null);
      const [loading, setLoading] = useState(true);
      
      useEffect(() => {
        // Check for existing session
        const savedToken = localStorage.getItem('adminToken');
        const savedAdmin = localStorage.getItem('adminUser');
        
        if (savedToken && savedAdmin) {
          setToken(savedToken);
          setAdmin(JSON.parse(savedAdmin));
          setIsAuthenticated(true);
        }
        
        setLoading(false);
      }, []);
      
      const handleLoginSuccess = (token, admin) => {
        setToken(token);
        setAdmin(admin);
        setIsAuthenticated(true);
      };
      
      const handleLogout = () => {
        setToken(null);
        setAdmin(null);
        setIsAuthenticated(false);
      };
      
      if (loading) {
        return (
          <div className="container">
            <div className="text-center">
              <div className="loading"></div>
              <p>Loading...</p>
            </div>
          </div>
        );
      }
      
      if (!isAuthenticated) {
        return <AdminLogin onLoginSuccess={handleLoginSuccess} />;
      }
      
      return <AdminDashboard token={token} admin={admin} onLogout={handleLogout} />;
    }
    
    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('admin-root'));
    root.render(<AdminApp />);
  </script>
</body>
</html>